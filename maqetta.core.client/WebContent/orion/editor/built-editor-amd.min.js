/*

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation
 Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
 Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 RequireJS i18n 1.0.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
*/
define("orion/util",[],function(){var r=navigator.userAgent,q=parseFloat(r.split("MSIE")[1])||void 0,m=parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0,i=r.indexOf("Opera")!==-1,b=parseFloat(r.split("Chrome/")[1])||void 0,e=r.indexOf("Safari")!==-1&&!b,f=parseFloat(r.split("WebKit/")[1])||void 0,h=r.indexOf("Android")!==-1,c=r.indexOf("iPad")!==-1,r=r.indexOf("iPhone")!==-1,a=c||r,g=navigator.platform.indexOf("Mac")!==-1,p=navigator.platform.indexOf("Win")!==-1,n=navigator.platform.indexOf("Linux")!==
-1;return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,g){return b[(g<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:q,isFirefox:m,isOpera:i,isChrome:b,isSafari:e,isWebkit:f,isAndroid:h,isIPad:c,isIPhone:r,isIOS:a,isMac:g,isWindows:p,isLinux:n,platformDelimiter:p?"\r\n":"\n"}});
define("orion/editor/eventTarget",[],function(){function r(){}r.addMixin=function(q){var m=r.prototype,i;for(i in m)m.hasOwnProperty(i)&&(q[i]=m[i])};r.prototype={addEventListener:function(q,m,i){if(!this._eventTypes)this._eventTypes={};var b=this._eventTypes[q];b||(b=this._eventTypes[q]={level:0,listeners:[]});b.listeners.push({listener:m,useCapture:i})},dispatchEvent:function(q){var m=q.type;this._dispatchEvent("pre"+m,q);this._dispatchEvent(m,q);this._dispatchEvent("post"+m,q)},_dispatchEvent:function(q,
m){var i=this._eventTypes?this._eventTypes[q]:null;if(i){var b=i.listeners;try{if(i.level++,b)for(var e=0,f=b.length;e<f;e++)if(b[e]){var h=b[e].listener;typeof h==="function"?h.call(this,m):h.handleEvent&&typeof h.handleEvent==="function"&&h.handleEvent(m)}}finally{if(i.level--,i.compact&&i.level===0){for(e=b.length-1;e>=0;e--)b[e]||b.splice(e,1);b.length===0&&delete this._eventTypes[q];i.compact=!1}}}},isListening:function(q){return!this._eventTypes?!1:this._eventTypes[q]!==void 0},removeEventListener:function(q,
m,i){if(this._eventTypes){var b=this._eventTypes[q];if(b){for(var e=b.listeners,f=0,h=e.length;f<h;f++){var c=e[f];if(c&&c.listener===m&&c.useCapture===i){b.level!==0?(e[f]=null,b.compact=!0):e.splice(f,1);break}}e.length===0&&delete this._eventTypes[q]}}}};return{EventTarget:r}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/util"],function(r,q){function m(i,b){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(i);this.setLineDelimiter(b)}m.prototype={find:function(i){if(this._text.length>1)this._text=[this._text.join("")];var b=i.string,e=b;!i.regex&&b&&(e=b.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"));var f=null,h;if(e){var b=i.reverse,c=i.wrap,a=i.wholeWord,g=i.caseInsensitive,p=i.start||0,n=i.end,i=i.end!==void 0,o="";o.indexOf("g")===
-1&&(o+="g");g&&o.indexOf("i")===-1&&(o+="i");a&&(e="\\b"+e+"\\b");var s=this._text[0],t,m,d=0;i&&(s=s.substring(p,n),d=p);var j=RegExp(e,o);if(b)h=function(){var l=null;for(j.lastIndex=0;;){m=j.lastIndex;t=j.exec(s);if(m===j.lastIndex)return null;if(t){if(!(t.index<p)){if(!c||l)break;p=s.length}l={start:t.index+d,end:j.lastIndex+d}}else break}if(l)p=l.start;return l};else{if(!i)j.lastIndex=p;h=function(){for(;;){m=j.lastIndex;t=j.exec(s);if(m===j.lastIndex)break;if(t)return{start:t.index+d,end:j.lastIndex+
d};if(!(m!==0&&c))break}return null}}f=h()}return{next:function(){var d=f;d&&(f=h());return d},hasNext:function(){return f!==null}}},getCharCount:function(){for(var i=0,b=0;b<this._text.length;b++)i+=this._text[b].length;return i},getLine:function(i,b){var e=this.getLineCount();if(!(0<=i&&i<e))return null;var f=this._lineOffsets[i];if(i+1<e){e=this.getText(f,this._lineOffsets[i+1]);if(b)return e;for(var f=e.length,h;(h=e.charCodeAt(f-1))===10||h===13;)f--;return e.substring(0,f)}else return this.getText(f)},
getLineAtOffset:function(i){var b=this.getCharCount();if(!(0<=i&&i<=b))return-1;var e=this.getLineCount();if(i===b)return e-1;var f,h,c=this._lastLineIndex;if(0<=c&&c<e&&(f=this._lineOffsets[c],h=c+1<e?this._lineOffsets[c+1]:b,f<=i&&i<h))return c;for(var a=e,g=-1;a-g>1;)if(c=Math.floor((a+g)/2),f=this._lineOffsets[c],h=c+1<e?this._lineOffsets[c+1]:b,i<=f)a=c;else if(i<h){a=c;break}else g=c;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},
getLineEnd:function(i,b){var e=this.getLineCount();if(!(0<=i&&i<e))return-1;if(i+1<e){e=this._lineOffsets[i+1];if(b)return e;for(var f=this.getText(Math.max(this._lineOffsets[i],e-2),e),h=f.length,c;(c=f.charCodeAt(h-1))===10||c===13;)h--;return e-(f.length-h)}else return this.getCharCount()},getLineStart:function(i){return!(0<=i&&i<this.getLineCount())?-1:this._lineOffsets[i]},getText:function(i,b){i===void 0&&(i=0);b===void 0&&(b=this.getCharCount());if(i===b)return"";for(var e=0,f=0,h;f<this._text.length;){h=
this._text[f].length;if(i<=e+h)break;e+=h;f++}for(var c=e,a=f;f<this._text.length;){h=this._text[f].length;if(b<=e+h)break;e+=h;f++}if(a===f)return this._text[a].substring(i-c,b-e);c=this._text[a].substring(i-c);e=this._text[f].substring(0,b-e);return c+this._text.slice(a+1,f).join("")+e},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i,b){i==="auto"&&(i=void 0,this.getLineCount()>1&&(i=this.getText(this.getLineEnd(0),
this.getLineEnd(0,!0))));this._lineDelimiter=i?i:q.platformDelimiter;if(b){var e=this.getLineCount();if(e>1){for(var f=Array(e),h=0;h<e;h++)f[h]=this.getLine(h);this.setText(f.join(this._lineDelimiter))}}},setText:function(i,b,e){i===void 0&&(i="");b===void 0&&(b=0);e===void 0&&(e=this.getCharCount());if(!(b===e&&i==="")){for(var f=this.getLineAtOffset(b),h=this.getLineAtOffset(e),c=b,a=e-b,g=h-f,p=i.length,n=0,o=this.getLineCount(),s=0,t=0,m=0,d=[];;){s!==-1&&s<=m&&(s=i.indexOf("\r",m));t!==-1&&
t<=m&&(t=i.indexOf("\n",m));if(t===-1&&s===-1)break;m=s!==-1&&t!==-1?s+1===t?t+1:(s<t?s:t)+1:s!==-1?s+1:t+1;d.push(b+m);n++}this.onChanging({type:"Changing",text:i,start:c,removedCharCount:a,addedCharCount:p,removedLineCount:g,addedLineCount:n});d.length===0&&(s=this.getLineStart(f),h=h+1<o?this.getLineStart(h+1):this.getCharCount(),b!==s&&(i=this.getText(s,b)+i,b=s),e!==h&&(i+=this.getText(e,h),e=h));h=p-a;for(s=f+g+1;s<o;s++)this._lineOffsets[s]+=h;f=[f+1,g].concat(d);Array.prototype.splice.apply(this._lineOffsets,
f);for(h=d=0;h<this._text.length;){s=this._text[h].length;if(b<=d+s)break;d+=s;h++}o=d;for(f=h;h<this._text.length;){s=this._text[h].length;if(e<=d+s)break;d+=s;h++}s=this._text[h];b=this._text[f].substring(0,b-o);e=s.substring(e-d);f=[f,h-f+1];b&&f.push(b);i&&f.push(i);e&&f.push(e);Array.prototype.splice.apply(this._text,f);if(this._text.length===0)this._text=[""];this.onChanged({type:"Changed",start:c,removedCharCount:a,addedCharCount:p,removedLineCount:g,addedLineCount:n})}}};r.EventTarget.addMixin(m.prototype);
return{TextModel:m}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(r,q,m){function i(b){b=b||{};this._document=b.document||document}var b={};i.getTheme=function(e){var e=e||"default",f=b[e];f||(f=b[e]=new i);return f};i.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(b,f){var h=this,c=h._themeClass;h._themeClass=b;this._load(b,f,function(){h.onThemeChanged({type:"ThemeChanged",oldValue:c,newValue:h.getThemeClass()})})},onThemeChanged:function(b){return this.dispatchEvent(b)},
buildStyleSheet:function(b,f){function h(a,f,n){c.push("."+b+" ."+a+" {");c.push("\t"+(n?"background-color":"color")+": "+f+";");c.push("}")}var c=[];c.push("");var a=f.fontFamily,a=a==="sans serif"?'"Menlo", "Consolas", "Vera Mono", "monospace"':"monospace";c.push("."+b+" {");c.push("\tfont-family: "+a+";");c.push("\tfont-size: "+f.fontSize+";");c.push("\tcolor: "+f.text+";");c.push("}");c.push("."+b+".textview {");c.push("\tbackground-color: "+f.background+";");c.push("}");h("ruler.annotations",
f.annotationRuler,!0);h("ruler.lines",f.annotationRuler,!0);h("ruler.folding",f.annotationRuler,!0);h("ruler.overview",f.overviewRuler,!0);h("rulerLines",f.lineNumber,!1);h("rulerLines.even",f.lineNumberEven,!1);h("rulerLines.odd",f.lineNumberOdd,!1);h("annotationLine.currentLine",f.currentLine,!0);h("entity-name-tag",f.keyword,!1);h("entity-other-attribute-name",f.attribute,!1);h("string-quoted",f.string,!1);h("line_caret",f.currentLine,!0);h("token_keyword",f.keyword,!1);h("token_string",f.string,
!1);h("token_singleline_comment",f.comment,!1);h("token_multiline_comment",f.comment,!1);h("token_doc_comment",f.comment,!1);h("token_doc_html_markup",f.comment,!1);return c.join("\n")},_createStyle:function(b,f,h,c){var a=this._document,b="orion-theme-"+b,g=a.getElementById(b);if(g){if(c||g.firstChild.data===f)return;g.removeChild(g.firstChild);g.appendChild(a.createTextNode(f))}else c?(g=m.createElement(a,"link"),g.rel="stylesheet",g.type="text/css",g.href=f,g.addEventListener("load",function(){h()})):
(g=m.createElement(a,"style"),g.appendChild(a.createTextNode(f))),g.id=b,(a.getElementsByTagName("head")[0]||a.documentElement).appendChild(g);c||h()},_load:function(b,f,h){if(b)if(typeof f==="string")this._createStyle(b,f,h);else if(f=f.href,f.substring(f.length-4)!==".css"&&(f+=".css"),/^\//.test(f)||/[a-zA-Z0-9]+:\/\//i.test(f)||!r.toUrl)this._createStyle(b,f,h,!0);else{var c=this;r(["text!"+f],function(a){c._createStyle(b,a,h,!1)})}else h()}};q.EventTarget.addMixin(i.prototype);return{TextTheme:i}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(r,q){function m(i){this._model=i;this._projections=[]}m.prototype={addProjection:function(i){if(i){var b=this._model,e=this._projections;i._lineIndex=b.getLineAtOffset(i.start);i._lineCount=b.getLineAtOffset(i.end)-i._lineIndex;var f=i.text;f||(f="");i._model=typeof f==="string"?new r.TextModel(f,b.getLineDelimiter()):f;var b=this.mapOffset(i.start,!0),f=i.end-i.start,h=i._lineCount,c=i._model.getCharCount(),
a=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:i._model.getText(),start:b,removedCharCount:f,addedCharCount:c,removedLineCount:h,addedLineCount:a});var g=this._binarySearch(e,i.start);e.splice(g,0,i);this.onChanged({type:"Changed",start:b,removedCharCount:f,addedCharCount:c,removedLineCount:h,addedLineCount:a})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(i,b){var e=this._projections,f=0,h,c;if(b){for(h=
0;h<e.length;h++){c=e[h];if(c.start>i)break;if(c.end>i)return-1;f+=c._model.getCharCount()-(c.end-c.start)}return i+f}for(h=0;h<e.length;h++){c=e[h];if(c.start>i-f)break;var a=c._model.getCharCount();if(c.start+a>i-f)return-1;f+=a-(c.end-c.start)}return i-f},removeProjection:function(i){var b,e=0;for(b=0;b<this._projections.length;b++){var f=this._projections[b];if(f===i){i=f;break}e+=f._model.getCharCount()-(f.end-f.start)}if(b<this._projections.length){var f=this._model,e=i.start+e,h=i.end-i.start,
c=i._lineCount,a=i._model.getCharCount(),g=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:f.getText(i.start,i.end),start:e,removedCharCount:a,addedCharCount:h,removedLineCount:g,addedLineCount:c});this._projections.splice(b,1);this.onChanged({type:"Changed",start:e,removedCharCount:a,addedCharCount:h,removedLineCount:g,addedLineCount:c})}},_binarySearch:function(i,b){for(var e=i.length,f=-1,h;e-f>1;)h=Math.floor((e+f)/2),b<=i[h].start?e=h:f=h;return e},getCharCount:function(){for(var i=
this._model.getCharCount(),b=this._projections,e=0;e<b.length;e++){var f=b[e];i+=f._model.getCharCount()-(f.end-f.start)}return i},getLine:function(i,b){if(i<0)return null;var e=this._model,f=this._projections,h=0,c=[],a=0,g,p,n;for(g=0;g<f.length;g++){n=f[g];if(n._lineIndex>=i-h)break;p=n._model.getLineCount()-1;if(n._lineIndex+p>=i-h)if(a=i-(n._lineIndex+h),a<p)return n._model.getLine(a,b);else c.push(n._model.getLine(p));a=n.end;h+=p-n._lineCount}for(a=Math.max(a,e.getLineStart(i-h));g<f.length;g++){n=
f[g];if(n._lineIndex>i-h)break;c.push(e.getText(a,n.start));p=n._model.getLineCount()-1;if(n._lineIndex+p>i-h)return c.push(n._model.getLine(0,b)),c.join("");c.push(n._model.getText());a=n.end;h+=p-n._lineCount}f=e.getLineEnd(i-h,b);a<f&&c.push(e.getText(a,f));return c.join("")},getLineAtOffset:function(i){for(var b=this._model,e=this._projections,f=0,h=0,c=0;c<e.length;c++){var a=e[c];if(a.start>i-f)break;var g=a._model.getCharCount();if(a.start+g>i-f){e=i-(a.start+f);h+=a._model.getLineAtOffset(e);
f+=e;break}h+=a._model.getLineCount()-1-a._lineCount;f+=g-(a.end-a.start)}return b.getLineAtOffset(i-f)+h},getLineCount:function(){for(var i=this._projections,b=this._model.getLineCount(),e=0;e<i.length;e++){var f=i[e];b+=f._model.getLineCount()-1-f._lineCount}return b},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(i,b){if(i<0)return-1;for(var e=this._model,f=this._projections,h=0,c=0,a=0;a<f.length;a++){var g=f[a];if(g._lineIndex>i-h)break;var p=g._model.getLineCount()-
1;if(g._lineIndex+p>i-h)return g._model.getLineEnd(i-(g._lineIndex+h),b)+g.start+c;c+=g._model.getCharCount()-(g.end-g.start);h+=p-g._lineCount}return e.getLineEnd(i-h,b)+c},getLineStart:function(i){if(i<0)return-1;for(var b=this._model,e=this._projections,f=0,h=0,c=0;c<e.length;c++){var a=e[c];if(a._lineIndex>=i-f)break;var g=a._model.getLineCount()-1;if(a._lineIndex+g>=i-f)return a._model.getLineStart(i-(a._lineIndex+f))+a.start+h;h+=a._model.getCharCount()-(a.end-a.start);f+=g-a._lineCount}return b.getLineStart(i-
f)+h},getText:function(i,b){i===void 0&&(i=0);var e=this._model,f=this._projections,h=0,c=[],a,g,p;for(a=0;a<f.length;a++){g=f[a];if(g.start>i-h)break;p=g._model.getCharCount();if(g.start+p>i-h)if(b!==void 0&&g.start+p>b-h)return g._model.getText(i-(g.start+h),b-(g.start+h));else c.push(g._model.getText(i-(g.start+h))),i=g.end+h+p-(g.end-g.start);h+=p-(g.end-g.start)}var n=i-h;if(b!==void 0){for(;a<f.length;a++){g=f[a];if(g.start>b-h)break;c.push(e.getText(n,g.start));p=g._model.getCharCount();if(g.start+
p>b-h)return c.push(g._model.getText(0,b-(g.start+h))),c.join("");c.push(g._model.getText());n=g.end;h+=p-(g.end-g.start)}c.push(e.getText(n,b-h))}else{for(;a<f.length;a++)g=f[a],c.push(e.getText(n,g.start)),c.push(g._model.getText()),n=g.end;c.push(e.getText(n))}return c.join("")},_onChanging:function(i,b,e,f,h,c){for(var a=this._model,g=this._projections,p,n=0,o,s=b+e;p<g.length;p++){e=g[p];if(e.start>b)break;n+=e._model.getCharCount()-(e.end-e.start)}b+=n;for(var t=p;p<g.length;p++){e=g[p];if(e.start>
s)break;n+=e._model.getCharCount()-(e.end-e.start);o+=e._model.getLineCount()-1-e._lineCount}e=s+n;n=p;this.onChanging(b,e-b,f,h+o,c);g.splice(g,n-t);for(i=i.length-(e-b);p<g.length;p++)e=g[p],e.start+=i,e.end+=i,e._lineIndex=a.getLineAtOffset(e.start)},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i){this._model.setLineDelimiter(i)},setText:function(i,b,e){i===void 0&&(i="");b===void 0&&(b=0);var f=b,h=e,c=this._model,
a=this._projections,g=0,p=0,n,o,s,t,m,d=0;for(n=0;n<a.length;n++){o=a[n];if(o.start>b-g)break;s=o._model.getCharCount();if(o.start+s>b-g)if(e!==void 0&&o.start+s>e-g){o._model.setText(i,b-(o.start+g),e-(o.start+g));return}else d=o._model.getLineCount()-1-o._model.getLineAtOffset(b-(o.start+g)),t={projection:o,start:b-(o.start+g)},b=o.end+g+s-(o.end-o.start);p+=o._model.getLineCount()-1-o._lineCount;g+=s-(o.end-o.start)}b-=g;var j=n,d=c.getLineAtOffset(b)+p-d;if(e!==void 0)for(;n<a.length;n++){o=a[n];
if(o.start>e-g)break;s=o._model.getCharCount();if(o.start+s>e-g){p+=o._model.getLineAtOffset(e-(o.start+g));s=e-(o.start+g);e=o.end+g;m={projection:o,end:s};break}p+=o._model.getLineCount()-1-o._lineCount;g+=s-(o.end-o.start)}else{for(;n<a.length;n++)o=a[n],p+=o._model.getLineCount()-1-o._lineCount,g+=o._model.getCharCount()-(o.end-o.start);e=h=c.getCharCount()+g}e-=g;o=c.getLineAtOffset(e)+p;h-=f;for(var p=o-d,d=i.length,l=s=o=g=0;;){o!==-1&&o<=l&&(o=i.indexOf("\r",l));s!==-1&&s<=l&&(s=i.indexOf("\n",
l));if(s===-1&&o===-1)break;l=o!==-1&&s!==-1?o+1===s?s+1:(o<s?o:s)+1:o!==-1?o+1:s+1;g++}this.onChanging({type:"Changing",text:i,start:f,removedCharCount:h,addedCharCount:d,removedLineCount:p,addedLineCount:g});c.setText(i,b,e);if(t)o=t.projection,o._model.setText("",t.start);if(m)o=m.projection,o._model.setText("",0,m.end),o.start=o.end,o._lineCount=0;a.splice(j,n-j);for(i=i.length-(e-b);n<a.length;n++)o=a[n],o.start+=i,o.end+=i,o._lineIndex=c.getLineAtOffset(o.start);this.onChanged({type:"Changed",
start:f,removedCharCount:h,addedCharCount:d,removedLineCount:p,addedLineCount:g})}};q.EventTarget.addMixin(m.prototype);return{ProjectionTextModel:m}});
define("orion/keyBinding",["orion/util"],function(r){function q(m,i,b,e,f){this.keyCode=typeof m==="string"?m.toUpperCase().charCodeAt(0):m;this.mod1=i!==void 0&&i!==null?i:!1;this.mod2=b!==void 0&&b!==null?b:!1;this.mod3=e!==void 0&&e!==null?e:!1;this.mod4=f!==void 0&&f!==null?f:!1}q.prototype={match:function(m){return this.keyCode===m.keyCode?this.mod1!==(r.isMac?m.metaKey:m.ctrlKey)?!1:this.mod2!==m.shiftKey?!1:this.mod3!==m.altKey?!1:r.isMac&&this.mod4!==m.ctrlKey?!1:!0:!1},equals:function(m){return!m?
!1:this.keyCode!==m.keyCode?!1:this.mod1!==m.mod1?!1:this.mod2!==m.mod2?!1:this.mod3!==m.mod3?!1:this.mod4!==m.mod4?!1:!0}};return{KeyBinding:q}});
define("orion/editor/textView",["orion/editor/textModel","orion/keyBinding","orion/editor/eventTarget","orion/editor/textTheme","orion/util"],function(r,q,m,i,b){function e(d,j,l,u){typeof d.addEventListener==="function"?d.addEventListener(j,l,u===!0):d.attachEvent("on"+j,l)}function f(d,j,l){if(l){j.className="";for(var l=j.attributes,u=l.length;u-- >0;)(!b.isIE||b.isIE>=9||b.isIE<9&&l[u].specified)&&j.removeAttribute(l[u].name)}if(d){if(d.styleClass)j.className=d.styleClass;if(l=d.style)for(var k in l)l.hasOwnProperty(k)&&
(j.style[k]=l[k]);if(d=d.attributes)for(var a in d)d.hasOwnProperty(a)&&j.setAttribute(a,d[a])}}function h(d){return d instanceof Array?d.slice(0):d}function c(d,j){if(d===j)return!0;if(d&&!j||!d&&j)return!1;if(d&&d.constructor===String||j&&j.constructor===String)return!1;if(d instanceof Array||j instanceof Array){if(!(d instanceof Array&&j instanceof Array))return!1;if(d.length!==j.length)return!1;for(var l=0;l<d.length;l++)if(!c(d[l],j[l]))return!1;return!0}if(!(d instanceof Object)||!(j instanceof
Object))return!1;for(l in d)if(d.hasOwnProperty(l)){if(!j.hasOwnProperty(l))return!1;if(!c(d[l],j[l]))return!1}for(l in j)if(!d.hasOwnProperty(l))return!1;return!0}function a(d,j,l){for(var u=0,k=0,a=0,b=d.length;a<b;){u!==-1&&u<=a&&(u=d.indexOf("\r",a));k!==-1&&k<=a&&(k=d.indexOf("\n",a));var g=a,c;if(k===-1&&u===-1){j(d.substring(a));break}u!==-1&&k!==-1?u+1===k?(c=u,a=k+1):(c=u<k?u:k,a=(u<k?u:k)+1):u!==-1?(c=u,a=u+1):(c=k,a=k+1);j(d.substring(g,c));l()}}function g(d){var j,l,u,k,a=d.ownerDocument.defaultView||
d.ownerDocument.parentWindow;if(a.getComputedStyle)d=a.getComputedStyle(d,null),j=d.getPropertyValue("padding-left"),l=d.getPropertyValue("padding-top"),u=d.getPropertyValue("padding-right"),k=d.getPropertyValue("padding-bottom");else if(d.currentStyle)j=d.currentStyle.paddingLeft,l=d.currentStyle.paddingTop,u=d.currentStyle.paddingRight,k=d.currentStyle.paddingBottom;return{left:parseInt(j,10)||0,top:parseInt(l,10)||0,right:parseInt(u,10)||0,bottom:parseInt(k,10)||0}}function p(d){var j,l,u,k,a=
d._trim;if(!a){var a=g(d),b=d.ownerDocument.defaultView||d.ownerDocument.parentWindow;if(b.getComputedStyle)k=b.getComputedStyle(d,null),j=k.getPropertyValue("border-left-width"),l=k.getPropertyValue("border-top-width"),u=k.getPropertyValue("border-right-width"),k=k.getPropertyValue("border-bottom-width");else if(d.currentStyle)j=d.currentStyle.borderLeftWidth,l=d.currentStyle.borderTopWidth,u=d.currentStyle.borderRightWidth,k=d.currentStyle.borderBottomWidth;j=parseInt(j,10)||0;l=parseInt(l,10)||
0;u=parseInt(u,10)||0;k=parseInt(k,10)||0;a.left+=j;a.top+=l;a.right+=u;a.bottom+=k;d._trim=a}return a}function n(d,j,l){this.start=d;this.end=j;this.caret=l}function o(d){this.left=d.left;this.top=d.top;this.right=d.right;this.bottom=d.bottom}function s(d,j,l){this.view=d;this.lineIndex=j;this._lineDiv=l}function t(d){this._init(d||{})}var v=function(){function d(d){this.options=d}d.prototype.play=function(){var d=typeof this.options.duration==="number"?this.options.duration:350,l=this.options.easing||
this.defaultEasing,u=this.options.onAnimate||function(){},k=this.options.curve[0],a=this.options.curve[1],b=a-k,g=-1,c,f=this;this.interval=this.options.window.setInterval(function(){g=g===-1?(new Date).getTime():g;var e=((new Date).getTime()-g)/d;e<1?(e=l(e),c=k+e*b,u(c)):(u(a),f.stop())},typeof this.options.rate==="number"?this.options.rate:20)};d.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};d.prototype.defaultEasing=function(d){return Math.sin(d*
(Math.PI/2))};return d}();n.prototype={clone:function(){return new n(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(d){this.caret?this.start=d:this.end=d;if(this.start>this.end)d=this.start,this.start=this.end,this.end=d,this.caret=!this.caret},setCaret:function(d){this.end=this.start=d;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?
" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(d){return this.caret===d.caret&&this.start===d.start&&this.end===d.end}};o.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};s.prototype={create:function(d,j){if(!this._lineDiv){var l=this._lineDiv=this._createLine(d,j,this.lineIndex);l._line=this;return l}},_createLine:function(d,j,l){var u=this.view,k=u._model,a=k.getLine(l),g=k.getLineStart(l),
e={type:"LineStyle",textView:u,lineIndex:l,lineText:a,lineStart:g};if(a.length<2E3)u.onLineStyle(e);k=j||b.createElement(d.ownerDocument,"div");if(!j||!c(j.viewStyle,e.style)){f(e.style,k,j);if(j)j._trim=null;k.viewStyle=e.style;k.setAttribute("role","presentation")}k.lineIndex=l;l=[];this._createRanges(e.ranges,a,0,a.length,g,{tabOffset:0,ranges:l});a=" ";!u._fullSelection&&b.isIE<9&&(a="\ufeff");b.isWebkit&&(a="\u200c");l.push({text:a,style:u._metrics.largestFontStyle,ignoreChars:1});var n,p,h,
o,s,a=u=0,i,t;if(j){if(p=j.modelChangedEvent)p.removedLineCount===0&&p.addedLineCount===0?(t=p.start-g,i=p.addedCharCount-p.removedCharCount):t=-1,j.modelChangedEvent=void 0;p=j.firstChild}for(g=0;g<l.length;g++){n=l[g];o=n.text;u+=o.length;e=n.style;if(p)if(s=p.firstChild.data,h=p.viewStyle,s===o&&c(e,h)){a+=s.length;p._rectsCache=void 0;n=p=p.nextSibling;continue}else for(;p;){if(t!==-1){h=u;h>=t&&(h-=i);s=(s=p.firstChild.data)?s.length:0;if(a+s>h)break;a+=s}h=p.nextSibling;k.removeChild(p);p=h}n=
this._createSpan(k,o,e,n.ignoreChars);p?k.insertBefore(n,p):k.appendChild(n);if(j)j.lineWidth=void 0}if(j)for(d=n?n.nextSibling:null;d;)h=d.nextSibling,j.removeChild(d),d=h;else d.appendChild(k);return k},_createRanges:function(d,j,l,u,k,a){if(!(l>=u)){if(d)for(var b=0;b<d.length;b++){var g=d[b];if(!(g.end<=k+l)){var f=Math.max(k+l,g.start)-k;if(f>=u)break;var e=Math.min(k+u,g.end)-k;if(f<e){f=Math.max(l,f);e=Math.min(u,e);for(l<f&&this._createRange(j,l,f,null,a);b+1<d.length&&d[b+1].start-k===e&&
c(g.style,d[b+1].style);)g=d[b+1],e=Math.min(k+u,g.end)-k,b++;this._createRange(j,f,e,g.style,a);l=e}}}l<u&&this._createRange(j,l,u,null,a)}},_createRange:function(d,j,l,u,k){if(!(j>=l)){var a=this.view._customTabSize;if(a&&a!==8)for(var b=d.indexOf("\t",j);b!==-1&&b<l;){j<b&&(j={text:d.substring(j,b),style:u},k.ranges.push(j),k.tabOffset+=j.text.length);j=a-k.tabOffset%a;if(j>0){for(var g="\u00a0",c=1;c<j;c++)g+=" ";j={text:g,style:u,ignoreChars:j-1};k.ranges.push(j);k.tabOffset+=j.text.length}j=
b+1;b=d.indexOf("\t",j)}j<l&&(j={text:d.substring(j,l),style:u},k.ranges.push(j),k.tabOffset+=j.text.length)}},_createSpan:function(d,j,l,a){var k=l&&l.tagName==="A";if(k)d.hasLink=!0;var k=k&&this.view._linksVisible?"a":"span",g=d.ownerDocument,d=b.createElement(d.ownerDocument,k);d.appendChild(g.createTextNode(j));f(l,d);if(k==="A"){var c=this.view,p=this._getWindow();e(d,"click",function(d){return c._handleLinkClick(d?d:p.event)},!1)}d.viewStyle=l;if(a)d.ignoreChars=a;return d},_ensureCreated:function(){return this._lineDiv?
this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(d,j){var l=this._ensureCreated(),a=this.view;if(d===void 0)return this._getLineBoundingClientRect(l,!0);var k=a._model,g=l.ownerDocument,c=this.lineIndex,f=null;if(d<k.getLineEnd(c)){k=k.getLineStart(c);for(c=l.firstChild;c;){var e=c.firstChild,p=e.length;c.ignoreChars&&(p-=c.ignoreChars);if(k+p>d){f=d-k;if(a._isRangeRects)g=g.createRange(),g.setStart(e,f),g.setEnd(e,f+1),f=new o(g.getBoundingClientRect());
else if(b.isIE)g=g.body.createTextRange(),g.moveToElementText(c),g.collapse(),g.moveEnd("character",f+1),g.moveStart("character",f),f=new o(g.getBoundingClientRect());else{var n=e.data;c.removeChild(e);c.appendChild(g.createTextNode(n.substring(0,f)));var h=b.createElement(g,"span");h.appendChild(g.createTextNode(n.substring(f,f+1)));c.appendChild(h);c.appendChild(g.createTextNode(n.substring(f+1)));f=new o(h.getBoundingClientRect());c.innerHTML="";c.appendChild(e);this._createdDiv||(g=a._getSelection(),
(k<=g.start&&g.start<k+p||k<=g.end&&g.end<k+p)&&a._updateDOMSelection())}b.isIE&&(g=l.ownerDocument.defaultView||l.ownerDocument.parentWindow,l=g.screen.logicalXDPI/g.screen.deviceXDPI,g=g.screen.logicalYDPI/g.screen.deviceYDPI,f.left*=l,f.right*=l,f.top*=g,f.bottom*=g);break}k+=p;c=c.nextSibling}}l=this.getBoundingClientRect();if(!f)a._wrapMode?(a=this.getClientRects(),f=a[a.length-1],f.left=f.right,f.left+=l.left,f.top+=l.top,f.right+=l.left,f.bottom+=l.top):(f=new o(l),f.left=f.right);if(j||j===
void 0)f.left-=l.left,f.top-=l.top,f.right-=l.left,f.bottom-=l.top;return f},_getClientRects:function(d,j){var l,a,k,b;if(!d._rectsCache){l=d.getClientRects();a=Array(l.length);for(b=0;b<l.length;b++)k=a[b]=new o(l[b]),k.left-=j.left,k.top-=j.top,k.right-=j.left,k.bottom-=j.top;d._rectsCache=a}l=d._rectsCache;a=[l.length];for(b=0;b<l.length;b++)a[b]=new o(l[b]);return a},getClientRects:function(d){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var j=this._ensureCreated(),l=[],a=
j.firstChild,k,b=j.getBoundingClientRect();a;){for(var g=this._getClientRects(a,b),j=0;j<g.length;j++){var c=g[j],f;if(c.top!==c.bottom){var e=c.top+(c.bottom-c.top)/2;for(f=0;f<l.length;f++)if(k=l[f],k.top<=e&&e<k.bottom)break;if(f===l.length)l.push(c);else{if(c.left<k.left)k.left=c.left;if(c.top<k.top)k.top=c.top;if(c.right>k.right)k.right=c.right;if(c.bottom>k.bottom)k.bottom=c.bottom}}}a=a.nextSibling}return d!==void 0?l[d]:l},_getLineBoundingClientRect:function(d,j){var l=new o(d.getBoundingClientRect());
if(!this.view._wrapMode){l.right=l.left;for(var a=d.lastChild;a&&a.ignoreChars===a.firstChild.length;)a=a.previousSibling;if(a)a=a.getBoundingClientRect(),l.right=a.right+p(d).right}j&&(a=p(d),l.left+=a.left,l.right-=a.right);return l},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(d){if(!this.view._wrapMode)return 0;for(var j=this.getClientRects(),d=this.getBoundingClientRect(d),d=d.top+(d.bottom-d.top)/2,l=0;l<j.length;l++)if(j[l].top<=d&&
d<j[l].bottom)return l;return j.length-1},getLineStart:function(d){if(!this.view._wrapMode||d===0)return this.view._model.getLineStart(d);var j=this.getClientRects();return this.getOffset(j[d].left+1,j[d].top+1)},getOffset:function(d,j){var l=this.view,a=l._model,k=this.lineIndex,g=a.getLineStart(k),a=a.getLineEnd(k);if(g===a)return g;var c=this._ensureCreated(),k=this.getBoundingClientRect(),f,e;if(l._wrapMode){f=this.getClientRects();if(j<f[0].top)j=f[0].top;for(var p=0;p<f.length;p++)if(e=f[p],
e.top<=j&&j<e.bottom)break;if(d<e.left)d=e.left;d>e.right&&(d=e.right-1)}else d<0&&(d=0),d>k.right-k.left&&(d=k.right-k.left);var n=c.ownerDocument,p=n.defaultView||n.parentWindow,h=b.isIE?p.screen.logicalXDPI/p.screen.deviceXDPI:1,o=b.isIE?p.screen.logicalYDPI/p.screen.deviceYDPI:1,p=g,s=c.firstChild;a:for(;s;){var i=s.firstChild,c=i.length;s.ignoreChars&&(c-=s.ignoreChars);var t,m,q;f=this._getClientRects(s,k);for(var v=0;v<f.length;v++)if(e=f[v],e.left<=d&&d<e.right&&(!l._wrapMode||e.top<=j&&j<
e.bottom)){if(b.isIE||l._isRangeRects){for(var n=l._isRangeRects?n.createRange():n.body.createTextRange(),v=c,r=-1;v-r>1;){var B=Math.floor((v+r)/2);e=r+1;f=B===c-1&&s.ignoreChars?i.length:B+1;l._isRangeRects?(n.setStart(i,e),n.setEnd(i,f)):(n.moveToElementText(s),n.move("character",e),n.moveEnd("character",f-e));f=n.getClientRects();for(var H=!1,D=0;D<f.length;D++)if(e=f[D],t=e.left*h-k.left,q=e.right*h-k.left,m=e.top*o-k.top,e=e.bottom*o-k.top,t<=d&&d<q&&(!l._wrapMode||m<=j&&j<e)){H=!0;break}H?
v=B:r=B}p+=v;e=v;f=v===c-1&&s.ignoreChars?i.length:Math.min(v+1,i.length);l._isRangeRects?(n.setStart(i,e),n.setEnd(i,f)):(n.moveToElementText(s),n.move("character",e),n.moveEnd("character",f-e));e=n.getClientRects()[0];t=e.left*h-k.left;q=e.right*h-k.left;d>t+(q-t)/2&&p++}else{e=[];for(h=0;h<c;h++)e.push("<span>"),h===c-1?e.push(i.data.substring(h)):e.push(i.data.substring(h,h+1)),e.push("</span>");s.innerHTML=e.join("");for(h=s.firstChild;h;){e=h.getBoundingClientRect();t=e.left-k.left;q=e.right-
k.left;if(t<=d&&d<q){d>t+(q-t)/2&&p++;break}p++;h=h.nextSibling}if(!this._createdDiv)s.innerHTML="",s.appendChild(i),k=l._getSelection(),(p<=k.start&&k.start<p+c||p<=k.end&&k.end<p+c)&&l._updateDOMSelection()}break a}p+=c;s=s.nextSibling}return Math.min(a,Math.max(g,p))},getNextOffset:function(d,j,l){return j==="line"?(j=this.view._model,d=j.getLineAtOffset(d),l>0?j.getLineEnd(d):j.getLineStart(d)):j==="wordend"?this._getNextOffset_W3C(d,j,l):b.isIE?this._getNextOffset_IE(d,j,l):this._getNextOffset_W3C(d,
j,l)},_getNextOffset_W3C:function(d,j,l){function a(d){return 33<=d&&d<=47||58<=d&&d<=64||91<=d&&d<=94||d===96||123<=d&&d<=126}if(j==="word"||j==="wordend"){var k=this.view._model,b=k.getLineAtOffset(d),g=k.getLine(b),c=k.getLineStart(b),b=k.getLineEnd(b),k=g.length;d-=c;var f,e;if(l>0){if(d===k)return b;f=g.charCodeAt(d);e=a(f);l=!e&&!(f===32||f===9);for(d++;d<k;){f=g.charCodeAt(d);b=a(f);if(j==="wordend"){if(!b&&e)break}else if(b&&!e)break;f=!b&&!(f===32||f===9);if(j==="wordend"){if(!f&&l)break}else if(f&&
!l)break;l=f;e=b;d++}}else{if(d===0)return c;d--;f=g.charCodeAt(d);e=a(f);for(l=!e&&!(f===32||f===9);0<d;){f=g.charCodeAt(d-1);b=a(f);if(j==="wordend"){if(b&&!e)break}else if(!b&&e)break;f=!b&&!(f===32||f===9);if(j==="wordend"){if(f&&!l)break}else if(!f&&l)break;l=f;e=b;d--}}return c+d}return d+l},_getNextOffset_IE:function(d,j,l){var a=this._ensureCreated(),k=this.view._model,b=this.lineIndex,g=0,c;c=k.getLineStart(b);var f=a.ownerDocument;if(d===k.getLineEnd(b)){for(a=a.lastChild;a&&a.ignoreChars;)a=
a.previousSibling;if(!a)return c;g=f.body.createTextRange();g.moveToElementText(a);c=g.text.length;g.moveEnd(j,l);g=d+g.text.length-c}else if(d===c&&l<0)g=c;else for(a=a.firstChild;a;){k=a.firstChild.length;a.ignoreChars&&(k-=a.ignoreChars);if(c+k>d){g=f.body.createTextRange();d===c&&l<0?g.moveToElementText(a.previousSibling):(g.moveToElementText(a),g.collapse(),g.moveEnd("character",d-c));c=g.text.length;g.moveEnd(j,l);g=d+g.text.length-c;break}c=k+c;a=a.nextSibling}return g},destroy:function(){var d=
this._createdDiv;if(d)d.parentNode.removeChild(d),this._createdDiv=null}};t.prototype={addRuler:function(d,j){d.setView(this);var l=this._rulers;if(j!==void 0){var a,k;for(a=0,k=0;a<l.length&&k<j;a++)d.getLocation()===l[a].getLocation()&&k++;l.splice(k,0,d);j=k}else l.push(d);this._createRuler(d,j);this._update()},computeSize:function(){var d=0,j=0,l=this._model,a=this._clientDiv;if(!a)return{width:d,height:j};var k=a.style.width;if(b.isWebkit)a.style.width="0x7fffffffpx";for(var l=l.getLineCount(),
g=0;g<l;g++){var c=this._getLine(g),f=c.getBoundingClientRect(),d=Math.max(d,f.right-f.left);j+=f.bottom-f.top;c.destroy()}if(b.isWebkit)a.style.width=k;a=this._getViewPadding();d+=a.right+a.left+this._metrics.scrollWidth;j+=a.bottom+a.top+this._metrics.scrollWidth;return{width:d,height:j}},convert:function(d,j,l){if(this._clientDiv){var a=this._getScroll(),k=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect();j==="document"&&(d.x!==void 0&&(d.x+=-a.x+b.left+k.left),d.y!==void 0&&(d.y+=
-a.y+b.top+k.top));l==="document"&&(d.x!==void 0&&(d.x+=a.x-b.left-k.left),d.y!==void 0&&(d.y+=a.y-b.top-k.top));return d}},destroy:function(){for(var d=0;d<this._rulers.length;d++)this._rulers[d].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyBindings=this._doubleClickSelection=this._selection=this._theme=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),b.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),
this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(d){if(d=this._actions[d])return d.actionDescription},getActions:function(d){var j=[],l=this._actions,a;for(a in l)l.hasOwnProperty(a)&&(d||!l[a].defaultHandler)&&j.push(a);return j},getBottomIndex:function(d){return!this._clientDiv?0:this._getBottomIndex(d)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},
getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var d=this._getScroll();return{x:d.x,y:d.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(d){for(var j=[],l=this._keyBindings,a=0;a<l.length;a++)l[a].actionID===d&&j.push(l[a].keyBinding);return j},getLineHeight:function(d){return!this._clientDiv?0:this._getLineHeight(d)},getLineIndex:function(d){return!this._clientDiv?
0:this._getLineIndex(d)},getLinePixel:function(d){return!this._clientDiv?0:this._getLinePixel(d)},getLocationAtOffset:function(d){if(!this._clientDiv)return{x:0,y:0};var j=this._model,d=Math.min(Math.max(0,d),j.getCharCount()),j=j.getLineAtOffset(d),l=this._getLine(j),d=l.getBoundingClientRect(d);l.destroy();l=d.left;j=this._getLinePixel(j)+d.top;return{x:l,y:j}},getOptions:function(){var d;if(arguments.length===0)d=this._defaultOptions();else if(arguments.length===1){if(d=arguments[0],typeof d===
"string")return h(this["_"+d])}else{d={};for(var j in arguments)arguments.hasOwnProperty(j)&&(d[arguments[j]]=void 0)}for(var l in d)d.hasOwnProperty(l)&&(d[l]=h(this["_"+l]));return d},getModel:function(){return this._model},getOffsetAtLocation:function(d,j){if(!this._clientDiv)return 0;var l=this._getLineIndex(j),a=this._getLine(l),l=a.getOffset(d,j-this._getLinePixel(l));a.destroy();return l},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var d=this._getSelection();
return{start:d.start,end:d.end}},getText:function(d,j){return this._model.getText(d,j)},getTopIndex:function(d){return!this._clientDiv?0:this._getTopIndex(d)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(d,j){if(this._clientDiv){var l=this._actions[d];if(l){if(!j&&l.handler&&l.handler())return;if(l.defaultHandler)return l.defaultHandler()}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(d){return this.dispatchEvent(d)},
onDragStart:function(d){return this.dispatchEvent(d)},onDrag:function(d){return this.dispatchEvent(d)},onDragEnd:function(d){return this.dispatchEvent(d)},onDragEnter:function(d){return this.dispatchEvent(d)},onDragOver:function(d){return this.dispatchEvent(d)},onDragLeave:function(d){return this.dispatchEvent(d)},onDrop:function(d){return this.dispatchEvent(d)},onDestroy:function(d){return this.dispatchEvent(d)},onLineStyle:function(d){return this.dispatchEvent(d)},onModelChanged:function(d){return this.dispatchEvent(d)},
onModelChanging:function(d){return this.dispatchEvent(d)},onModify:function(d){return this.dispatchEvent(d)},onMouseDown:function(d){return this.dispatchEvent(d)},onMouseUp:function(d){return this.dispatchEvent(d)},onMouseMove:function(d){return this.dispatchEvent(d)},onMouseOver:function(d){return this.dispatchEvent(d)},onMouseOut:function(d){return this.dispatchEvent(d)},onSelection:function(d){return this.dispatchEvent(d)},onScroll:function(d){return this.dispatchEvent(d)},onVerify:function(d){return this.dispatchEvent(d)},
onFocus:function(d){return this.dispatchEvent(d)},onBlur:function(d){return this.dispatchEvent(d)},redraw:function(){if(!(this._redrawCount>0)){var d=this._model.getLineCount();this.redrawRulers(0,d);this.redrawLines(0,d)}},redrawRulers:function(d,j){if(!(this._redrawCount>0))for(var l=this.getRulers(),a=0;a<l.length;a++)this.redrawLines(d,j,l[a])},redrawLines:function(d,j,l){if(!(this._redrawCount>0)&&(d===void 0&&(d=0),j===void 0&&(j=this._model.getLineCount()),d!==j)){var a=this._clientDiv;if(a){if(l)for(a=
(l.getLocation()==="left"?this._leftDiv:this._rightDiv).firstChild;a;){if(a._ruler===l)break;a=a.nextSibling}l?a.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(d,j);if(!l||l.getOverview()==="page")for(a=a.firstChild;a;){var k=a.lineIndex;if(d<=k&&k<j)a.lineChanged=!0;a=a.nextSibling}if(!l&&!this._wrapMode&&d<=this._maxLineIndex&&this._maxLineIndex<j)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._queueUpdate()}}},redrawRange:function(d,j){if(!(this._redrawCount>
0)){var l=this._model;d===void 0&&(d=0);j===void 0&&(j=l.getCharCount());var a=l.getLineAtOffset(d),l=l.getLineAtOffset(Math.max(d,j-1))+1;this.redrawLines(a,l)}},removeRuler:function(d){for(var j=this._rulers,l=0;l<j.length;l++)if(j[l]===d){j.splice(l,1);d.setView(null);this._destroyRuler(d);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(d,j,l){if(d){var a=this._actions,k=a[d];k||(k=a[d]={});k.handler=j;k.actionDescription=l}},setKeyBinding:function(d,
j){for(var l=this._keyBindings,a=0;a<l.length;a++){var k=l[a];if(k.keyBinding.equals(d)){j?k.actionID=j:k.predefined?k.actionID=null:l.splice(a,1);return}}j&&l.push({keyBinding:d,actionID:j})},setCaretOffset:function(d,j,l){var a=this._model.getCharCount(),d=Math.max(0,Math.min(d,a));this._setSelection(new n(d,d,!1),j===void 0||j,!0,l)},setHorizontalPixel:function(d){this._clientDiv&&(d=Math.max(0,d),this._scrollView(d-this._getScroll().x,0))},setRedraw:function(d){d?--this._redrawCount===0&&this.redraw():
this._redrawCount++},setModel:function(d){if(d&&d!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var j=this._model.getLineCount(),l=this._model.getCharCount(),a=d.getLineCount(),k=d.getCharCount(),b={type:"ModelChanging",text:d.getText(),start:0,removedCharCount:l,addedCharCount:k,removedLineCount:j,addedLineCount:a};this.onModelChanging(b);this._model=d;b={type:"ModelChanged",
start:0,removedCharCount:l,addedCharCount:k,removedLineCount:j,addedLineCount:a};this.onModelChanged(b);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(d){var j=this._defaultOptions(),l;for(l in d)if(d.hasOwnProperty(l)){var a=d[l];if(!c(this["_"+l],a)){var k=j[l]?j[l].update:null;k?k.call(this,a):this["_"+l]=h(a)}}},setSelection:function(d,j,l,a){var k=
d>j;if(k)var b=d,d=j,j=b;b=this._model.getCharCount();d=Math.max(0,Math.min(d,b));j=Math.max(0,Math.min(j,b));this._setSelection(new n(d,j,k),l===void 0||l,!0,a)},setText:function(d,j,l){var a=j===void 0&&l===void 0;j===void 0&&(j=0);l===void 0&&(l=this._model.getCharCount());this._modifyContent({text:d,start:j,end:l,_code:!0},!a);if(a)this._columnX=-1,this._setSelection(new n(0,0,!1),!0),b.isFirefox&&this._fixCaret()},setTopIndex:function(d){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,
d))-this._getScroll().y)},setTopPixel:function(d){this._clientDiv&&this._scrollView(0,Math.max(0,d)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(d,j){this._clientDiv&&(d&&this._updateStyle(),j===void 0||j?this._update():this._queueUpdate())},_handleRootMouseDown:function(d){if(b.isFirefox&&d.which===1)this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0;var j=this._overlayDiv||this._clientDiv;if(b.isIE<9)j=
this._viewDiv;for(var l=d.target?d.target:d.srcElement;l;){if(j===l)return;l=l.parentNode}d.preventDefault&&d.preventDefault();d.stopPropagation&&d.stopPropagation();if(!this._isW3CEvents){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.focus()},0)}},_handleRootMouseUp:function(d){if(b.isFirefox&&d.which===1)this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=
!1;if(b.isIE<9&&!this._getSelection().isEmpty()){var d=this._rootDiv,j=b.createElement(d.ownerDocument,"div");d.appendChild(j);d.removeChild(j)}if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",d=this._getWindow(),j=this._selDiv1.ownerDocument,d.getSelection){j=d.getSelection();for(d=j.anchorNode;d;){if(d===this._clientDiv){j.rangeCount>0&&j.removeAllRanges();break}d=d.parentNode}}else if(j.selection){this._ignoreSelect=
!1;for(d=j.selection.createRange().parentElement();d;){if(d===this._clientDiv){j.selection.empty();break}d=d.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(d){b.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var j=!1;if(this.isListening("ContextMenu"))j=this._createMouseEvent("ContextMenu",d),j.screenX=d.screenX,j.screenY=d.screenY,this.onContextMenu(j),j=j.defaultPrevented;if(j)return d.preventDefault&&d.preventDefault(),
!1},_handleCopy:function(d){if(!this._ignoreCopy&&this._doCopy(d))return d.preventDefault&&d.preventDefault(),!1},_handleCut:function(d){if(this._doCut(d))return d.preventDefault&&d.preventDefault(),!1},_handleDataModified:function(){this._startIME()},_handleDblclick:function(d){this._lastMouseTime=d.timeStamp?d.timeStamp:(new Date).getTime();if(this._clickCount!==2)this._clickCount=2,this._handleMouse(d)},_handleDragStart:function(d){if(b.isFirefox){var j=this;this._getWindow().setTimeout(function(){j._clientDiv.contentEditable=
!0;j._clientDiv.draggable=!1;j._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&this._dragOffset!==-1)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",d)),this._dragOffset=-1;else return d.preventDefault&&d.preventDefault(),!1},_handleDrag:function(d){if(this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",d))},_handleDragEnd:function(d){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
d));b.isFirefox&&(this._fixCaret(),d.dataTransfer.dropEffect==="none"&&!d.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(d){var j=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(j=!1,this.onDragEnter(this._createMouseEvent("DragEnter",d)));if(b.isWebkit||j)return d.preventDefault&&d.preventDefault(),!1},_handleDragOver:function(d){var j=!0;this.isListening("DragOver")&&(j=!1,this.onDragOver(this._createMouseEvent("DragOver",d)));if(b.isWebkit||j){if(j)d.dataTransfer.dropEffect=
"none";d.preventDefault&&d.preventDefault();return!1}},_handleDragLeave:function(d){this._dropTarget=!1;if(this.isListening("DragLeave"))this.onDragLeave(this._createMouseEvent("DragLeave",d))},_handleDrop:function(d){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",d));d.preventDefault&&d.preventDefault();return!1},_handleFocus:function(){this._hasFocus=!0;b.isIOS&&this._lastTouchOffset!==void 0?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=
void 0):this._updateDOMSelection();if(this._selDiv1){var d=this._highlightRGB;this._selDiv1.style.background=d;this._selDiv2.style.background=d;this._selDiv3.style.background=d}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(d){var j=!1;switch(d.keyCode){case 16:case 17:case 18:case 91:j=!0;break;default:this._setLinksVisible(!1)}if(d.keyCode===229){if(this._readonly)return d.preventDefault&&d.preventDefault(),!1;j=!0;b.isSafari&&b.isMac&&d.ctrlKey&&(j=!1);j&&this._startIME()}else j||
this._commitIME();if((b.isMac||b.isLinux)&&b.isFirefox<4||b.isOpera)return this._keyDownEvent=d,!0;if(this._doAction(d))return d.preventDefault?(d.preventDefault(),d.stopPropagation()):(d.cancelBubble=!0,d.returnValue=!1,d.keyCode=0),!1},_handleKeyPress:function(d){if(b.isMac&&b.isWebkit&&(63232<=d.keyCode&&d.keyCode<=63487||d.keyCode===13||d.keyCode===8))return d.preventDefault&&d.preventDefault(),!1;if(((b.isMac||b.isLinux)&&b.isFirefox<4||b.isOpera)&&this._doAction(this._keyDownEvent))return d.preventDefault&&
d.preventDefault(),!1;var j=b.isMac?d.metaKey:d.ctrlKey;if(d.charCode!==void 0&&j)switch(d.charCode){case 99:case 118:case 120:return!0}j=!1;if(b.isMac){if(d.ctrlKey||d.metaKey)j=!0}else if(b.isFirefox){if(d.ctrlKey||d.altKey)j=!0}else d.ctrlKey^d.altKey&&(j=!0);if(!j&&(j=b.isOpera?d.which:d.charCode!==void 0?d.charCode:d.keyCode,j>31))return this._doContent(String.fromCharCode(j)),d.preventDefault&&d.preventDefault(),!1},_handleKeyUp:function(d){(b.isMac?d.metaKey:d.ctrlKey)||this._setLinksVisible(!1);
d.keyCode===13&&this._commitIME()},_handleLinkClick:function(d){if(!(b.isMac?d.metaKey:d.ctrlKey))return d.preventDefault&&d.preventDefault(),!1},_handleMouse:function(d){var j=this._getWindow(),l=!0,a=j;if(b.isIE||b.isFirefox&&!this._overlayDiv)a=this._clientDiv;if(this._overlayDiv){if(this._hasFocus)this._ignoreFocus=!0;var k=this;j.setTimeout(function(){k.focus();k._ignoreFocus=!1},0)}this._clickCount===1?(l=this._setSelectionTo(d.clientX,d.clientY,d.shiftKey,!b.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(a):(this._isW3CEvents&&this._setGrab(a),this._doubleClickSelection=null,this._setSelectionTo(d.clientX,d.clientY,d.shiftKey),this._doubleClickSelection=this._getSelection());return l},_handleMouseDown:function(d){if(this._linksVisible)if((d.target||d.srcElement).tagName!=="A")this._setLinksVisible(!1);else return;this._commitIME();var j=d.which;j||(d.button===4&&(j=2),d.button===2&&(j=3),d.button===1&&(j=1));var l=j!==2&&d.timeStamp?d.timeStamp:(new Date).getTime(),a=l-this._lastMouseTime,
k=Math.abs(this._lastMouseX-d.clientX),g=Math.abs(this._lastMouseY-d.clientY),c=this._lastMouseButton===j;this._lastMouseX=d.clientX;this._lastMouseY=d.clientY;this._lastMouseTime=l;this._lastMouseButton=j;if(j===1)this._isMouseDown=!0,c&&a<=this._clickTime&&k<=this._clickDist&&g<=this._clickDist?this._clickCount++:this._clickCount=1;if(this.isListening("MouseDown")&&(l=this._createMouseEvent("MouseDown",d),this.onMouseDown(l),l.defaultPrevented)){d.preventDefault();return}if(j===1&&this._handleMouse(d)&&
(b.isIE>=9||b.isOpera||b.isChrome||b.isSafari||b.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),d.preventDefault();b.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()},_handleMouseOver:function(d){if(!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",d))},_handleMouseOut:function(d){if(!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",d))},_handleMouseMove:function(d){if(!this._animation){var j=
this._isClientDiv(d);if(this.isListening("MouseMove")&&j)this.onMouseMove(this._createMouseEvent("MouseMove",d));if(!this._dropTarget){var l=this._linksVisible||this._lastMouseMoveX!==d.clientX||this._lastMouseMoveY!==d.clientY;this._lastMouseMoveX=d.clientX;this._lastMouseMoveY=d.clientY;this._setLinksVisible(l&&!this._isMouseDown&&(b.isMac?d.metaKey:d.ctrlKey));if(!this._isW3CEvents){if(d.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&d.button===1&&(this._clickCount&1)!==0&&j)return this._clickCount=
2,this._handleMouse(d,this._clickCount)}if(this._isMouseDown&&this._dragOffset===-1){var j=d.clientX,d=d.clientY,a=this._getViewPadding(),k=this._viewDiv.getBoundingClientRect(),g=this._getClientWidth(),c=this._getClientHeight(),l=k.left+a.left,f=k.top+a.top,g=k.left+a.left+g,a=k.top+a.top+c,k=this._model,c=k.getLineAtOffset(this._getSelection().getCaret());d<f&&c!==0?this._doAutoScroll("up",j,d-f):d>a&&c!==k.getLineCount()-1?this._doAutoScroll("down",j,d-a):j<l&&!this._wrapMode?this._doAutoScroll("left",
j-l,d):j>g&&!this._wrapMode?this._doAutoScroll("right",j-g,d):(this._endAutoScroll(),this._setSelectionTo(j,d,!0))}}}},_isClientDiv:function(d){for(var j=this._overlayDiv||this._clientDiv,d=d.target?d.target:d.srcElement;d;){if(j===d)return!0;d=d.parentNode}return!1},_createMouseEvent:function(d,j){var l=this.convert({x:j.clientX,y:j.clientY},"page","document");return{type:d,event:j,clickCount:this._clickCount,x:l.x,y:l.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(d){var j=
d.which?d.button===0:d.button===1;if(this.isListening("MouseUp")&&(this._isClientDiv(d)||j&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",d));if(!this._linksVisible&&j&&this._isMouseDown){if(this._dragOffset!==-1)j=this._getSelection(),j.extend(this._dragOffset),j.collapse(),this._setSelection(j,!0,!0),this._dragOffset=-1;this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null);b.isFirefox&&d.preventDefault()}},_handleMouseWheel:function(d){var j=this._getLineHeight(),
l=0,a=0;b.isIE||b.isOpera?a=-d.wheelDelta/40*j:b.isFirefox?(j=b.isMac?d.detail*3:Math.max(-256,Math.min(256,d.detail))*j,d.axis===d.HORIZONTAL_AXIS?l=j:a=j):b.isMac?(a=l=40,d.wheelDeltaX%120!==0&&(l=1),d.wheelDeltaY%120!==0&&(a=1),l=-d.wheelDeltaX/l,-1<l&&l<0&&(l=-1),0<l&&l<1&&(l=1),a=-d.wheelDeltaY/a,-1<a&&a<0&&(a=-1),0<a&&a<1&&(a=1)):(l=-d.wheelDeltaX,a=-d.wheelDeltaY/120*8*j);if(b.isSafari){for(j=d.target;j&&j.lineIndex===void 0;)j=j.parentNode;this._mouseWheelLine=j}j=this._getScroll();this._scrollView(l,
a);l=this._getScroll();if(j.x!==l.x||j.y!==l.y)return d.preventDefault&&d.preventDefault(),!1},_handlePaste:function(d){if(!this._ignorePaste&&this._doPaste(d)){if(b.isIE){var j=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){j._updateDOMSelection();j._ignoreFocus=!1},0)}d.preventDefault&&d.preventDefault();return!1}},_handleResize:function(){var d=this._parent.clientWidth,j=this._parent.clientHeight;if(this._parentWidth!==d||this._parentHeight!==j)this._parentWidth!==d&&this._resetLineHeight(),
this._parentWidth=d,this._parentHeight=j,b.isIE<9?this._queueUpdate():this._update()},_handleRulerEvent:function(d){for(var j=d.target?d.target:d.srcElement,a=j.lineIndex;j&&!j._ruler;){if(a===void 0&&j.lineIndex!==void 0)a=j.lineIndex;j=j.parentNode}j=j?j._ruler:null;if(a===void 0&&j&&j.getOverview()==="document"){var a=this._getClientHeight(),b=this._model.getLineCount(),k=this._getViewPadding(),g=this._viewDiv.getBoundingClientRect(),a=Math.floor((d.clientY-g.top-this._metrics.scrollWidth)*b/(a+
k.top+k.bottom-2*this._metrics.scrollWidth));0<=a&&a<b||(a=void 0)}if(j)switch(d.type){case "click":if(j.onClick)j.onClick(a,d);break;case "dblclick":if(j.onDblClick)j.onDblClick(a,d);break;case "mousemove":if(j.onMouseMove)j.onMouseMove(a,d);break;case "mouseover":if(j.onMouseOver)j.onMouseOver(a,d);break;case "mouseout":if(j.onMouseOut)j.onMouseOut(a,d)}},_handleScroll:function(){var d=this._getScroll(!1),j=this._hScroll,a=this._vScroll;if(j!==d.x||a!==d.y)this._hScroll=d.x,this._vScroll=d.y,this._commitIME(),
this._update(a===d.y),this.onScroll({type:"Scroll",oldValue:{x:j,y:a},newValue:d})},_handleSelectStart:function(d){if(this._ignoreSelect)return d&&d.preventDefault&&d.preventDefault(),!1},_getModelOffset:function(d,j){if(d){var a;a=d.tagName==="DIV"?d:d.parentNode.parentNode;var b=0,k=a.lineIndex;if(d.tagName!=="DIV")for(a=a.firstChild;a;){var g=a.firstChild;if(g===d){a.ignoreChars&&(b-=a.ignoreChars);b+=j;break}a.ignoreChars&&(b-=a.ignoreChars);b+=g.data.length;a=a.nextSibling}return Math.max(0,
b)+this._model.getLineStart(k)}},_updateSelectionFromDOM:function(){var d=this._getWindow().getSelection(),j=this._getModelOffset(d.anchorNode,d.anchorOffset),d=this._getModelOffset(d.focusNode,d.focusOffset);j===void 0||d===void 0||this._setSelection(new n(j,d),!1,!1)},_handleSelectionChange:function(){if(this._imeOffset===-1)if(b.isAndroid){var d=this._getWindow();this._selTimer&&d.clearTimeout(this._selTimer);var j=this;this._selTimer=d.setTimeout(function(){if(j._clientDiv)j._selTimer=null,j._updateSelectionFromDOM()},
250)}else this._updateSelectionFromDOM()},_handleTextInput:function(d){this._imeOffset=-1;if(b.isAndroid){for(var j=this._getWindow().getSelection(),a=j.anchorNode;a;){if(a.lineIndex!==void 0)break;a=a.parentNode}if(a){var g=this._model,k=a.lineIndex,c=g.getLine(k),f=c,e=0,g=g.getLineStart(k);if(j.rangeCount>0)j.getRangeAt(0).deleteContents(),k=a.ownerDocument.createTextNode(d.data),j.getRangeAt(0).insertNode(k),e=this._getDOMText(a,k),f=e.text,e=e.offset,k.parentNode.removeChild(k);a.lineRemoved=
!0;for(a=0;c.charCodeAt(a)===f.charCodeAt(a)&&a<e;)a++;j=c.length-1;for(k=f.length-c.length;c.charCodeAt(j)===f.charCodeAt(j+k)&&j+k>=e+d.data.length;)j--;j++;c=f.substring(a,j+k);a+=g;j+=g;this._modifyContent({text:c,start:a,end:j,_ignoreDOMSelection:!0},!0)}}else this._doContent(d.data);d.preventDefault()},_handleTouchStart:function(d){this._commitIME();var j=this._getWindow();if(this._touchScrollTimer)this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",j.clearInterval(this._touchScrollTimer),
this._touchScrollTimer=null;var a=d.touches;if(a.length===1){var a=a[0],g=a.clientX,k=a.clientY;this._touchStartX=g;this._touchStartY=k;if(b.isAndroid&&(k<a.pageY-j.pageYOffset||g<a.pageX-j.pageXOffset))g=a.pageX-j.pageXOffset,k=a.pageY-j.pageYOffset;j=this.convert({x:g,y:k},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(j.x,j.y);this._touchStartTime=d.timeStamp;this._touching=!0}},_handleTouchMove:function(d){var j=d.touches;if(j.length===1){j=j[0];this._touchCurrentX=j.clientX;
this._touchCurrentY=j.clientY;if(!this._touchScrollTimer&&d.timeStamp-this._touchStartTime<200){this._vScrollDiv.style.display="block";if(!this._wrapMode)this._hScrollDiv.style.display="block";var a=this,b=this._getWindow();this._touchScrollTimer=b.setInterval(function(){var d=0,j=0;if(a._touching)d=a._touchStartX-a._touchCurrentX,j=a._touchStartY-a._touchCurrentY,a._touchSpeedX=d/10,a._touchSpeedY=j/10,a._touchStartX=a._touchCurrentX,a._touchStartY=a._touchCurrentY;else if(Math.abs(a._touchSpeedX)<
0.1&&Math.abs(a._touchSpeedY)<0.1){a._vScrollDiv.style.display="none";a._hScrollDiv.style.display="none";b.clearInterval(a._touchScrollTimer);a._touchScrollTimer=null;return}else d=a._touchSpeedX*10,j=a._touchSpeedY*10,a._touchSpeedX*=0.95,a._touchSpeedY*=0.95;a._scrollView(d,j)},10)}this._touchScrollTimer&&d.preventDefault()}},_handleTouchEnd:function(d){if(d.touches.length===0)this._touching=!1},_doAction:function(d){for(var j=this._keyBindings,a=0;a<j.length;a++){var b=j[a];if(b.keyBinding.match(d)){if(b.actionID&&
(d=this._actions[b.actionID]))if(d.handler){if(!d.handler())return d.defaultHandler?typeof d.defaultHandler()==="boolean":!1}else if(d.defaultHandler)return typeof d.defaultHandler()==="boolean";return!0}}return!1},_doBackspace:function(d){var j=this._getSelection();if(j.isEmpty()){var a=this._model,b=j.getCaret(),k=a.getLineAtOffset(b),g=a.getLineStart(k);if(b===g)k>0&&j.extend(a.getLineEnd(k-1));else{var c=!1;this._expandTab&&d.unit==="character"&&(b-g)%this._tabSize===0&&(c=!/[^ ]/.test(a.getText(g,
b)));c?j.extend(b-this._tabSize):(a=this._getLine(k),j.extend(a.getNextOffset(b,d.unit,-1)),a.destroy())}}this._modifyContent({text:"",start:j.start,end:j.end},!0);return!0},_doContent:function(d){var j=this._getSelection();this._modifyContent({text:d,start:j.start,end:j.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(d){var j=this._getSelection();return!j.isEmpty()?this._setClipboardText(this._getBaseText(j.start,j.end),d):!0},_doCursorNext:function(d){if(!d.select&&this._clearSelection("next"))return!0;
var j=this._model,a=this._getSelection(),b=a.getCaret(),k=j.getLineAtOffset(b);b===j.getLineEnd(k)?k+1<j.getLineCount()&&a.extend(j.getLineStart(k+1)):(j=this._getLine(k),a.extend(j.getNextOffset(b,d.unit,1)),j.destroy());d.select||a.collapse();this._setSelection(a,!0);return!0},_doCursorPrevious:function(d){if(!d.select&&this._clearSelection("previous"))return!0;var j=this._model,a=this._getSelection(),b=a.getCaret(),k=j.getLineAtOffset(b);b===j.getLineStart(k)?k>0&&a.extend(j.getLineEnd(k-1)):(j=
this._getLine(k),a.extend(j.getNextOffset(b,d.unit,-1)),j.destroy());d.select||a.collapse();this._setSelection(a,!0);return!0},_doCut:function(d){var j=this._getSelection();return!j.isEmpty()?(j=this._getBaseText(j.start,j.end),this._doContent(""),this._setClipboardText(j,d)):!0},_doDelete:function(d){var j=this._getSelection();if(j.isEmpty()){var a=this._model,b=j.getCaret(),k=a.getLineAtOffset(b);b===a.getLineEnd(k)?k+1<a.getLineCount()&&j.extend(a.getLineStart(k+1)):(a=this._getLine(k),j.extend(a.getNextOffset(b,
d.unit,1)),a.destroy())}this._modifyContent({text:"",start:j.start,end:j.end},!0);return!0},_doEnd:function(d){var j=this._getSelection(),a=this._model,b;if(d.ctrl)j.extend(a.getCharCount()),b=function(){};else{var k=j.getCaret(),g=a.getLineAtOffset(k);if(this._wrapMode){var c=this._getLine(g),k=c.getLineIndex(k),k=k===c.getLineCount()-1?a.getLineEnd(g):c.getLineStart(k+1)-1;c.destroy()}else k=a.getLineEnd(g);j.extend(k)}d.select||j.collapse();this._setSelection(j,!0,!0,b);return!0},_doEnter:function(d){var j=
this._model,a=this._getSelection();this._doContent(j.getLineDelimiter());if(d&&d.noCursor)a.end=a.start,this._setSelection(a,!0);return!0},_doHome:function(d){var j=this._getSelection(),a=this._model,b;if(d.ctrl)j.extend(0),b=function(){};else{var k=j.getCaret(),g=a.getLineAtOffset(k);this._wrapMode?(a=this._getLine(g),k=a.getLineIndex(k),k=a.getLineStart(k),a.destroy()):k=a.getLineStart(g);j.extend(k)}d.select||j.collapse();this._setSelection(j,!0,!0,b);return!0},_doLineDown:function(d){var j=this._model,
a=this._getSelection(),g=a.getCaret(),k=j.getLineAtOffset(g),c=this._getLine(k),f=this._columnX,e=1,p=!1;if(f===-1||d.wholeLine||d.select&&b.isIE)f=d.wholeLine?j.getLineEnd(k+1):g,f=c.getBoundingClientRect(f).left;(g=c.getLineIndex(g))<c.getLineCount()-1?e=c.getClientRects(g+1).top+1:(p=k===j.getLineCount()-1,k++);p?d.select&&(a.extend(j.getCharCount()),this._setSelection(a,!0,!0)):(c.lineIndex!==k&&(c.destroy(),c=this._getLine(k)),a.extend(c.getOffset(f,e)),d.select||a.collapse(),this._setSelection(a,
!0,!0));this._columnX=f;c.destroy();return!0},_doLineUp:function(d){var j=this._model,a=this._getSelection(),g=a.getCaret(),k=j.getLineAtOffset(g),c=this._getLine(k),f=this._columnX,e=!1,p;if(f===-1||d.wholeLine||d.select&&b.isIE)f=d.wholeLine?j.getLineStart(k-1):g,f=c.getBoundingClientRect(f).left;(g=c.getLineIndex(g))>0?p=c.getClientRects(g-1).top+1:(e=k===0,e||(k--,p=this._getLineHeight(k)-1));e?d.select&&(a.extend(0),this._setSelection(a,!0,!0)):(c.lineIndex!==k&&(c.destroy(),c=this._getLine(k)),
a.extend(c.getOffset(f,p)),d.select||a.collapse(),this._setSelection(a,!0,!0));this._columnX=f;c.destroy();return!0},_doPageDown:function(d){var a=this,l=this._model,g=this._getSelection(),k=g.getCaret(),c=l.getLineAtOffset(k),f=l.getLineCount(),e=this._getScroll(),l=this._getClientHeight(),p,n;if(this._lineHeight){p=this._columnX;e=this._getBoundsAtOffset(k);if(p===-1||d.select&&b.isIE)p=e.left;k=this._getLineIndex(e.top+l);n=this._getLine(k);c=this._getLinePixel(k);k=n.getOffset(p,e.top+l-c);l=
n.getBoundingClientRect(k);n.destroy();g.extend(k);d.select||g.collapse();this._setSelection(g,!0,!0,function(){a._columnX=p},l.top+c-e.top);return!0}if(c<f-1){var h=this._getLineHeight(),o=Math.min(f-c-1,Math.floor(l/h)),o=Math.max(1,o);p=this._columnX;if(p===-1||d.select&&b.isIE)n=this._getLine(c),p=n.getBoundingClientRect(k).left,n.destroy();n=this._getLine(c+o);g.extend(n.getOffset(p,0));n.destroy();d.select||g.collapse();d=f*h;k=e.y+o*h;k+l>d&&(k=d-l);this._setSelection(g,!0,!0,function(){a._columnX=
p},k-e.y)}return!0},_doPageUp:function(d){var a=this,l=this._model,g=this._getSelection(),k=g.getCaret(),c=l.getLineAtOffset(k),f=this._getScroll(),e=this._getClientHeight(),p;if(this._lineHeight){p=this._columnX;f=this._getBoundsAtOffset(k);if(p===-1||d.select&&b.isIE)p=f.left;k=this._getLineIndex(f.bottom-e);l=this._getLine(k);c=this._getLinePixel(k);k=l.getOffset(p,f.bottom-e-c);e=l.getBoundingClientRect(k);l.destroy();g.extend(k);d.select||g.collapse();this._setSelection(g,!0,!0,function(){a._columnX=
p},e.top+c-f.top);return!0}if(c>0){var n=this._getLineHeight(),e=Math.max(1,Math.min(c,Math.floor(e/n)));p=this._columnX;if(p===-1||d.select&&b.isIE)l=this._getLine(c),p=l.getBoundingClientRect(k).left,l.destroy();l=this._getLine(c-e);g.extend(l.getOffset(p,this._getLineHeight(c-e)-1));l.destroy();d.select||g.collapse();d=Math.max(0,f.y-e*n);this._setSelection(g,!0,!0,function(){a._columnX=p},d-f.y)}return!0},_doPaste:function(d){var a=this;return this._getClipboardText(d,function(d){d&&(b.isLinux&&
a._lastMouseButton===2&&(new Date).getTime()-a._lastMouseTime<=a._clickTime&&a._setSelectionTo(a._lastMouseX,a._lastMouseY),a._doContent(d))})!==null},_doScroll:function(d){var a=d.type,b=this._model,g=b.getLineCount(),d=this._getClientHeight(),k=this._getLineHeight();g*=k;var c=this._getScroll().y,f;switch(a){case "textStart":f=0;break;case "textEnd":f=g-d;break;case "pageDown":f=c+d;break;case "pageUp":f=c-d;break;case "lineDown":f=c+k;break;case "lineUp":f=c-k;break;case "centerLine":a=this._getSelection(),
f=b.getLineAtOffset(a.start),b=(b.getLineAtOffset(a.end)-f+1)*k,f=f*k-d/2+b/2}f!==void 0&&(f=Math.min(Math.max(0,f),g-d),this._scrollViewAnimated(0,f-c,function(){}));return!0},_doSelectAll:function(){var d=this._model,a=this._getSelection();a.setCaret(0);a.extend(d.getCharCount());this._setSelection(a,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var d="\t";if(this._expandTab)var a=this._model,d=this._getSelection().getCaret(),b=a.getLineAtOffset(d),a=a.getLineStart(b),d=Array(this._tabSize-
(d-a)%this._tabSize+1).join(" ");this._doContent(d);return!0}},_doShiftTab:function(){return!this._tabMode||this._readonly?void 0:!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var d=this._getSelection(),a=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),b=d.getCaret(),g=this._model.getLineAtOffset(b),k;if(this._autoScrollDir==="up"||this._autoScrollDir===
"down")b=this._autoScrollY/this._getLineHeight(),b=b<0?Math.floor(b):Math.ceil(b),k=g,k=Math.max(0,Math.min(this._model.getLineCount()-1,k+b));else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")k=this._getLineIndex(a.y),g=this._getLine(g),a.x+=g.getBoundingClientRect(b,!1).left,g.destroy();g=this._getLine(k);d.extend(g.getOffset(a.x,a.y-this._getLinePixel(k)));g.destroy();this._setSelection(d,!0)},_autoScrollTimer:function(){this._autoScroll();var d=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){d._autoScrollTimer()},
this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(d){if(this._lineHeight&&!this._calculateLHTimer){var a=this._model.getLineCount(),b=0;if(d){for(var d=0,g=(new Date).getTime(),k=0;b<a;)if(this._lineHeight[b]||(d++,k||(k=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,(new Date).getTime()-g>100)break;this.redrawRulers(0,a);this._queueUpdate()}d=this._getWindow();if(b!==a){var c=this;this._calculateLHTimer=d.setTimeout(function(){c._calculateLHTimer=null;c._calculateLineHeightTimer(!0)},
0)}else if(this._calculateLHTimer)d.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0}},_calculateLineHeight:function(d){var d=this._getLine(d),a=d.getBoundingClientRect();d.destroy();return Math.max(1,Math.ceil(a.bottom-a.top))},_calculateMetrics:function(){var d=this._clientDiv,a=d.ownerDocument,l=b.createElement(a,"div");l.style.lineHeight="normal";var c={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(c);f(c.style,l);l.style.position=
"fixed";l.style.left="-1000px";var k=b.createElement(a,"span");k.appendChild(a.createTextNode(" "));l.appendChild(k);var e=b.createElement(a,"span");e.style.fontStyle="italic";e.appendChild(a.createTextNode(" "));l.appendChild(e);var n=b.createElement(a,"span");n.style.fontWeight="bold";n.appendChild(a.createTextNode(" "));l.appendChild(n);c=b.createElement(a,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(a.createTextNode(" "));l.appendChild(c);d.appendChild(l);var h=l.getBoundingClientRect(),
k=k.getBoundingClientRect(),e=e.getBoundingClientRect(),n=n.getBoundingClientRect(),c=c.getBoundingClientRect(),k=k.bottom-k.top,e=e.bottom-e.top,n=n.bottom-n.top,o=c.bottom-c.top,s=0,c=h.bottom-h.top<=0,h=Math.max(1,h.bottom-h.top);e>k&&(s=1);n>e&&(s=2);o>n&&(s=3);var i;if(s!==0){i={style:{}};if((s&1)!==0)i.style.fontStyle="italic";if((s&2)!==0)i.style.fontWeight="bold"}k=p(l);d.removeChild(l);e=g(this._viewDiv);l=b.createElement(a,"div");l.style.position="fixed";l.style.left="-1000px";l.style.paddingLeft=
e.left+"px";l.style.paddingTop=e.top+"px";l.style.paddingRight=e.right+"px";l.style.paddingBottom=e.bottom+"px";l.style.width="100px";l.style.height="100px";n=b.createElement(a,"div");n.style.width="100%";n.style.height="100%";l.appendChild(n);d.appendChild(l);a=l.getBoundingClientRect();e=n.getBoundingClientRect();l.style.overflow="hidden";n.style.height="200px";n=l.clientWidth;l.style.overflow="scroll";o=l.clientWidth;d.removeChild(l);e={left:e.left-a.left,top:e.top-a.top,right:a.right-e.right,
bottom:a.bottom-e.bottom};return{lineHeight:h,largestFontStyle:i,lineTrim:k,viewPadding:e,scrollWidth:n-o,invalid:c}},_cancelAnimation:function(){if(this._animation)this._animation.stop(),this._animation=null},_clearSelection:function(d){var a=this._getSelection();if(a.isEmpty())return!1;d==="next"?a.start=a.end:a.end=a.start;this._setSelection(a,!0);return!0},_commitIME:function(){if(this._imeOffset!==-1){this._scrollDiv.focus();this._clientDiv.focus();var d=this._model,a=d.getLineAtOffset(this._imeOffset),
b=d.getLineStart(a),g=this._getDOMText(this._getLineNode(a)).text,d=d.getLine(a),b=this._imeOffset-b,d=b+g.length-d.length;b!==d&&this._doContent(g.substring(b,d));this._imeOffset=-1}},_createActions:function(){var d=q.KeyBinding,a=this._keyBindings=[];a.push({actionID:"lineUp",keyBinding:new d(38),predefined:!0});a.push({actionID:"lineDown",keyBinding:new d(40),predefined:!0});a.push({actionID:"charPrevious",keyBinding:new d(37),predefined:!0});a.push({actionID:"charNext",keyBinding:new d(39),predefined:!0});
b.isMac?(a.push({actionID:"scrollPageUp",keyBinding:new d(33),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new d(34),predefined:!0}),a.push({actionID:"pageUp",keyBinding:new d(33,null,null,!0),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new d(34,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(37,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(39,!0),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new d(37,null,null,
!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new d(39,null,null,!0),predefined:!0}),a.push({actionID:"scrollTextStart",keyBinding:new d(36),predefined:!0}),a.push({actionID:"scrollTextEnd",keyBinding:new d(35),predefined:!0}),a.push({actionID:"textStart",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new d(40,!0),predefined:!0}),a.push({actionID:"scrollPageUp",keyBinding:new d(38,null,null,null,!0),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new d(40,
null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(37,null,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(39,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(38,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(40,null,null,!0),predefined:!0})):(a.push({actionID:"pageUp",keyBinding:new d(33),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new d(34),predefined:!0}),a.push({actionID:"lineStart",
keyBinding:new d(36),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(35),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new d(37,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new d(39,!0),predefined:!0}),a.push({actionID:"textStart",keyBinding:new d(36,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new d(35,!0),predefined:!0}));b.isFirefox&&b.isLinux&&(a.push({actionID:"lineUp",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new d(40,
!0),predefined:!0}));b.isWindows&&(a.push({actionID:"scrollLineUp",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"scrollLineDown",keyBinding:new d(40,!0),predefined:!0}));a.push({actionID:"selectLineUp",keyBinding:new d(38,null,!0),predefined:!0});a.push({actionID:"selectLineDown",keyBinding:new d(40,null,!0),predefined:!0});a.push({actionID:"selectCharPrevious",keyBinding:new d(37,null,!0),predefined:!0});a.push({actionID:"selectCharNext",keyBinding:new d(39,null,!0),predefined:!0});a.push({actionID:"selectPageUp",
keyBinding:new d(33,null,!0),predefined:!0});a.push({actionID:"selectPageDown",keyBinding:new d(34,null,!0),predefined:!0});b.isMac?(a.push({actionID:"selectLineStart",keyBinding:new d(37,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(39,!0,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new d(37,null,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",keyBinding:new d(39,null,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(36,
null,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(35,null,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(38,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(40,!0,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new d(37,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(39,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new d(38,null,!0,!0),predefined:!0}),
a.push({actionID:"selectLineEnd",keyBinding:new d(40,null,!0,!0),predefined:!0})):(b.isLinux&&(a.push({actionID:"selectWholeLineUp",keyBinding:new d(38,!0,!0),predefined:!0}),a.push({actionID:"selectWholeLineDown",keyBinding:new d(40,!0,!0),predefined:!0})),a.push({actionID:"selectLineStart",keyBinding:new d(36,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(35,null,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new d(37,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",
keyBinding:new d(39,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(36,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(35,!0,!0),predefined:!0}));a.push({actionID:"undo",keyBinding:new q.KeyBinding("z",!0),predefined:!0});b.isMac?a.push({actionID:"redo",keyBinding:new q.KeyBinding("z",!0,!0),predefined:!0}):a.push({actionID:"redo",keyBinding:new q.KeyBinding("y",!0),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new d(8),predefined:!0});
a.push({actionID:"deletePrevious",keyBinding:new d(8,null,!0),predefined:!0});a.push({actionID:"deleteNext",keyBinding:new d(46),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0,!0),predefined:!0});a.push({actionID:"deleteWordNext",keyBinding:new d(46,!0),predefined:!0});a.push({actionID:"tab",keyBinding:new d(9),predefined:!0});a.push({actionID:"shiftTab",keyBinding:new d(9,null,!0),predefined:!0});
a.push({actionID:"enter",keyBinding:new d(13),predefined:!0});a.push({actionID:"enter",keyBinding:new d(13,null,!0),predefined:!0});a.push({actionID:"selectAll",keyBinding:new d("a",!0),predefined:!0});a.push({actionID:"toggleTabMode",keyBinding:new d("m",!0),predefined:!0});b.isMac&&(a.push({actionID:"deleteNext",keyBinding:new d(46,null,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,null,null,!0),predefined:!0}),a.push({actionID:"deleteWordNext",keyBinding:new d(46,
null,null,!0),predefined:!0}));if(!b.isFirefox){var g=b.isMac&&b.isChrome;a.push({actionID:null,keyBinding:new d("u",!g,!1,!1,g),predefined:!0});a.push({actionID:null,keyBinding:new d("i",!g,!1,!1,g),predefined:!0});a.push({actionID:null,keyBinding:new d("b",!g,!1,!1,g),predefined:!0})}b.isFirefox&&(a.push({actionID:"copy",keyBinding:new d(45,!0),predefined:!0}),a.push({actionID:"paste",keyBinding:new d(45,null,!0),predefined:!0}),a.push({actionID:"cut",keyBinding:new d(46,null,!0),predefined:!0}));
b.isMac&&(a.push({actionID:"lineStart",keyBinding:new d("a",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d("e",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineUp",keyBinding:new d("p",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new d("n",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charPrevious",keyBinding:new d("b",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charNext",keyBinding:new d("f",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deletePrevious",
keyBinding:new d("h",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteNext",keyBinding:new d("d",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineEnd",keyBinding:new d("k",!1,!1,!1,!0),predefined:!0}),b.isFirefox?(a.push({actionID:"scrollPageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineStart",keyBinding:new d("u",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new d("w",!1,!1,!1,!0),predefined:!0})):(a.push({actionID:"pageDown",
keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"centerLine",keyBinding:new d("l",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"enterNoCursor",keyBinding:new d("o",!1,!1,!1,!0),predefined:!0})));var c=this;this._actions={lineUp:{defaultHandler:function(){return c._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return c._doLineDown({select:!1})}},lineStart:{defaultHandler:function(){return c._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return c._doEnd({select:!1,
ctrl:!1})}},charPrevious:{defaultHandler:function(){return c._doCursorPrevious({select:!1,unit:"character"})}},charNext:{defaultHandler:function(){return c._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return c._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return c._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return c._doScroll({type:"pageUp"})}},scrollPageDown:{defaultHandler:function(){return c._doScroll({type:"pageDown"})}},
scrollLineUp:{defaultHandler:function(){return c._doScroll({type:"lineUp"})}},scrollLineDown:{defaultHandler:function(){return c._doScroll({type:"lineDown"})}},wordPrevious:{defaultHandler:function(){return c._doCursorPrevious({select:!1,unit:"word"})}},wordNext:{defaultHandler:function(){return c._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return c._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return c._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return c._doScroll({type:"textStart"})}},
scrollTextEnd:{defaultHandler:function(){return c._doScroll({type:"textEnd"})}},centerLine:{defaultHandler:function(){return c._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return c._doLineUp({select:!0})}},selectLineDown:{defaultHandler:function(){return c._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return c._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return c._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return c._doHome({select:!0,
ctrl:!1})}},selectLineEnd:{defaultHandler:function(){return c._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return c._doCursorPrevious({select:!0,unit:"character"})}},selectCharNext:{defaultHandler:function(){return c._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return c._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return c._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return c._doCursorPrevious({select:!0,
unit:"word"})}},selectWordNext:{defaultHandler:function(){return c._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return c._doHome({select:!0,ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return c._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return c._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return c._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return c._doBackspace({unit:"word"})}},
deleteWordNext:{defaultHandler:function(){return c._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return c._doBackspace({unit:"line"})}},deleteLineEnd:{defaultHandler:function(){return c._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return c._doTab()}},shiftTab:{defaultHandler:function(){return c._doShiftTab()}},enter:{defaultHandler:function(){return c._doEnter()}},enterNoCursor:{defaultHandler:function(){return c._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return c._doSelectAll()}},
copy:{defaultHandler:function(){return c._doCopy()}},cut:{defaultHandler:function(){return c._doCut()}},paste:{defaultHandler:function(){return c._doPaste()}},toggleWrapMode:{defaultHandler:function(){return c._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return c._doTabMode()}}}},_createRuler:function(d,a){if(this._clientDiv){var c=d.getLocation()==="left"?this._leftDiv:this._rightDiv;c.style.display="block";var g=b.createElement(c.ownerDocument,"div");g._ruler=d;g.rulerChanged=!0;g.style.position=
"relative";g.style.cssFloat="left";g.style.styleFloat="left";g.style.borderWidth="0px";g.style.margin="0px";g.style.padding="0px";g.style.outline="none";if(a===void 0||a<0||a>=c.children.length)c.appendChild(g);else{for(var k=c.firstChild;k&&--a>0;)k=k.nextSibling;c.insertBefore(g,k)}}},_createView:function(){if(!this._clientDiv){for(var d=this._parent;d.hasChildNodes();)d.removeChild(d.lastChild);var a=d.ownerDocument,c=b.createElement(a,"div");this._rootDiv=c;c.tabIndex=-1;c.style.position="relative";
c.style.overflow="hidden";c.style.width="100%";c.style.height="100%";c.style.overflow="hidden";c.style.WebkitTextSizeAdjust="100%";c.setAttribute("role","application");d.appendChild(c);d=b.createElement(a,"div");d.className="textviewLeftRuler";this._leftDiv=d;d.tabIndex=-1;d.style.overflow="hidden";d.style.MozUserSelect="none";d.style.WebkitUserSelect="none";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.cursor="default";d.style.display="none";d.setAttribute("aria-hidden",
"true");c.appendChild(d);d=b.createElement(a,"div");d.className="textviewScroll";this._viewDiv=d;d.tabIndex=-1;d.style.overflow="auto";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.outline="none";d.style.background="transparent";if(b.isMac&&b.isWebkit)d.style.pointerEvents="none",d.style.zIndex="2";c.appendChild(d);var g=b.createElement(a,"div");g.className="textviewRightRuler";this._rightDiv=g;g.tabIndex=-1;g.style.display=
"none";g.style.overflow="hidden";g.style.MozUserSelect="none";g.style.WebkitUserSelect="none";g.style.position="absolute";g.style.top="0px";g.style.bottom="0px";g.style.cursor="default";g.style.right="0px";g.setAttribute("aria-hidden","true");c.appendChild(g);this._scrollDiv=g=b.createElement(a,"div");g.style.margin="0px";g.style.borderWidth="0px";g.style.padding="0px";d.appendChild(g);if(b.isFirefox)this._clipboardDiv=d=b.createElement(a,"div"),d.style.position="fixed",d.style.whiteSpace="pre",d.style.left=
"-1000px",c.appendChild(d);if(!b.isIE&&!b.isIOS)this._clipDiv=d=b.createElement(a,"div"),d.style.position="absolute",d.style.overflow="hidden",d.style.margin="0px",d.style.borderWidth="0px",d.style.padding="0px",d.style.background="transparent",c.appendChild(d),this._clipScrollDiv=g=b.createElement(a,"div"),g.style.position="absolute",g.style.height="1px",g.style.top="-1000px",g.style.background="transparent",d.appendChild(g);this._setFullSelection(this._fullSelection,!0);d=b.createElement(a,"div");
d.className="textviewContent";this._clientDiv=d;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.zIndex="1";d.style.WebkitUserSelect="text";d.setAttribute("spellcheck","false");if(b.isIOS||b.isAndroid)d.style.WebkitTapHighlightColor="transparent";(this._clipDiv||c).appendChild(d);if(b.isIOS||b.isAndroid)this._vScrollDiv=g=b.createElement(a,"div"),g.style.position="absolute",g.style.borderWidth="1px",g.style.borderColor=
"white",g.style.borderStyle="solid",g.style.borderRadius="4px",g.style.backgroundColor="black",g.style.opacity="0.5",g.style.margin="0px",g.style.padding="0px",g.style.outline="none",g.style.zIndex="3",g.style.width="8px",g.style.display="none",c.appendChild(g),this._hScrollDiv=g=b.createElement(a,"div"),g.style.position="absolute",g.style.borderWidth="1px",g.style.borderColor="white",g.style.borderStyle="solid",g.style.borderRadius="4px",g.style.backgroundColor="black",g.style.opacity="0.5",g.style.margin=
"0px",g.style.padding="0px",g.style.outline="none",g.style.zIndex="3",g.style.height="8px",g.style.display="none",c.appendChild(g);if(b.isFirefox&&!d.setCapture)this._overlayDiv=a=b.createElement(a,"div"),a.style.position=d.style.position,a.style.borderWidth=d.style.borderWidth,a.style.margin=d.style.margin,a.style.padding=d.style.padding,a.style.cursor="text",a.style.zIndex="2",(this._clipDiv||c).appendChild(a);d.contentEditable="true";d.setAttribute("role","textbox");d.setAttribute("aria-multiline",
"true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._hookEvents();c=this._rulers;for(a=0;a<c.length;a++)this._createRuler(c[a]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},
tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},theme:{value:i.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(d){var a=d.getLocation()==="left"?this._leftDiv:this._rightDiv;if(a)for(var g=a.firstChild;g;){if(g._ruler===d){g._ruler=void 0;a.removeChild(g);if(a.children.length===0)a.style.display="none";break}g=g.nextSibling}},
_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var d=this._getWindow();if(this._autoScrollTimerID)d.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null;if(this._updateTimer)d.clearTimeout(this._updateTimer),this._updateTimer=null;d=this._rootDiv;d.parentNode.removeChild(d);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=
this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(d,a,g){this._autoScrollDir=d;this._autoScrollX=a;this._autoScrollY=g;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var d=this._clientDiv;if(d){var a=this._hasFocus;this._ignoreFocus=!0;a&&d.blur();d.contentEditable=!1;d.contentEditable=
!0;a&&d.focus();this._ignoreFocus=!1}},_getBaseText:function(d,a){var g=this._model;g.getBaseModel&&(d=g.mapOffset(d),a=g.mapOffset(a),g=g.getBaseModel());return g.getText(d,a)},_getBottomIndex:function(d){var a=this._bottomChild;if(d&&this._getClientHeight()>this._getLineHeight()){var d=a.getBoundingClientRect(),g=this._clientDiv.getBoundingClientRect();d.bottom>g.bottom&&(a=this._getLinePrevious(a)||a)}return a.lineIndex},_getBoundsAtOffset:function(d){var a=this._getLine(this._model.getLineAtOffset(d)),
d=a.getBoundingClientRect(d),g=this._getLinePixel(a.lineIndex);d.top+=g;d.bottom+=g;a.destroy();return d},_getClientHeight:function(){var d=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-d.top-d.bottom)},_getClientWidth:function(){var d=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-d.left-d.right)},_getClipboardText:function(d,j){var g=this._model.getLineDelimiter(),c,k,f=this._getWindow();if(f.clipboardData)return c=[],k=f.clipboardData.getData("Text"),a(k,
function(d){c.push(d)},function(){c.push(g)}),k=c.join(""),j&&j(k),k;if(b.isFirefox){this._ignoreFocus=!0;var e=this._clipboardDiv;e.innerHTML="<pre contenteditable=''></pre>";e.firstChild.focus();var p=this,n=function(){var d=p._getTextFromElement(e);e.innerHTML="";c=[];a(d,function(d){c.push(d)},function(){c.push(g)});return c.join("")},h=!1;this._ignorePaste=!0;if(!b.isLinux||this._lastMouseButton!==2)try{h=e.ownerDocument.execCommand("paste",!1,null)}catch(o){h=e.childNodes.length>1||e.firstChild&&
e.firstChild.childNodes.length>0}this._ignorePaste=!1;if(!h)return d?(f.setTimeout(function(){p.focus();(k=n())&&j&&j(k);p._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"");this.focus();this._ignoreFocus=!1;(k=n())&&j&&j(k);return k}return d&&d.clipboardData?(c=[],k=d.clipboardData.getData("text/plain"),a(k,function(d){c.push(d)},function(){c.push(g)}),(k=c.join(""))&&j&&j(k),k):""},_getDOMText:function(d,a){for(var g=d.firstChild,b="",k=0;g;){var c;if(g.ignoreChars){c=g.lastChild;
for(var f=0,e=[],p=-1;c;){for(var n=c.data,h=n.length-1;h>=0;h--){var o=n.substring(h,h+1);f<g.ignoreChars&&(o===" "||o==="\u200c"||o==="\ufeff")?f++:e.push(o==="\u00a0"?"\t":o)}if(a===c)p=e.length;c=c.previousSibling}e=e.reverse().join("");p!==-1&&(k=b.length+e.length-p);b+=e}else for(c=g.firstChild;c;){if(a===c)k=b.length;b+=c.data;c=c.nextSibling}g=g.nextSibling}return{text:b,offset:k}},_getTextFromElement:function(d){var a=d.ownerDocument,g=a.defaultView;if(!g.getSelection)return d.innerText||
d.textContent;a=a.createRange();a.selectNode(d);var d=g.getSelection(),g=[],c;for(c=0;c<d.rangeCount;c++)g.push(d.getRangeAt(c));this._ignoreSelect=!0;d.removeAllRanges();d.addRange(a);a=d.toString();d.removeAllRanges();for(c=0;c<g.length;c++)d.addRange(g[c]);this._ignoreSelect=!1;return a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(d){var a=this._getLineNode(d);return a&&!a.lineChanged&&!a.lineRemoved?a._line:new s(this,d)},_getLineHeight:function(d,a){if(d!==
void 0&&this._lineHeight){var g=this._lineHeight[d];if(g)return g;if(a||a===void 0)return this._lineHeight[d]=this._calculateLineHeight(d)}return this._metrics.lineHeight},_getLineNode:function(d){for(var a=this._clientDiv.firstChild;a;){if(d===a.lineIndex)return a;a=a.nextSibling}},_getLineNext:function(d){for(d=d?d.nextSibling:this._clientDiv.firstChild;d&&d.lineIndex===-1;)d=d.nextSibling;return d},_getLinePrevious:function(d){for(d=d?d.previousSibling:this._clientDiv.lastChild;d&&d.lineIndex===
-1;)d=d.previousSibling;return d},_getLinePixel:function(d){d=Math.min(Math.max(0,d),this._model.getLineCount());if(this._lineHeight){var a=this._getTopIndex(),g=-this._topIndexY+this._getScroll().y;if(d>a)for(;a<d;a++)g+=this._getLineHeight(a);else for(a-=1;a>=d;a--)g-=this._getLineHeight(a);return g}return this._getLineHeight()*d},_getLineIndex:function(d){var a,g=0,c=this._model.getLineCount();if(this._lineHeight){var g=this._getTopIndex(),k=-this._topIndexY+this._getScroll().y;if(d!==k)if(d<k)for(;d<
k&&g>0;)d+=this._getLineHeight(--g);else for(a=this._getLineHeight(g);d-a>=k&&g<c-1;)d-=a,a=this._getLineHeight(++g)}else a=this._getLineHeight(),g=Math.floor(d/a);return Math.max(0,Math.min(c-1,g))},_getScroll:function(d){(d===void 0||d)&&this._cancelAnimation();d=this._viewDiv;return{x:d.scrollLeft,y:d.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(d){var a=this._topChild;if(d&&this._getClientHeight()>this._getLineHeight()){var d=a.getBoundingClientRect(),
g=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();d.top<c.top+g.top&&(a=this._getLineNext(a)||a)}return a.lineIndex},_hookEvents:function(){var d=this;this._modelListener={onChanging:function(a){d._onModelChanging(a)},onChanged:function(a){d._onModelChanged(a)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){d._setThemeClass(d._themeClass)}};
this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var a=this._handlers=[],g=this._clientDiv,c=this._viewDiv,k=this._rootDiv,f=this._overlayDiv||g,p=g.ownerDocument,n=this._getWindow(),h=b.isIE?p:n;a.push({target:n,type:"resize",handler:function(a){return d._handleResize(a?a:n.event)}});a.push({target:g,type:"blur",handler:function(a){return d._handleBlur(a?a:n.event)}});a.push({target:g,type:"focus",handler:function(a){return d._handleFocus(a?a:n.event)}});a.push({target:c,
type:"focus",handler:function(){g.focus()}});a.push({target:c,type:"scroll",handler:function(a){return d._handleScroll(a?a:n.event)}});a.push({target:g,type:"textInput",handler:function(a){return d._handleTextInput(a?a:n.event)}});a.push({target:g,type:"keydown",handler:function(a){return d._handleKeyDown(a?a:n.event)}});a.push({target:g,type:"keypress",handler:function(a){return d._handleKeyPress(a?a:n.event)}});a.push({target:g,type:"keyup",handler:function(a){return d._handleKeyUp(a?a:n.event)}});
a.push({target:g,type:"contextmenu",handler:function(a){return d._handleContextMenu(a?a:n.event)}});a.push({target:g,type:"copy",handler:function(a){return d._handleCopy(a?a:n.event)}});a.push({target:g,type:"cut",handler:function(a){return d._handleCut(a?a:n.event)}});a.push({target:g,type:"paste",handler:function(a){return d._handlePaste(a?a:n.event)}});if(b.isIOS||b.isAndroid)a.push({target:p,type:"selectionchange",handler:function(a){return d._handleSelectionChange(a?a:n.event)}}),a.push({target:g,
type:"touchstart",handler:function(a){return d._handleTouchStart(a?a:n.event)}}),a.push({target:g,type:"touchmove",handler:function(a){return d._handleTouchMove(a?a:n.event)}}),a.push({target:g,type:"touchend",handler:function(a){return d._handleTouchEnd(a?a:n.event)}});else{a.push({target:g,type:"selectstart",handler:function(a){return d._handleSelectStart(a?a:n.event)}});a.push({target:g,type:"mousedown",handler:function(a){return d._handleMouseDown(a?a:n.event)}});a.push({target:g,type:"mouseover",
handler:function(a){return d._handleMouseOver(a?a:n.event)}});a.push({target:g,type:"mouseout",handler:function(a){return d._handleMouseOut(a?a:n.event)}});a.push({target:h,type:"mouseup",handler:function(a){return d._handleMouseUp(a?a:n.event)}});a.push({target:h,type:"mousemove",handler:function(a){return d._handleMouseMove(a?a:n.event)}});a.push({target:k,type:"mousedown",handler:function(a){return d._handleRootMouseDown(a?a:n.event)}});a.push({target:k,type:"mouseup",handler:function(a){return d._handleRootMouseUp(a?
a:n.event)}});a.push({target:f,type:"dragstart",handler:function(a){return d._handleDragStart(a?a:n.event)}});a.push({target:f,type:"drag",handler:function(a){return d._handleDrag(a?a:n.event)}});a.push({target:f,type:"dragend",handler:function(a){return d._handleDragEnd(a?a:n.event)}});a.push({target:f,type:"dragenter",handler:function(a){return d._handleDragEnter(a?a:n.event)}});a.push({target:f,type:"dragover",handler:function(a){return d._handleDragOver(a?a:n.event)}});a.push({target:f,type:"dragleave",
handler:function(a){return d._handleDragLeave(a?a:n.event)}});a.push({target:f,type:"drop",handler:function(a){return d._handleDrop(a?a:n.event)}});a.push({target:this._clientDiv,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?a:n.event)}});if(b.isFirefox&&(!b.isWindows||b.isFirefox>=15))(c=n.MutationObserver||n.MozMutationObserver)?(this._mutationObserver=new c(function(a){d._handleDataModified(a)}),this._mutationObserver.observe(g,{subtree:!0,characterData:!0})):
a.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(a){return d._handleDataModified(a?a:n.event)}});this._overlayDiv&&(a.push({target:this._overlayDiv,type:"mousedown",handler:function(a){return d._handleMouseDown(a?a:n.event)}}),a.push({target:this._overlayDiv,type:"mouseover",handler:function(a){return d._handleMouseOver(a?a:n.event)}}),a.push({target:this._overlayDiv,type:"mouseout",handler:function(a){return d._handleMouseOut(a?a:n.event)}}),a.push({target:this._overlayDiv,
type:"contextmenu",handler:function(a){return d._handleContextMenu(a?a:n.event)}}));this._isW3CEvents||a.push({target:this._clientDiv,type:"dblclick",handler:function(a){return d._handleDblclick(a?a:n.event)}})}c=this._leftDiv;k=this._rightDiv;b.isIE&&a.push({target:c,type:"selectstart",handler:function(){return!1}});a.push({target:c,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?a:n.event)}});a.push({target:c,type:"click",handler:function(a){d._handleRulerEvent(a?
a:n.event)}});a.push({target:c,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:c,type:"mousemove",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:c,type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:c,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:n.event)}});b.isIE&&a.push({target:k,type:"selectstart",handler:function(){return!1}});a.push({target:k,type:b.isFirefox?"DOMMouseScroll":"mousewheel",
handler:function(a){return d._handleMouseWheel(a?a:n.event)}});a.push({target:k,type:"click",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:k,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:k,type:"mousemove",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:k,type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:n.event)}});a.push({target:k,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:n.event)}});
for(c=0;c<a.length;c++)k=a[c],e(k.target,k.type,k.handler,k.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_init:function(a){var g=a.parent;typeof g==="string"&&(g=(a.document||document).getElementById(g));if(!g)throw"no parent";a.parent=g;a.model=a.model||new r.TextModel;var c=this._defaultOptions(),f;for(f in c)c.hasOwnProperty(f)&&(this["_"+f]=a[f]!==void 0?a[f]:c[f].value);this._rulers=[];this._selection=new n(0,0,!1);this._linksVisible=
!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!b.isIE||b.isIE>=9)&&typeof g.ownerDocument.createRange().getBoundingClientRect==="function";this._isW3CEvents=g.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=
this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,g){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(a.text===null||a.text===void 0)){var c=this._model;try{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!0;c.setText(a.text,a.start,a.end)}finally{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!1}g&&(c=
this._getSelection(),c.setCaret(a.start+a.text.length),this._setSelection(c,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var g=a.start,c=a.addedCharCount,b=a.removedCharCount,k=a.addedLineCount,f=a.removedLineCount,e=this._getSelection();e.end>g&&(e.end>g&&e.start<g+b?e.setCaret(g+c):(e.start+=c-b,e.end+=c-b),this._setSelection(e,!1,!1));g=this._model.getLineAtOffset(g);for(c=this._getLineNext();c;){b=c.lineIndex;if(g<=
b&&b<=g+f)g===b&&!c.modelChangedEvent&&!c.lineRemoved?(c.modelChangedEvent=a,c.lineChanged=!0):(c.lineRemoved=!0,c.lineChanged=!1,c.modelChangedEvent=null);if(b>g+f)c.lineIndex=b+k-f,c._line.lineIndex=c.lineIndex;c=this._getLineNext(c)}if(!this._wrapMode&&g<=this._maxLineIndex&&this._maxLineIndex<=g+f)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&
!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,g){if(this._wrapMode){if(a!==void 0&&g!==void 0)for(var c=a;c<g;c++)this._lineHeight[c]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=
-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._resetLineHeight();this._setSelection(new n(0,0,!1),!1,!1);if(this._viewDiv)this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0;var a=this._clientDiv;if(a){for(var g=a.firstChild;g;)g.lineRemoved=!0,g=g.nextSibling;if(b.isFirefox)this._ignoreFocus=!1,(g=this._hasFocus)&&a.blur(),a.contentEditable=!1,a.contentEditable=!0,g&&a.focus(),this._ignoreFocus=!1}},_scrollViewAnimated:function(a,g,c){if(c&&
this._scrollAnimation){var b=this;this._animation=new v({window:this._getWindow(),duration:this._scrollAnimation,curve:[g,0],onAnimate:function(a){a=g-Math.floor(a);b._scrollView(0,a);g-=a},onEnd:function(){b._animation=null;b._scrollView(a,g);c&&c()}});this._animation.play()}else this._scrollView(a,g),c&&c()},_scrollView:function(a,g){this._ensureCaretVisible=!1;var c=this._viewDiv;a&&(c.scrollLeft+=a);g&&(c.scrollTop+=g)},_setClipboardText:function(d,g){var c,f=this._parent.ownerDocument,k=this._getWindow();
if(k.clipboardData)return c=[],a(d,function(a){c.push(a)},function(){c.push(b.platformDelimiter)}),k.clipboardData.setData("Text",c.join(""));if(g&&g.clipboardData&&(c=[],a(d,function(a){c.push(a)},function(){c.push(b.platformDelimiter)}),g.clipboardData.setData("text/plain",c.join(""))))return!0;var e=b.createElement(f,"pre");e.style.position="fixed";e.style.left="-1000px";a(d,function(a){e.appendChild(f.createTextNode(a))},function(){e.appendChild(b.createElement(f,"br"))});e.appendChild(f.createTextNode(" "));
this._clientDiv.appendChild(e);var n=f.createRange();n.setStart(e.firstChild,0);n.setEndBefore(e.lastChild);var p=k.getSelection();p.rangeCount>0&&p.removeAllRanges();p.addRange(n);var h=this,n=function(){e&&e.parentNode===h._clientDiv&&h._clientDiv.removeChild(e);h._updateDOMSelection()},p=!1;this._ignoreCopy=!0;try{p=f.execCommand("copy",!1,null)}catch(o){}this._ignoreCopy=!1;if(!p&&g)return k.setTimeout(n,0),!1;n();return!0},_setDOMSelection:function(a,g,c,f){for(var k,e,n,p,h=0,o=a.firstChild,
s,i,t=this._model.getLine(a.lineIndex).length;o;){s=o.firstChild;i=s.length;o.ignoreChars&&(i-=o.ignoreChars);if(h+i>g||h+i>=t){k=s;e=g-h;o.ignoreChars&&i>0&&e===i&&(e+=o.ignoreChars);break}h+=i;o=o.nextSibling}for(var h=0,o=c.firstChild,w=this._model.getLine(c.lineIndex).length;o;){s=o.firstChild;i=s.length;o.ignoreChars&&(i-=o.ignoreChars);if(i+h>f||h+i>=w){n=s;p=f-h;o.ignoreChars&&i>0&&p===i&&(p+=o.ignoreChars);break}h+=i;o=o.nextSibling}this._setDOMFullSelection(a,g,t,c,f,w);if(this._hasFocus)if(g=
this._getWindow(),a=this._parent.ownerDocument,g.getSelection){if(g=g.getSelection(),!(g.anchorNode===k&&g.anchorOffset===e&&g.focusNode===n&&g.focusOffset===p||g.anchorNode===n&&g.anchorOffset===p&&g.focusNode===k&&g.focusOffset===e))a=a.createRange(),a.setStart(k,e),a.setEnd(n,p),this._ignoreSelect=!1,g.rangeCount>0&&g.removeAllRanges(),g.addRange(a),this._ignoreSelect=!0}else if(a.selection)g=a.body,a=b.createElement(a,"div"),g.appendChild(a),g.removeChild(a),a=g.createTextRange(),a.moveToElementText(k.parentNode),
a.moveStart("character",e),k=g.createTextRange(),k.moveToElementText(n.parentNode),k.moveStart("character",p),a.setEndPoint("EndToStart",k),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0},_setDOMFullSelection:function(a,g,c,b,k){if(this._selDiv1&&(c=this._selDiv1,c.style.width="0px",c.style.height="0px",c=this._selDiv2,c.style.width="0px",c.style.height="0px",c=this._selDiv3,c.style.width="0px",c.style.height="0px",!(a===b&&g===k))){var f=this._model,e=this._getViewPadding(),n=this._clientDiv.getBoundingClientRect(),
p=this._viewDiv.getBoundingClientRect(),c=p.left+e.left,h=n.right,e=p.top+e.top,o=n.bottom,p=n=0;this._clipDiv?(p=this._clipDiv.getBoundingClientRect(),n=p.left-this._clipDiv.scrollLeft):(p=this._rootDiv.getBoundingClientRect(),n=p.left);p=p.top;this._ignoreDOMSelection=!0;var a=(new s(this,a.lineIndex,a)).getBoundingClientRect(f.getLineStart(a.lineIndex)+g,!1),i=a.left,k=(new s(this,b.lineIndex,b)).getBoundingClientRect(f.getLineStart(b.lineIndex)+k,!1),g=k.left;this._ignoreDOMSelection=!1;var f=
this._selDiv1,i=Math.min(h,Math.max(c,i)),t=Math.min(o,Math.max(e,a.top)),w=h,b=Math.min(o,Math.max(e,a.bottom));f.style.left=i-n+"px";f.style.top=t-p+"px";f.style.width=Math.max(0,w-i)+"px";f.style.height=Math.max(0,b-t)+"px";if(a.top===k.top)w=Math.min(g,h),f.style.width=Math.max(0,w-i)+"px";else if(a=Math.min(o,Math.max(e,k.top)),g=Math.min(h,Math.max(c,g)),e=Math.min(o,Math.max(e,k.bottom)),o=this._selDiv3,o.style.left=c-n+"px",o.style.top=a-p+"px",o.style.width=Math.max(0,g-c)+"px",o.style.height=
Math.max(0,e-a)+"px",a-b>0)e=this._selDiv2,e.style.left=c-n+"px",e.style.top=b-p+"px",e.style.width=Math.max(0,h-c)+"px",e.style.height=Math.max(0,a-b)+"px"}},_setGrab:function(a){if(a!==this._grabControl)a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;if(b.isIE&&a)this._hadFocus=this._hasFocus;var g=this._clientDiv;g.contentEditable=
!a;this._hadFocus&&!a&&g.focus();if(this._overlayDiv)this._overlayDiv.style.zIndex=a?"-1":"1";for(a=this._getLineNext();a;){if(a.hasLink)for(g=a.firstChild;g;){var c=g.nextSibling,f=g.viewStyle;f&&f.tagName==="A"&&a.replaceChild(a._line._createSpan(a,g.firstChild.data,f),g);g=c}a=this._getLineNext(a)}}},_setSelection:function(a,g,c,b,k){if(a){this._columnX=-1;c===void 0&&(c=!0);var f=this._selection;this._selection=a;g!==!1&&this._showCaret(!1,b,g,k);c&&this._updateDOMSelection();if(!f.equals(a))this.onSelection({type:"Selection",
oldValue:{start:f.start,end:f.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,g,c,b){var k=this._model,f=this._getSelection(),g=this.convert({x:a,y:g},"page","document"),a=this._getLineIndex(g.y);if(this._clickCount===1){k=this._getLine(a);a=k.getOffset(g.x,g.y-this._getLinePixel(a));k.destroy();if(b&&!c&&f.start<=a&&a<f.end)return this._dragOffset=a,!1;f.extend(a);c||f.collapse()}else(this._clickCount&1)===0?(k=this._getLine(a),a=k.getOffset(g.x,g.y-this._getLinePixel(a)),
this._doubleClickSelection?a>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,b=k.getNextOffset(a,"wordend",1)):(c=k.getNextOffset(a,"word",-1),b=this._doubleClickSelection.end):(c=k.getNextOffset(a,"word",-1),b=k.getNextOffset(c,"wordend",1)),k.destroy()):this._doubleClickSelection?(b=k.getLineAtOffset(this._doubleClickSelection.start),a>=b?(c=k.getLineStart(b),b=k.getLineEnd(a)):(c=k.getLineStart(a),b=k.getLineEnd(b))):(c=k.getLineStart(a),b=k.getLineEnd(a)),f.setCaret(c),f.extend(b);
this._setSelection(f,!0,!0);return!0},_setFullSelection:function(a,g){this._fullSelection=a;if(b.isWebkit)this._fullSelection=!0;var c=this._clipDiv||this._rootDiv;if(c)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!b.isIOS){var f=c.ownerDocument;this._highlightRGB=b.isWebkit?"transparent":"Highlight";var k=b.createElement(f,"div");this._selDiv1=k;k.style.position="absolute";k.style.borderWidth="0px";k.style.margin="0px";k.style.padding="0px";k.style.outline="none";k.style.background=
this._highlightRGB;k.style.width="0px";k.style.height="0px";k.style.zIndex="0";c.appendChild(k);var e=b.createElement(f,"div");this._selDiv2=e;e.style.position="absolute";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.background=this._highlightRGB;e.style.width="0px";e.style.height="0px";e.style.zIndex="0";c.appendChild(e);this._selDiv3=f=b.createElement(f,"div");f.style.position="absolute";f.style.borderWidth="0px";f.style.margin="0px";f.style.padding=
"0px";f.style.outline="none";f.style.background=this._highlightRGB;f.style.width="0px";f.style.height="0px";f.style.zIndex="0";c.appendChild(f);if(b.isFirefox&&b.isMac){c=this._getWindow().getComputedStyle(f,null).getPropertyValue("background-color");switch(c){case "rgb(119, 141, 168)":c="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":c="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":c="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":c="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":c=
"rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":c="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":c="rgb(232, 184, 255)";break;default:c="rgb(180, 213, 255)"}this._highlightRGB=c;k.style.background=c;e.style.background=c;f.style.background=c}g||this._updateDOMSelection()}}else{if(this._selDiv1)c.removeChild(this._selDiv1),this._selDiv1=null;if(this._selDiv2)c.removeChild(this._selDiv2),this._selDiv2=null;if(this._selDiv3)c.removeChild(this._selDiv3),this._selDiv3=null}},_setReadOnly:function(a){this._readonly=
a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setTabSize:function(a,g){this._tabSize=a;this._customTabSize=void 0;var c=this._clientDiv;if(b.isOpera){if(c)c.style.OTabSize=this._tabSize+""}else if(b.isWebkit>=537.1){if(c)c.style.tabSize=this._tabSize+""}else if(b.isFirefox>=4){if(c)c.style.MozTabSize=this._tabSize+""}else if(this._tabSize!==8)this._customTabSize=this._tabSize;g||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,g){this._themeClass=a;var c="textview",b=this._theme.getThemeClass();b&&(c+=" "+b);this._themeClass&&b!==this._themeClass&&(c+=" "+this._themeClass);this._rootDiv.className=c;this._updateStyle(g)},_setWrapMode:function(a,g){this._wrapMode=a;var c=this._clientDiv,b=this._viewDiv;a?(c.style.whiteSpace="pre-wrap",c.style.wordWrap=
"break-word",b.style.overflowX="hidden",b.style.overflowY="scroll"):(c.style.whiteSpace="pre",c.style.wordWrap="normal",b.style.overflowX="auto",b.style.overflowY="auto");g||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,g,c,b){if(this._clientDiv){var k=this._model,f=this._getSelection(),e=this._getScroll(),n=f.getCaret(),p=f.start,h=f.end,o=k.getLineAtOffset(h),s=Math.max(Math.max(p,k.getLineStart(o)),h-1),k=this._getClientWidth(),o=this._getClientHeight(),
i=k/4,t=this._getBoundsAtOffset(n===p?p:s),m=t.left,q=t.right,v=t.top,r=t.bottom;a&&!f.isEmpty()&&(t=this._getBoundsAtOffset(n===h?p:s),t.top===v?n===p?q=m+Math.min(t.right-m,k):m=q-Math.min(q-t.left,k):n===p?r=v+Math.min(t.bottom-v,o):v=r-Math.min(r-t.top,o));a=0;m<e.x&&(a=Math.min(m-e.x,-i));q>e.x+k&&(a=Math.max(q-e.x-k,i));f=0;v<e.y?f=v-e.y:r>e.y+o&&(f=r-e.y-o);b&&(b>0?f>0&&(f=Math.max(f,b)):f<0&&(f=Math.min(f,b)));return a!==0||f!==0?(f!==0&&typeof c==="number"&&(c<0&&(c=0),c>1&&(c=1),f+=Math.floor(f>
0?c*o:-c*o)),this._scrollViewAnimated(a,f,g),o!==this._getClientHeight()||k!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0):!1}},_startIME:function(){if(this._imeOffset===-1){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);
this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var g=this._handlers[a],c=g.target,b=g.type,g=g.handler;typeof c.removeEventListener==="function"?c.removeEventListener(b,g,!1):c.detachEvent("on"+b,g)}this._handlers=null;if(this._mutationObserver)this._mutationObserver.disconnect(),this._mutationObserver=null},_updateDOMSelection:function(){if(!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),
g=this._model,c=g.getLineAtOffset(a.start),b=g.getLineAtOffset(a.end),k=this._getLineNext();if(k){var f=this._getLinePrevious(),e;c<k.lineIndex?(e=k,c=0):c>f.lineIndex?(e=f,c=0):(e=this._getLineNode(c),c=a.start-g.getLineStart(c));b<k.lineIndex?a=0:b>f.lineIndex?(k=f,a=0):(k=this._getLineNode(b),a=a.end-g.getLineStart(b));this._setDOMSelection(e,c,k,a)}}},_update:function(a){if(!(this._redrawCount>0)){if(this._updateTimer)this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=
!1;var g=this._clientDiv;if(g){if(this._metrics.invalid)this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1;var c=this._model,f=this._getScroll(!1),k=this._getViewPadding(),e=c.getLineCount(),n=this._getLineHeight(),p=this._getClientWidth();if(this._wrapMode)g.style.width=p+"px";var h,o,i,t,m=0,w=0;if(this._lineHeight){for(;w<e;){i=this._getLineHeight(w);if(m+i>f.y)break;m+=i;w++}h=w;o=Math.max(0,h-1);i=c=f.y-m;h>0&&(c+=this._getLineHeight(h-1))}else t=Math.max(0,f.y)/n,h=Math.floor(t),
o=Math.max(0,h-1),c=Math.round((t-o)*n),i=Math.round((t-h)*n);this._topIndexY=i;t=this._parent;var q=t.clientWidth,v=t.clientHeight;t=this._getClientHeight();if(a){o=0;this._leftDiv&&(h=this._leftDiv.getBoundingClientRect(),o=h.right-h.left);h=p;for(this._wrapMode||(h=Math.max(this._maxLineWidth,h));w<e;)i=this._getLineHeight(w,!1),m+=i,w++;e=m}else{var p=this._viewDiv,n=Math.min(h+Math.floor((t+i)/n),e-1),f=Math.min(n+1,e-1),r;for(i=g.firstChild;i;){r=i.lineIndex;var x=i.nextSibling;if(!(o<=r&&r<=
f)||i.lineRemoved||i.lineIndex===-1)this._mouseWheelLine===i?(i.style.display="none",i.lineIndex=-1):g.removeChild(i);i=x}i=this._getLineNext();var x=p.ownerDocument,z=x.createDocumentFragment();for(r=o;r<=f;r++)if(!i||i.lineIndex>r)(new s(this,r)).create(z,null);else{z.firstChild&&(g.insertBefore(z,i),z=x.createDocumentFragment());if(i&&i.lineChanged)i=(new s(this,r)).create(z,i),i.lineChanged=!1;i=this._getLineNext(i)}z.firstChild&&g.insertBefore(z,i);if(b.isWebkit&&!this._wrapMode)g.style.width=
"0x7fffffffpx";i=this._getLineNext();r=t+c;for(z=!1;i;){o=i.lineWidth;if(o===void 0)x=i._line.getBoundingClientRect(),o=i.lineWidth=Math.ceil(x.right-x.left),this._lineHeight&&(this._lineHeight[i.lineIndex]=Math.ceil(x.bottom-x.top));if(this._lineHeight&&!z&&(r-=this._lineHeight[i.lineIndex],r<0))n=i.lineIndex,z=!0;if(!this._wrapMode){if(o>=this._maxLineWidth)this._maxLineWidth=o,this._maxLineIndex=i.lineIndex;if(this._checkMaxLineIndex===i.lineIndex)this._checkMaxLineIndex=-1}if(i.lineIndex===h)this._topChild=
i;if(i.lineIndex===n)this._bottomChild=i;i=this._getLineNext(i)}if(this._checkMaxLineIndex!==-1&&(r=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=r&&r<e)){i=new s(this,r);x=i.getBoundingClientRect();o=x.right-x.left;if(o>=this._maxLineWidth)this._maxLineWidth=o,this._maxLineIndex=r;i.destroy()}for(;w<e;)i=this._getLineHeight(w,w<=n),m+=i,w++;e=m;this._updateRuler(this._leftDiv,h,f,v);this._updateRuler(this._rightDiv,h,f,v);o=0;this._leftDiv&&(h=this._leftDiv.getBoundingClientRect(),o=h.right-
h.left);f=0;this._rightDiv&&(f=this._rightDiv.getBoundingClientRect(),f=f.right-f.left);p.style.left=o+"px";p.style.right=f+"px";f=this._scrollDiv;f.style.height=e+"px";m=p=this._getClientWidth();this._wrapMode||(m=Math.max(this._maxLineWidth,m));h=m;if((!b.isIE||b.isIE>=9)&&this._maxLineWidth>p)m+=k.right+k.left;f.style.width=m+"px";if(this._clipScrollDiv)this._clipScrollDiv.style.width=m+"px";f=this._getScroll(!1)}if(this._vScrollDiv)m=t-8,w=Math.max(15,Math.ceil(Math.min(1,m/(e+k.top+k.bottom))*
m)),this._vScrollDiv.style.left=o+p-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,f.y*m/e))+"px",this._vScrollDiv.style.height=w+"px";if(!this._wrapMode&&this._hScrollDiv)m=p-8,w=Math.max(15,Math.ceil(Math.min(1,m/(this._maxLineWidth+k.left+k.right))*m)),this._hScrollDiv.style.left=o+Math.floor(Math.max(0,Math.floor(f.x*m/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=t-9+"px",this._hScrollDiv.style.width=w+"px";r=f.x;i=this._clipDiv;m=this._overlayDiv;if(i){i.scrollLeft=r;w=o+k.left;
n=k.top;a=p;o=t;r=0;x=-c;if(f.x===0)w-=k.left,a+=k.left,r=k.left;f.x+p===h&&(a+=k.right);f.y===0&&(n-=k.top,o+=k.top,x+=k.top);f.y+t===e&&(o+=k.bottom);i.style.left=w+"px";i.style.top=n+"px";i.style.right=q-a-w+"px";i.style.bottom=v-o-n+"px";g.style.left=r+"px";g.style.top=x+"px";g.style.width=h+"px";g.style.height=t+c+"px";if(m)m.style.left=g.style.left,m.style.top=g.style.top,m.style.width=g.style.width,m.style.height=g.style.height}else{w=r;n=c;q=r+p;v=c+t;w===0&&(w-=k.left);n===0&&(n-=k.top);
q===h&&(q+=k.right);f.y+t===e&&(v+=k.bottom);g.style.clip="rect("+n+"px,"+q+"px,"+v+"px,"+w+"px)";g.style.left=-r+o+k.left+"px";g.style.width=(b.isWebkit?h:p+r)+"px";if(!a)g.style.top=-c+k.top+"px",g.style.height=t+c+"px";if(m&&(m.style.clip=g.style.clip,m.style.left=g.style.left,m.style.width=g.style.width,!a))m.style.top=g.style.top,m.style.height=g.style.height}this._updateDOMSelection();g=this._ensureCaretVisible;this._ensureCaretVisible=!1;t!==this._getClientHeight()&&(this._update(),g&&this._showCaret())}}},
_updateRuler:function(a,g,c,e){if(a)for(var k=this._parent.ownerDocument,n=this._getLineHeight(),p=this._getViewPadding(),a=a.firstChild;a;){var h=a._ruler,o=n,i=h.getOverview();i==="page"&&(o+=this._topIndexY);a.style.top=-o+"px";a.style.height=e+o+"px";a.rulerChanged&&f(h.getRulerStyle(),a);var s,t=a.firstChild;t?(s=t,t=t.nextSibling):(s=b.createElement(k,"div"),s.style.visibility="hidden",a.appendChild(s));var m;if(a.rulerChanged&&s){o=-1;if(m=h.getWidestAnnotation())if(f(m.style,s),m.html)s.innerHTML=
m.html;s.lineIndex=o;s.style.height=n+p.top+"px"}var w;if(i==="page"){for(h=h.getAnnotations(g,c+1);t;)o=t.lineIndex,m=t.nextSibling,(!(g<=o&&o<=c)||t.lineChanged)&&a.removeChild(t),t=m;t=a.firstChild.nextSibling;w=k.createDocumentFragment();for(o=g;o<=c;o++)if(!t||t.lineIndex>o){s=b.createElement(k,"div");if(m=h[o]){f(m.style,s);if(m.html)s.innerHTML=m.html;s.annotation=m}s.lineIndex=o;s.style.height=this._getLineHeight(o)+"px";w.appendChild(s)}else if(w.firstChild&&(a.insertBefore(w,t),w=k.createDocumentFragment()),
t)t=t.nextSibling;w.firstChild&&a.insertBefore(w,t)}else{m=this._getClientHeight();o=this._model.getLineCount();t=m+p.top+p.bottom-2*this._metrics.scrollWidth;i=n*o<t?n:t/o;if(a.rulerChanged){for(m=a.childNodes.length;m>1;)a.removeChild(a.lastChild),m--;h=h.getAnnotations(0,o);w=k.createDocumentFragment();for(var q in h)if(o=q>>>0,!(o<0)){s=b.createElement(k,"div");m=h[q];f(m.style,s);s.style.position="absolute";s.style.top=this._metrics.scrollWidth+n+Math.floor(o*i)+"px";if(m.html)s.innerHTML=m.html;
s.annotation=m;s.lineIndex=o;w.appendChild(s)}a.appendChild(w)}else if(a._oldTrackHeight!==t)for(s=a.firstChild?a.firstChild.nextSibling:null;s;)s.style.top=this._metrics.scrollWidth+n+Math.floor(s.lineIndex*i)+"px",s=s.nextSibling;a._oldTrackHeight=t}a.rulerChanged=!1;a=a.nextSibling}},_updateStyleSheet:function(){var a="";b.isWebkit&&this._metrics.scrollWidth>0&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");b.isFirefox&&b.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&
(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var g=document.getElementById("_textviewStyle");if(g)g.removeChild(g.firstChild),g.appendChild(document.createTextNode(a));else{g=b.createElement(document,"style");g.id="_textviewStyle";var c=document.getElementsByTagName("head")[0]||document.documentElement;g.appendChild(document.createTextNode(a));c.insertBefore(g,c.firstChild)}}},_updateStyle:function(a){if(!a&&b.isIE)this._rootDiv.style.lineHeight="normal";var g=this._metrics=
this._calculateMetrics();this._rootDiv.style.lineHeight=b.isIE?g.lineHeight-(g.lineTrim.top+g.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};m.EventTarget.addMixin(t.prototype);return{TextView:t}});
(function(){function r(b,e,f,h,c,a){e[b]&&(f.push(b),(e[b]===!0||e[b]===1)&&h.push(c+b+"/"+a))}function q(b,e,f,h,c){e=h+e+"/"+c;require._fileExists(b.toUrl(e))&&f.push(e)}var m=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,i={};define("i18n",{version:"1.0.0",load:function(b,e,f,h){var h=h||{},c=m.exec(b),a=c[1],g=c[4],p=c[5],n=g.split("-"),o=[],s={},t,v,d="";c[5]?(a=c[1],b=a+p):(p=c[4],g=h.locale||(h.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),
n=g.split("-"));if(h.isBuild){o.push(b);q(e,"root",o,a,p);for(t=0;v=n[t];t++)d+=(d?"-":"")+v,q(e,d,o,a,p);e(o,function(){f()})}else e([b],function(g){var c=[];r("root",g,c,o,a,p);for(t=0;v=n[t];t++)d+=(d?"-":"")+v,r(d,g,c,o,a,p);e(o,function(){var d,b;for(d=c.length-1;d>-1&&(v=c[d]);d--){b=g[v];if(b===!0||b===1)b=e(a+v+"/"+p);var n=s,h=void 0;for(h in b)!(h in i)&&!(h in n)&&(n[h]=b[h])}f(s)})})}})})();
define("orion/editor/i18n",{load:function(r,q,m){q.specified&&q.specified("orion/bootstrap")?q(["orion/i18n!"+r],function(i){m(i)}):m({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",Comment:"Comment","Flat outline":"Flat outline",incrementalFind:"Incremental find: ${0}",incrementalFindNotFound:"Incremental find: ${0} (not found)",find:"Find...",
undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFindKey:"Incremental Find",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",
collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(r,q){var m={root:q},i;for(i in r)r.hasOwnProperty(i)&&typeof m[i]==="undefined"&&(m[i]=r[i]);return m});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(r,q){function m(a,g,c){this.start=a;this.end=g;this._projectionModel=c;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function i(){}function b(a,g){var c=a.lastIndexOf("."),c=a.substring(c+1),b={title:r[c],style:{styleClass:"annotation "+c},html:"<div class='annotationHTML "+c+"'></div>",overviewStyle:{styleClass:"annotationOverview "+c}};g?b.lineStyle={styleClass:"annotationLine "+
c}:b.rangeStyle={styleClass:"annotationRange "+c};i.registerType(a,b)}function e(){}function f(a){this._annotations=[];var g=this;this._listener={onChanged:function(a){g._onChanged(a)}};this.setTextModel(a)}function h(a,g){this._view=a;this._annotationModel=g;var c=this;this._listener={onDestroy:function(a){c._onDestroy(a)},onLineStyle:function(a){c._onLineStyle(a)},onChanged:function(a){c._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",
this._listener.onLineStyle);g.addEventListener("Changed",this._listener.onChanged)}m.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var a=this._projectionModel,g=a.getBaseModel();this._projection=
{start:g.getLineStart(g.getLineAtOffset(this.start)+1),end:g.getLineEnd(g.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){if(!this.expanded)this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}};i.ANNOTATION_ERROR="orion.annotation.error";i.ANNOTATION_WARNING="orion.annotation.warning";i.ANNOTATION_TASK="orion.annotation.task";i.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
i.ANNOTATION_BOOKMARK="orion.annotation.bookmark";i.ANNOTATION_FOLDING="orion.annotation.folding";i.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";i.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";i.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";i.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";i.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";i.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";i.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
var c={};i.registerType=function(a,g){var b=g;if(typeof b!=="function")b=function(a,g,c){this.start=a;this.end=g;if(c)this.title=c},b.prototype=g;b.prototype.type=a;c[a]=b;return a};i.createAnnotation=function(a,g,c,b){return new (this.getType(a))(g,c,b)};i.getType=function(a){return c[a]};b(i.ANNOTATION_ERROR);b(i.ANNOTATION_WARNING);b(i.ANNOTATION_TASK);b(i.ANNOTATION_BREAKPOINT);b(i.ANNOTATION_BOOKMARK);b(i.ANNOTATION_CURRENT_BRACKET);b(i.ANNOTATION_MATCHING_BRACKET);b(i.ANNOTATION_CURRENT_SEARCH);
b(i.ANNOTATION_MATCHING_SEARCH);b(i.ANNOTATION_READ_OCCURRENCE);b(i.ANNOTATION_WRITE_OCCURRENCE);b(i.ANNOTATION_CURRENT_LINE,!0);i.registerType(i.ANNOTATION_FOLDING,m);e.addMixin=function(a){var g=e.prototype,c;for(c in g)g.hasOwnProperty(c)&&(a[c]=g[c])};e.prototype={addAnnotationType:function(a){if(!this._annotationTypes)this._annotationTypes=[];this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var g=0;g<this._annotationTypes.length;g++)if(this._annotationTypes[g]===
a)return g+1;return 0},getAnnotationsByType:function(a,g,c){a=a.getAnnotations(g,c);for(c=[];a.hasNext();)g=a.next(),this.getAnnotationTypePriority(g.type)!==0&&c.push(g);var b=this;c.sort(function(a,g){return b.getAnnotationTypePriority(a.type)-b.getAnnotationTypePriority(g.type)});return c},isAnnotationTypeVisible:function(a){return this.getAnnotationTypePriority(a)!==0},removeAnnotationType:function(a){if(this._annotationTypes)for(var g=0;g<this._annotationTypes.length;g++)if(this._annotationTypes[g]===
a){this._annotationTypes.splice(g,1);break}}};f.prototype={addAnnotation:function(a){if(a){var g=this._annotations,c=this._binarySearch(g,a.start);g.splice(c,0,a);this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,g){var c=this._annotations,b,f=0,e=function(){for(;f<c.length;){var b=c[f++];if(a===b.start||(a>b.start?a<b.end:b.start<g))return b;if(b.start>=g)break}return null};b=e();return{next:function(){var a=b;
a&&(b=e());return a},hasNext:function(){return b!==null}}},modifyAnnotation:function(a){if(a&&!(this._getAnnotationIndex(a)<0))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var g=this._annotations,c,b;if(a){c=[];for(b=g.length-1;b>=0;b--){var f=g[b];f.type===a&&g.splice(b,1);c.splice(0,0,f)}}else c=g;this.onChanged({type:"Changed",removed:c,added:[],changed:[]})},removeAnnotation:function(a){if(a&&
(a=this._getAnnotationIndex(a),!(a<0)))this.onChanged({type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]})},replaceAnnotations:function(a,g){var c=this._annotations,b,f,e,h=[];if(a)for(b=a.length-1;b>=0;b--)e=a[b],f=this._getAnnotationIndex(e),f<0||(c.splice(f,1),h.splice(0,0,e));g||(g=[]);for(b=0;b<g.length;b++)e=g[b],f=this._binarySearch(c,e.start),c.splice(f,0,e);this.onChanged({type:"Changed",removed:h,added:g,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(a,c){for(var b=a.length,f=-1,e;b-f>1;)e=Math.floor((b+f)/2),c<=a[e].start?b=e:f=e;return b},_getAnnotationIndex:function(a){for(var c=this._annotations,b=this._binarySearch(c,a.start);b<c.length&&c[b].start===a.start;){if(c[b]===a)return b;b++}return-1},_onChanged:function(a){var c=a.start,b=a.removedCharCount,f=this._annotations,e=c+b;if(0<f.length){for(var h={type:"Changed",
added:[],removed:[],changed:[],textModelChangedEvent:a},a=a.addedCharCount-b,b=0;b<f.length;b++){var i=f[b];i.start>=e?(i.start+=a,i.end+=a,h.changed.push(i)):i.end<=c||(i.start<c&&e<i.end?(i.end+=a,h.changed.push(i)):(f.splice(b,1),h.removed.push(i),b--))}if(h.added.length>0||h.removed.length>0||h.changed.length>0)this.onChanged(h)}}};q.EventTarget.addMixin(f.prototype);h.prototype={destroy:function(){var a=this._view;if(a)a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null;(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+=" "+c.styleClass:a.styleClass=c.styleClass;var b;if(c.style){if(!a.style)a.style={};for(b in c.style)a.style[b]||(a.style[b]=c.style[b])}if(c.attributes){if(!a.attributes)a.attributes={};for(b in c.attributes)a.attributes[b]||(a.attributes[b]=c.attributes[b])}}return a},
_mergeStyleRanges:function(a,c){a||(a=[]);var b,f;for(f=0;f<a.length&&c;f++){var e=a[f];if(c.end<=e.start)break;if(!(c.start>=e.end)){b=this._mergeStyle({},e.style);b=this._mergeStyle(b,c.style);var h=[];h.push(f,1);c.start<e.start&&h.push({start:c.start,end:e.start,style:c.style});c.start>e.start&&h.push({start:e.start,end:c.start,style:e.style});h.push({start:Math.max(e.start,c.start),end:Math.min(e.end,c.end),style:b});c.end<e.end&&h.push({start:c.end,end:e.end,style:e.style});c=c.end>e.end?{start:e.end,
end:c.end,style:c.style}:null;Array.prototype.splice.apply(a,h)}}c&&(b=this._mergeStyle({},c.style),a.splice(f,0,{start:c.start,end:c.end,style:b}));return a},_onAnnotationModelChanged:function(a){function c(a){for(var g=0;g<a.length;g++)if(f.isAnnotationTypeVisible(a[g].type)){var h=a[g].start,d=a[g].end;e.getBaseModel&&(h=e.mapOffset(h,!0),d=e.mapOffset(d,!0));h!==-1&&d!==-1&&b.redrawRange(h,d)}}if(!a.textModelChangedEvent){var b=this._view;if(b){var f=this,e=b.getModel();c(a.added);c(a.removed);
c(a.changed)}}},_onDestroy:function(){this.destroy()},_onLineStyle:function(a){var c=this._annotationModel,b=a.textView.getModel(),f=c.getTextModel(),e=a.lineStart,h=a.lineStart+a.lineText.length;f!==b&&(e=b.mapOffset(e),h=b.mapOffset(h));for(c=c.getAnnotations(e,h);c.hasNext();)if(e=c.next(),this.isAnnotationTypeVisible(e.type)){if(e.rangeStyle){var h=e.start,i=e.end;f!==b&&(h=b.mapOffset(h,!0),i=b.mapOffset(i,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:h,end:i,style:e.rangeStyle})}if(e.lineStyle)a.style=
this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,e.lineStyle)}}};e.addMixin(h.prototype);return{FoldingAnnotation:m,AnnotationType:i,AnnotationTypeList:e,AnnotationModel:f,AnnotationStyler:h}});
define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/util"],function(r,q,m,i,b){function e(b){this._view=b;this._create(b.getOptions("parent").ownerDocument);b.addEventListener("Destroy",this,this.destroy)}e.getTooltip=function(b){if(!b._tooltip)b._tooltip=new e(b);return b._tooltip};e.prototype={_create:function(f){if(!this._tooltipDiv){var e=this._tooltipDiv=b.createElement(f,"div");e.className=
"textviewTooltip";e.setAttribute("aria-live","assertive");e.setAttribute("aria-atomic","true");var c=this._tooltipContents=b.createElement(f,"div");e.appendChild(c);f.body.appendChild(e);this.hide()}},_getWindow:function(){var b=this._tooltipDiv.ownerDocument;return b.defaultView||b.parentWindow},destroy:function(){if(this._tooltipDiv){this.hide();var b=this._tooltipDiv.parentNode;b&&b.removeChild(this._tooltipDiv);this._tooltipDiv=null}},hide:function(){if(this._contentsView)this._contentsView.destroy(),
this._contentsView=null;if(this._tooltipContents)this._tooltipContents.innerHTML="";if(this._tooltipDiv)this._tooltipDiv.style.visibility="hidden";var b=this._getWindow();if(this._showTimeout)b.clearTimeout(this._showTimeout),this._showTimeout=null;if(this._hideTimeout)b.clearTimeout(this._hideTimeout),this._hideTimeout=null;if(this._fadeTimeout)b.clearInterval(this._fadeTimeout),this._fadeTimeout=null},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(b,
e){if(this.target!==b&&(this._target=b,this.hide(),b)){var c=this;if(e===0)c.show(!0);else{var a=this._getWindow();c._showTimeout=a.setTimeout(function(){c.show(!0)},e?e:500)}}},show:function(b){if(this._target){var e=this._target.getTooltipInfo();if(e){var c=this._tooltipDiv,a=this._tooltipContents;c.style.left=c.style.right=c.style.width=c.style.height=a.style.width=a.style.height="auto";var g=e.contents;g instanceof Array&&(g=this._getAnnotationContents(g));if(typeof g==="string")a.innerHTML=g;
else if(this._isNode(g))a.appendChild(g);else if(g instanceof i.ProjectionTextModel){var p=this._view,n=p.getOptions();n.wrapMode=!1;n.parent=a;var o=n.themeClass;o?((o=o.replace("tooltip",""))&&(o=" "+o),o="tooltip"+o):o="tooltip";n.themeClass=o;n=this._contentsView=new q.TextView(n);n._clientDiv.contentEditable=!1;n.addEventListener("LineStyle",function(a){p.onLineStyle(a)});n.setModel(g);g=n.computeSize();a.style.width=g.width+"px";a.style.height=g.height+"px";n.resize()}else return;a=c.ownerDocument.documentElement;
e.anchor==="right"?(g=a.clientWidth-e.x,c.style.right=g+"px"):(g=parseInt(this._getNodeStyle(c,"padding-left","0"),10),g+=parseInt(this._getNodeStyle(c,"border-left-width","0"),10),g=e.x-g,c.style.left=g+"px");c.style.maxWidth=a.clientWidth-g-10+"px";g=parseInt(this._getNodeStyle(c,"padding-top","0"),10);g+=parseInt(this._getNodeStyle(c,"border-top-width","0"),10);g=e.y-g;c.style.top=g+"px";c.style.maxHeight=a.clientHeight-g-10+"px";c.style.opacity="1";c.style.visibility="visible";if(b){var s=this,
t=this._getWindow();s._hideTimeout=t.setTimeout(function(){var a=parseFloat(s._getNodeStyle(c,"opacity","1"));s._fadeTimeout=t.setInterval(function(){c.style.visibility==="visible"&&a>0?(a-=0.1,c.style.opacity=a):s.hide()},50)},5E3)}}}},_getAnnotationContents:function(b){function e(c){var g=c.title;if(g==="")return null;var b="<div>";c.html&&(b+=c.html+"&nbsp;");if(!g)g=c.end,c=a.getLineStart(a.getLineAtOffset(c.start)),g=a.getLineEnd(a.getLineAtOffset(g),!0),g=a.getText(c,g);g=g.replace(/</g,"&lt;").replace(/>/g,
"&gt;");b+="<span style='vertical-align:middle;'>"+g+"</span><div>";return b}if(b.length===0)return null;var c=this._view.getModel(),a=c.getBaseModel?c.getBaseModel():c;if(b.length===1)if(c=b[0],c.title!==void 0)return e(c);else{var b=new i.ProjectionTextModel(a),g=a.getLineStart(a.getLineAtOffset(c.start)),p=a.getCharCount();c.end!==p&&b.addProjection({start:c.end,end:p});g>0&&b.addProjection({start:0,end:g});return b}else{g="<div><em>"+r.multipleAnnotations+"</em></div>";for(p=0;p<b.length;p++)c=
b[p],(c=e(c))&&(g+=c);return g}},_getNodeStyle:function(b,e,c){var a;if(b&&(a=b.style[e],!a))if(b.currentStyle){for(a=0;(a=e.indexOf("-",a))!==-1;)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=b.currentStyle[e]}else a=(b=b.ownerDocument.defaultView.getComputedStyle(b,null))?b.getPropertyValue(e):null;return a||c},_isNode:function(b){return typeof Node==="object"?b instanceof Node:b&&typeof b==="object"&&typeof b.nodeType==="number"&&typeof b.nodeName==="string"}};return{Tooltip:e}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(r,q,m,i){function b(a,c,b,f){this._location=c||"left";this._overview=b||"page";this._rulerStyle=f;this._view=null;var e=this;this._listener={onTextModelChanged:function(a){e._onTextModelChanged(a)},onAnnotationModelChanged:function(a){e._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function e(a,c,f,e,h){b.call(this,a,c,"page",f);this._oddStyle=e||{style:{backgroundColor:"white"}};
this._evenStyle=h||{style:{backgroundColor:"white"}};this._numOfDigits=0}function f(a,c,f){b.call(this,a,c,"page",f)}function h(a,c,f){b.call(this,a,c,"document",f)}function c(a,c,b){f.call(this,a,c,b)}b.prototype={getAnnotations:function(a,c){var b=this._annotationModel;if(!b)return[];var f=this._view.getModel(),e=f.getLineStart(a),h=f.getLineEnd(c-1),i=f;f.getBaseModel&&(i=f.getBaseModel(),e=f.mapOffset(e),h=f.mapOffset(h));for(var m=[],b=this.getAnnotationsByType(b,e,h),e=0;e<b.length;e++)for(var h=
b[e],d=i.getLineAtOffset(h.start),j=i.getLineAtOffset(Math.max(h.start,h.end-1)),l=d;l<=j;l++){var u=l;if(f!==i){u=i.getLineStart(l);u=f.mapOffset(u,!0);if(u===-1)continue;u=f.getLineAtOffset(u)}if(a<=u&&u<c){var k=this._mergeAnnotation(m[u],h,l-d,j-d+1);k&&(m[u]=k)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var y in m)m[y]._multiple&&(m[y].html+=this._multiAnnotationOverlay.html);return m},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(a){if(a!==void 0){var c=this._view,b=c.getModel(),f=b,e=b.getLineStart(a),h=e,i=this._annotationModel;if(i){h=c.getSelection();c=Math.max(h.start,h.end);h=b.getLineEnd(a,!0);e<=c&&c<b.getLineEnd(a)&&(e=c+1);b.getBaseModel&&
(e=b.mapOffset(e),h=b.mapOffset(h),f=b.getBaseModel());for(var q,a=i.getAnnotations(e,h);!q&&a.hasNext();)h=a.next(),this.isAnnotationTypeVisible(h.type)&&(q=h);q&&f.getLineAtOffset(q.start)===f.getLineAtOffset(e)?(e=q.start,h=q.end):h=e;b.getBaseModel&&(e=b.mapOffset(e,!0),h=b.mapOffset(h,!0))}(b=m.Tooltip.getTooltip(this._view))&&b.setTarget(null);this._view.setSelection(h,e,1/3,function(){})}},onDblClick:function(){},onMouseMove:function(a,c){var b=m.Tooltip.getTooltip(this._view);if(b&&!(b.isVisible()&&
this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var e=this;b.setTarget({y:c.clientY,getTooltipInfo:function(){return e._getTooltipInfo(e._tooltipLineIndex,this.y)}})}},onMouseOver:function(a,c){this.onMouseMove(a,c)},onMouseOut:function(){var a=m.Tooltip.getTooltip(this._view);a&&a.setTarget(null)},_getTooltipInfo:function(a,c){if(a!==void 0){var b=this._view,e=b.getModel(),f=this._annotationModel,h=[];if(f){var h=e.getLineStart(a),i=e.getLineEnd(a);e.getBaseModel&&(h=e.mapOffset(h),i=e.mapOffset(i));
h=this.getAnnotationsByType(f,h,i)}f=this._getTooltipContents(a,h);if(!f)return null;f={contents:f,anchor:this.getLocation()};h=b.getClientArea();h.y=this.getOverview()==="document"?b.convert({y:c},"view","document").y:b.getLocationAtOffset(e.getLineStart(a)).y;b.convert(h,"document","page");f.x=h.x;f.y=h.y;f.anchor==="right"&&(f.x+=h.width);return f}},_getTooltipContents:function(a,c){return c},_onAnnotationModelChanged:function(a){function c(a){for(var g=0;g<a.length;g++)if(e.isAnnotationTypeVisible(a[g].type)){var d=
a[g].start,j=a[g].end;f.getBaseModel&&(d=f.mapOffset(d,!0),j=f.mapOffset(j,!0));d!==-1&&j!==-1&&b.redrawLines(f.getLineAtOffset(d),f.getLineAtOffset(Math.max(d,j-1))+1,e)}}var b=this._view;if(b){var f=b.getModel(),e=this,h=f.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,f.getBaseModel&&(a=f.mapOffset(a,!0)),a=f.getLineAtOffset(a),b.redrawLines(a,h,e)):(c(a.added),c(a.removed),c(a.changed))}},_mergeAnnotation:function(a,c,b){a||(a={});if(b===0)if(a.html&&c.html){if(c.html!==
a.html&&!a._multiple&&this._multiAnnotation)a.html=this._multiAnnotation.html;a._multiple=!0}else a.html=c.html;a.style=this._mergeStyle(a.style,c.style);return a},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+=" "+c.styleClass:a.styleClass=c.styleClass;var b;if(c.style){if(!a.style)a.style={};for(b in c.style)a.style[b]||(a.style[b]=c.style[b])}if(c.attributes){if(!a.attributes)a.attributes={};for(b in c.attributes)a.attributes[b]||
(a.attributes[b]=c.attributes[b])}}return a}};q.AnnotationTypeList.addMixin(b.prototype);e.prototype=new b;e.prototype.getAnnotations=function(a,c){for(var f=b.prototype.getAnnotations.call(this,a,c),e=this._view.getModel(),h=a;h<c;h++){var i=h&1?this._oddStyle:this._evenStyle,t=h;e.getBaseModel&&(t=e.getLineStart(t),t=e.getBaseModel().getLineAtOffset(e.mapOffset(t)));f[h]||(f[h]={});f[h].html=t+1+"";if(!f[h].style)f[h].style=i}return f};e.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();
return this.getAnnotations(a-1,a)[a-1]};e.prototype._onTextModelChanged=function(a){var a=a.start,c=this._view.getModel(),b=((c.getBaseModel?c.getBaseModel().getLineCount():c.getLineCount())+"").length;if(this._numOfDigits!==b)this._numOfDigits=b,this._view.redrawLines(c.getLineAtOffset(a),c.getLineCount(),this)};f.prototype=new b;h.prototype=new b;h.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};h.prototype._getTooltipContents=
function(a,c){if(c.length===0){var f=this._view.getModel(),e=a;f.getBaseModel&&(e=f.getLineStart(e),e=f.getBaseModel().getLineAtOffset(f.mapOffset(e)));return i.formatMessage(r.line,e+1)}return b.prototype._getTooltipContents.call(this,a,c)};h.prototype._mergeAnnotation=function(a,c,b,f){if(b===0){if(!a)a={html:"&nbsp;",style:{style:{height:3*f+"px"}}},a.style=this._mergeStyle(a.style,c.overviewStyle);return a}};c.prototype=new f;c.prototype.onClick=function(a){if(a!==void 0){var c=this._annotationModel;
if(c){var b=this._view.getModel(),f=b.getLineStart(a),a=b.getLineEnd(a,!0);b.getBaseModel&&(f=b.mapOffset(f),a=b.mapOffset(a),b=b.getBaseModel());for(var e,c=c.getAnnotations(f,a);!e&&c.hasNext();)a=c.next(),this.isAnnotationTypeVisible(a.type)&&(e=a);e&&b.getLineAtOffset(e.start)===b.getLineAtOffset(f)&&((b=m.Tooltip.getTooltip(this._view))&&b.setTarget(null),e.expanded?e.collapse():e.expand(),this._annotationModel.modifyAnnotation(e))}}};c.prototype._getTooltipContents=function(a,c){return c.length===
1&&c[0].expanded?null:f.prototype._getTooltipContents.call(this,a,c)};c.prototype._onAnnotationModelChanged=function(a){function c(a){for(i=0;i<a.length;i++)if(h.isAnnotationTypeVisible(a[i].type)){var b=a[i].start;e.getBaseModel&&(b=e.mapOffset(b,!0));b!==-1&&(m=Math.min(m,e.getLineAtOffset(b)))}}if(a.textModelChangedEvent)f.prototype._onAnnotationModelChanged.call(this,a);else{var b=this._view;if(b){var e=b.getModel(),h=this,i,t=e.getLineCount(),m=t;c(a.added);c(a.removed);c(a.changed);a=b.getRulers();
for(i=0;i<a.length;i++)b.redrawLines(m,t,a[i])}}};return{Ruler:b,AnnotationRuler:f,LineNumberRuler:e,OverviewRuler:h,FoldingRuler:c}});
define("orion/editor/undoStack",[],function(){function r(i,b,e){this.offset=i;this.text=b;this.previousText=e}function q(){this.changes=[]}function m(i,b){this.view=i;this.size=b!==void 0?b:100;this.reset();var e=i.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;var f=this;this._listener={onChanging:function(b){f._onChanging(b)},onDestroy:function(b){f._onDestroy(b)}};e.addEventListener("Changing",this._listener.onChanging);i.addEventListener("Destroy",this._listener.onDestroy)}r.prototype=
{undo:function(i,b){this._doUndoRedo(this.offset,this.previousText,this.text,i,b)},redo:function(i,b){this._doUndoRedo(this.offset,this.text,this.previousText,i,b)},_doUndoRedo:function(i,b,e,f,h){var c=f.getModel();if(c.mapOffset&&f.annotationModel){var a=c.mapOffset(i,!0);if(a<0)for(var g=f.annotationModel.getAnnotations(i,i+1);g.hasNext();){var p=g.next();if(p.type==="orion.annotation.folding"){p.expand();a=c.mapOffset(i,!0);break}}if(a<0)return;i=a}f.setText(b,i,i+e.length);h&&f.setSelection(i,
i+b.length)}};q.prototype={add:function(i){this.changes.push(i)},end:function(i){this.endSelection=i.getSelection();this.endCaret=i.getCaretOffset()},undo:function(i,b){for(var e=this.changes.length-1;e>=0;e--)this.changes[e].undo(i,!1);if(b){var e=this.startSelection.start,f=this.startSelection.end;i.setSelection(this.startCaret?e:f,this.startCaret?f:e)}},redo:function(i,b){for(var e=0;e<this.changes.length;e++)this.changes[e].redo(i,!1);if(b){var e=this.endSelection.start,f=this.endSelection.end;
i.setSelection(this.endCaret?e:f,this.endCaret?f:e)}},start:function(i){this.startSelection=i.getSelection();this.startCaret=i.getCaretOffset()}};m.prototype={add:function(i){this.compoundChange?this.compoundChange.add(i):(this.stack.splice(this.index,this.stack.length-this.index,i),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,this.cleanIndex--))},markClean:function(){this.endCompoundChange();this._commitUndo();this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===
this.getSize().undo},canUndo:function(){return this.getSize().undo>0},canRedo:function(){return this.getSize().redo>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){var i=this.index,b=this.stack.length;this._undoStart!==void 0&&i++;return{undo:i,redo:b-i}},undo:function(){this._commitUndo();if(this.index<=0)return!1;var i=this.stack[--this.index];this._ignoreUndo=!0;i.undo(this.view,!0);this._ignoreUndo=!1;return!0},
redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var i=this.stack[this.index++];this._ignoreUndo=!0;i.redo(this.view,!0);this._ignoreUndo=!1;return!0},reset:function(){this.index=this.cleanIndex=0;this.stack=[];this._undoStart=void 0;this._undoText="";this._undoType=0;this._ignoreUndo=!1;this._compoundChange=void 0},startCompoundChange:function(){this._commitUndo();var i=new q;this.add(i);this.compoundChange=i;this.compoundChange.start(this.view)},_commitUndo:function(){if(this._undoStart!==
void 0)this._undoType===-1?this.add(new r(this._undoStart,"",this._undoText)):this.add(new r(this._undoStart,this._undoText,"")),this._undoStart=void 0,this._undoText="",this._undoType=0},_onDestroy:function(){this.model.removeEventListener("Changing",this._listener.onChanging);this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(i){var b=i.text,e=i.start,f=i.removedCharCount,i=i.addedCharCount;if(!this._ignoreUndo){this._undoStart!==void 0&&!(i===1&&f===0&&this._undoType===
1&&e===this._undoStart+this._undoText.length||i===0&&f===1&&this._undoType===-1&&(e+1===this._undoStart||e===this._undoStart))&&this._commitUndo();if(!this.compoundChange)if(i===1&&f===0){if(this._undoStart===void 0)this._undoStart=e;this._undoText+=b;this._undoType=1;return}else if(i===0&&f===1){b=this._undoText.length>0&&this._undoStart===e;this._undoStart=e;this._undoType=-1;b?this._undoText+=this.model.getText(e,e+f):this._undoText=this.model.getText(e,e+f)+this._undoText;return}this.add(new r(e,
b,this.model.getText(e,e+f)))}}};return{UndoStack:m}});
define("orion/editor/textDND",[],function(){function r(q,m){this._view=q;this._undoStack=m;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var i=this;this._listener={onDragStart:function(b){i._onDragStart(b)},onDragEnd:function(b){i._onDragEnd(b)},onDragEnter:function(b){i._onDragEnter(b)},onDragOver:function(b){i._onDragOver(b)},onDrop:function(b){i._onDrop(b)},onDestroy:function(b){i._onDestroy(b)}};q.addEventListener("DragStart",this._listener.onDragStart);q.addEventListener("DragEnd",
this._listener.onDragEnd);q.addEventListener("DragEnter",this._listener.onDragEnter);q.addEventListener("DragOver",this._listener.onDragOver);q.addEventListener("Drop",this._listener.onDrop);q.addEventListener("Destroy",this._listener.onDestroy)}r.prototype={destroy:function(){var q=this._view;if(q)q.removeEventListener("DragStart",this._listener.onDragStart),q.removeEventListener("DragEnd",this._listener.onDragEnd),q.removeEventListener("DragEnter",this._listener.onDragEnter),q.removeEventListener("DragOver",
this._listener.onDragOver),q.removeEventListener("Drop",this._listener.onDrop),q.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(){this.destroy()},_onDragStart:function(q){var m=this._view,i=m.getSelection(),m=m.getModel();if(m.getBaseModel)i.start=m.mapOffset(i.start),i.end=m.mapOffset(i.end),m=m.getBaseModel();if(m=m.getText(i.start,i.end))this._dragSelection=i,q.event.dataTransfer.effectAllowed="copyMove",q.event.dataTransfer.setData("Text",m)},_onDragEnd:function(q){var m=
this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();(q=q.event.dataTransfer.dropEffect==="move")&&m.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var i=this._dropText,b=this._dropOffset;if(q)if(b>=this._dragSelection.end)b-=this._dragSelection.end-this._dragSelection.start;else if(b>=this._dragSelection.start)b=this._dragSelection.start;m.setText(i,b,b);m.setSelection(b,b+i.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&
this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(q){this._onDragOver(q)},_onDragOver:function(q){var m=q.event.dataTransfer.types;if(m){var i=!this._view.getOptions("readonly");i&&(i=m.contains?m.contains("text/plain"):m.indexOf("text/plain")!==-1);if(!i)q.event.dataTransfer.dropEffect="none"}},_onDrop:function(q){var m=this._view,i=q.event.dataTransfer.getData("Text");if(i)q=m.getOffsetAtLocation(q.x,q.y),this._dragSelection?(this._dropOffset=q,this._dropText=i):
(m.setText(i,q,q),m.setSelection(q,q+i.length))}};return{TextDND:r}});
define("orion/editor/editor","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/eventTarget,orion/editor/tooltip,orion/editor/annotations,orion/util".split(","),function(r,q,m,i,b,e){function f(c){this._textViewFactory=c.textViewFactory;this._undoStackFactory=c.undoStackFactory;this._textDNDFactory=c.textDNDFactory;this._annotationFactory=c.annotationFactory;this._foldingRulerFactory=c.foldingRulerFactory;this._lineNumberRulerFactory=c.lineNumberRulerFactory;this._contentAssistFactory=
c.contentAssistFactory;this._keyBindingFactory=c.keyBindingFactory;this._statusReporter=c.statusReporter;this._domNode=c.domNode;this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null;this._dirty=!1;this._title=this._contentAssist=null;this._keyModes=[]}function h(c){var a=this,b=Array.prototype.slice.call(arguments,1);return b.length?function(){return arguments.length?a.apply(c,b.concat(Array.prototype.slice.call(arguments))):
a.apply(c,b)}:function(){return arguments.length?a.apply(c,arguments):a.call(c)}}f.prototype={destroy:function(){this.uninstallTextView();this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var c=this._textView.getModel();c.getBaseModel&&(c=c.getBaseModel());return c},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},setAnnotationRulerVisible:function(c){if(this._annotationRulerVisible!==
c&&(this._annotationRulerVisible=c,this._annotationRuler)){var a=this._textView;c?a.addRuler(this._annotationRuler,0):a.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(c){if(this._foldingRulerVisible!==c&&(this._foldingRulerVisible=c,this._foldingRuler)){var a=this._textView;a.getModel().getBaseModel&&(c?a.addRuler(this._foldingRuler,100):a.removeRuler(this._foldingRuler))}},setDirty:function(c){if(this._dirty!==c)this._dirty=c,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(c){if(this._lineNumberRulerVisible!==
c&&(this._lineNumberRulerVisible=c,this._lineNumberRuler)){var a=this._textView;c?a.addRuler(this._lineNumberRuler,1):a.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(c){if(this._overviewRulerVisible!==c&&(this._overviewRulerVisible=c,this._overviewRuler)){var a=this._textView;c?a.addRuler(this._overviewRuler):a.removeRuler(this._overviewRuler)}},mapOffset:function(c,a){var b=this._textView.getModel();b.getBaseModel&&(c=b.mapOffset(c,a));return c},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},
getSelection:function(){var c=this._textView,a=c.getSelection(),c=c.getModel();if(c.getBaseModel)a.start=c.mapOffset(a.start),a.end=c.mapOffset(a.end);return a},getText:function(c,a){var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b.getText(c,a)},_expandOffset:function(c){var a=this._textView.getModel(),g=this._annotationModel;if(g&&a.getBaseModel)for(c=g.getAnnotations(c,c+1);c.hasNext();)a=c.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&a.expand&&(a.expand(),g.modifyAnnotation(a))},
setCaretOffset:function(c,a,b){var f=this._textView,e=f.getModel();e.getBaseModel&&(this._expandOffset(c),c=e.mapOffset(c,!0));f.setCaretOffset(c,a,b)},setText:function(c,a,b){var f=this._textView,e=f.getModel();e.getBaseModel&&(a!==void 0&&(this._expandOffset(a),a=e.mapOffset(a,!0)),b!==void 0&&(this._expandOffset(b),b=e.mapOffset(b,!0)));f.setText(c,a,b)},setFoldingEnabled:function(c){this.setFoldingRulerVisible(c)},setSelection:function(c,a,b,e){var f=this._textView,h=f.getModel();h.getBaseModel&&
(this._expandOffset(c),this._expandOffset(a),c=h.mapOffset(c,!0),a=h.mapOffset(a,!0));f.setSelection(c,a,b,e)},moveSelection:function(c,a,b,f){var e=this._textView;this.setSelection(c,a||c,1/3,function(){(f===void 0||f)&&e.focus();b&&b()})},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(c,a,b){this._statusReporter&&this._statusReporter(c,a,b)},_getTooltipInfo:function(c,a){var b=this._textView,f=this.getAnnotationModel();if(!f)return null;var e=this._annotationStyler;
if(!e)return null;var h=b.getOffsetAtLocation(c,a);if(h===-1)return null;h=this.mapOffset(h);e=e.getAnnotationsByType(f,h,h+1);f=[];for(h=0;h<e.length;h++)e[h].rangeStyle&&f.push(e[h]);if(f.length===0)return null;b=b.convert({x:c,y:a},"document","page");return{contents:f,anchor:"left",x:b.x+10,y:b.y+20}},_highlightCurrentLine:function(c,a){var g=this._annotationModel;if(g){var f=this._textView.getModel(),e=a?f.getLineAtOffset(a.start):-1,h=f.getLineAtOffset(c.start),i=c.start===c.end,t=!a||a.start===
a.end,m=f.getLineStart(h),d=f.getLineEnd(h);f.getBaseModel&&(m=f.mapOffset(m),d=f.mapOffset(d));f=this._currentLineAnnotation;if(!(e===h&&t&&i&&f&&f.start===m&&f.end===d)){var e=f?[f]:null,j;i&&(f=b.AnnotationType.createAnnotation(b.AnnotationType.ANNOTATION_CURRENT_LINE,m,d),j=[f]);this._currentLineAnnotation=f;g.replaceAnnotations(e,j)}}},installTextView:function(){this._textView=this._textViewFactory();if(this._undoStackFactory)this._undoStack=this._undoStackFactory.createUndoStack(this);if(this._textDNDFactory)this._textDND=
this._textDNDFactory.createTextDND(this,this._undoStack);if(this._contentAssistFactory){var c=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(c);this._contentAssist=c.getContentAssist()}var a=this,g=this._textView,f=this;this._listener={onModelChanged:function(){f.checkDirty()},onMouseOver:function(a){f._listener.onMouseMove(a)},onMouseMove:function(a){var c=i.Tooltip.getTooltip(g);if(c&&!(f._listener.lastMouseX===a.event.clientX&&f._listener.lastMouseY===a.event.clientY))f._listener.lastMouseX=
a.event.clientX,f._listener.lastMouseY=a.event.clientY,c.setTarget({x:a.x,y:a.y,getTooltipInfo:function(){return f._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(a){var c=i.Tooltip.getTooltip(g);if(c&&!(f._listener.lastMouseX===a.event.clientX&&f._listener.lastMouseY===a.event.clientY))f._listener.lastMouseX=a.event.clientX,f._listener.lastMouseY=a.event.clientY,c.setTarget(null)},onScroll:function(){var a=i.Tooltip.getTooltip(g);a&&a.setTarget(null)},onSelection:function(a){f._updateCursorStatus();
f._highlightCurrentLine(a.newValue,a.oldValue)}};g.addEventListener("ModelChanged",this._listener.onModelChanged);g.addEventListener("Selection",this._listener.onSelection);g.addEventListener("MouseOver",this._listener.onMouseOver);g.addEventListener("MouseOut",this._listener.onMouseOut);g.addEventListener("MouseMove",this._listener.onMouseMove);g.addEventListener("Scroll",this._listener.onScroll);this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist);
g.setKeyBinding(new q.KeyBinding(27),"cancelMode");g.setAction("cancelMode",function(){for(var a=!1,c=0;c<this._keyModes.length;c++)this._keyModes[c].isActive()&&(a=this._keyModes[c].cancel()||a);return a}.bind(this),{name:r.cancelMode});g.setAction("lineUp",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineUp();return!1}.bind(this));g.setAction("lineDown",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineDown();
return!1}.bind(this));g.setAction("enter",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].enter();return!1}.bind(this));c=function(c){if(c!==void 0&&c!==-1){for(var g=this.getView().getModel(),f=this.getAnnotationModel(),d=a.mapOffset(g.getLineStart(c)),c=a.mapOffset(g.getLineEnd(c)),g=f.getAnnotations(d,c),e=null;g.hasNext();){var h=g.next();if(h.type===b.AnnotationType.ANNOTATION_BOOKMARK){e=h;break}}e?f.removeAnnotation(e):(e=b.AnnotationType.createAnnotation(b.AnnotationType.ANNOTATION_BOOKMARK,
d,c),e.title=void 0,f.addAnnotation(e))}};if(this._annotationFactory){var e=g.getModel();e.getBaseModel&&(e=e.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(e))if(e=this._annotationStyler=this._annotationFactory.createAnnotationStyler(g,this._annotationModel))e.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_SEARCH),e.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_SEARCH),e.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),e.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),
e.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_BRACKET),e.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_BRACKET),e.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_LINE),e.addAnnotationType(b.AnnotationType.ANNOTATION_READ_OCCURRENCE),e.addAnnotationType(b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),e.addAnnotationType("orion.annotation.highlightError");g.annotationModel=this._annotationModel;var e=this._annotationFactory.createAnnotationRulers(this._annotationModel),h=this._annotationRuler=
e.annotationRuler;if(h)h.onDblClick=c,h.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),h.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),h.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),h.addAnnotationType(b.AnnotationType.ANNOTATION_TASK),h.addAnnotationType(b.AnnotationType.ANNOTATION_BOOKMARK);this.setAnnotationRulerVisible(!0);if(h=this._overviewRuler=e.overviewRuler)h.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_SEARCH),h.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_SEARCH),
h.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),h.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),h.addAnnotationType(b.AnnotationType.ANNOTATION_TASK),h.addAnnotationType(b.AnnotationType.ANNOTATION_BOOKMARK),h.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_BRACKET),h.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_BRACKET),h.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_LINE),h.addAnnotationType(b.AnnotationType.ANNOTATION_READ_OCCURRENCE),h.addAnnotationType(b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE);
this.setOverviewRulerVisible(!0)}if(this._lineNumberRulerFactory)this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=c,this.setLineNumberRulerVisible(!0);if(this._foldingRulerFactory)this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(b.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1);this.dispatchEvent({type:"TextViewInstalled",textView:g})},
uninstallTextView:function(){var c=this._textView;if(c)c.destroy(),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[],this.dispatchEvent({type:"TextViewUninstalled",textView:c})},_updateCursorStatus:function(){var c=this.getModel(),a=this.getCaretOffset(),b=c.getLineAtOffset(a),
c=c.getLineStart(b);a-=c;for(c=0;c<this._keyModes.length;c++){var f=this._keyModes[c];if(f.isActive()&&f.isStatusActive&&f.isStatusActive())return}this.reportStatus(e.formatMessage(r.lineColumn,b+1,a+1))},showProblems:function(c){var a=this._annotationModel;if(a){for(var g=[],f=[],e=a.getTextModel(),h=a.getAnnotations(0,e.getCharCount()),i;h.hasNext();)i=h.next(),(i.type===b.AnnotationType.ANNOTATION_ERROR||i.type===b.AnnotationType.ANNOTATION_WARNING)&&g.push(i);if(c)for(h=0;h<c.length;h++)if(i=
c[h]){var m=i.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;"),q=e.getLineStart(i.line-1);i=b.AnnotationType.createAnnotation(i.severity==="error"?b.AnnotationType.ANNOTATION_ERROR:b.AnnotationType.ANNOTATION_WARNING,q+i.start-1,q+i.end,m);f.push(i)}a.replaceAnnotations(g,f)}},showOccurrences:function(c){var a=this._annotationModel;if(a){for(var g=[],f=[],e=a.getTextModel(),h=a.getAnnotations(0,e.getCharCount()),i;h.hasNext();)i=h.next(),(i.type===b.AnnotationType.ANNOTATION_READ_OCCURRENCE||
i.type===b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&g.push(i);if(c)for(h=0;h<c.length;h++)if(i=c[h]){var m=e.getLineStart(i.line-1);i=b.AnnotationType.createAnnotation(i.readAccess===!0?b.AnnotationType.ANNOTATION_READ_OCCURRENCE:b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,m+i.start-1,m+i.end,i.description);f.push(i)}a.replaceAnnotations(g,f)}},showSelection:function(c,a,b,f,e){typeof c==="number"?(typeof a!=="number"&&(a=c),this.moveSelection(c,a)):typeof b==="number"&&(c=this.getModel().getLineStart(b-
1),typeof f==="number"&&(c+=f),typeof e!=="number"&&(e=0),this.moveSelection(c,c+e))},setInput:function(c,a,b,f){this._title=c;this._textView&&(f?(this._undoStack.markClean(),this.checkDirty()):(a?this._textView.setText(a):b!==null&&b!==void 0&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus()));this.onInputChanged({type:"InputChanged",title:c,message:a,
contents:b,contentsSaved:f})},onInputChanged:function(c){return this.dispatchEvent(c)},onGotoLine:function(c,a,b){if(this._textView){var f=this.getModel(),e=f.getLineStart(c),h=0;b===void 0&&(b=0);typeof a==="string"?(c=f.getLine(c).indexOf(a),c!==-1&&(h=c,b=h+a.length)):(h=a,a=f.getLineEnd(c)-e,h=Math.min(h,a),b=Math.min(b,a));this.moveSelection(e+h,e+b)}},onDirtyChanged:function(c){return this.dispatchEvent(c)}};m.EventTarget.addMixin(f.prototype);if(!Function.prototype.bind)Function.prototype.bind=
h;return{Editor:f}});define("orion/editor/regex",[],function(){return{escape:function(r){return r.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(r){return(r=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(r))?{pattern:r[1],flags:r[2]}:null}}});
define("orion/editor/editorFeatures","i18n!orion/editor/nls/messages,orion/editor/undoStack,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/textDND,orion/editor/regex,orion/util".split(","),function(r,q,m,i,b,e,f,h,c){function a(){}function g(){}function p(){}function n(){}function o(){}function s(a){this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";var c=this;this._listener={onVerify:function(a){var d=c.editor,
b=d.getModel(),f=d.mapOffset(a.start),d=d.mapOffset(a.end),b=b.getText(f,d);if((b=c._prefix.match(RegExp("^"+h.escape(b),"i")))&&b.length>0)c._prefix+=a.text,c._success=!0,c._status(),c.find(!0),a.text=null},onSelection:function(){c._ignoreSelection||c.setActive(!1)}}}function t(a,c,d){this.editor=a;this.undoStack=c;this._incrementalFind=new s(a);this._searcher=d;this._lastEditLocation=null;this.init()}function v(a,c,d,b){this.editor=a;this.undoStack=c;this.contentAssist=d;this.linkedMode=b;this.contentAssist&&
this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}function d(a){this.editor=a;this.linkedModeActive=!1;this.linkedModePositions=[];this.linkedModeEscapePosition=this.linkedModeCurrentPositionIndex=0;this.linkedModeListener={onVerify:function(a){for(var c=!1,d=0,b=0;b<this.linkedModePositions.length;++b){var f=this.linkedModePositions[b];if(c)f.offset+=d;else if(a.start>=f.offset&&a.end<=f.offset+f.length)c=f.length,f.length=a.start-f.offset+
a.text.length+(f.offset+f.length-a.end),d=f.length-c,c=!0}c?this.linkedModeEscapePosition+=d:this.cancel()}.bind(this)}}a.prototype={createUndoStack:function(a){var a=a.getTextView(),c=new q.UndoStack(a,200);a.setAction("undo",function(){c.undo();return!0},{name:r.undo});a.setAction("redo",function(){c.redo();return!0},{name:r.redo});return c}};g.prototype={createLineNumberRuler:function(a){return new i.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};
p.prototype={createFoldingRuler:function(a){return new i.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};n.prototype={createAnnotationModel:function(a){return new b.AnnotationModel(a)},createAnnotationStyler:function(a,c){return new b.AnnotationStyler(a,c)},createAnnotationRulers:function(a){var c=new i.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new i.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:c,overviewRuler:a}}};o.prototype={createTextDND:function(a,
c){return new f.TextDND(a.getTextView(),c)}};s.prototype={backspace:function(){if(!this.isActive())return!1;var a=this._prefix,a=this._prefix=a.substring(0,a.length-1);return a.length===0?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(!1)},find:function(a){if(!this.isActive())return!1;var c=this._prefix;if(c.length===0)return!1;var d=this.editor,b=d.getModel(),b=a?this._success?d.getSelection().start+
1:0:this._success?d.getCaretOffset()-c.length-1:b.getCharCount()-1;(a=d.getModel().find({string:c,start:b,reverse:!a,caseInsensitive:c.toLowerCase()===c}).next())?(this._ignoreSelection=this._success=!0,d.moveSelection(a.start,a.end),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},setActive:function(a){this._active=a;this._prefix="";this._success=!0;a=this.editor.getTextView();this.editor.setCaretOffset(this.editor.getCaretOffset());this._active?
(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection));this._status()},_status:function(){this.isActive()?this.editor.reportStatus(c.formatMessage(this._success?r.incrementalFind:r.incrementalFindNotFound,this._prefix),this._success?"":"error"):this.editor.reportStatus("")}};t.prototype={init:function(){var a=this,d=this.editor.getTextView();
this._lastEditListener={onModelChanged:function(d){if(a.editor.isDirty())a._lastEditLocation=d.start+d.addedCharCount}};d.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);d.setKeyBinding(new m.KeyBinding("k",!0),"findNext");d.setAction("findNext",function(){if(this._searcher){var a=d.getSelection();a.start<a.end?this._searcher.findNext(!0,d.getText(a.start,a.end)):this._searcher.findNext(!0);return!0}return!1}.bind(this),{name:r.findNext});d.setKeyBinding(new m.KeyBinding("k",
!0,!0),"findPrevious");d.setAction("findPrevious",function(){if(this._searcher){var a=d.getSelection();a.start<a.end?this._searcher.findNext(!1,d.getText(a.start,a.end)):this._searcher.findNext(!1);return!0}return!1}.bind(this),{name:r.findPrevious});d.setKeyBinding(new m.KeyBinding("j",!0),"incrementalFind");d.setAction("incrementalFind",function(){if(this._searcher&&this._searcher.visible())return!0;this._incrementalFind.isActive()?this._incrementalFind.find(!0):this._incrementalFind.setActive(!0);
return!0}.bind(this),{name:r.incrementalFindKey});d.setAction("deletePrevious",function(){return this._incrementalFind.backspace()}.bind(this));d.setAction("tab",function(){if(d.getOptions("readonly"))return!1;if(d.getOptions("tabMode")){var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start),g=c.getLineAtOffset(b.end>b.start?b.end-1:b.end);if(f!==g){var e=[];e.push("");for(var h=f;h<=g;h++)e.push(c.getLine(h,!0));var h=c.getLineStart(f),c=c.getLineEnd(g,!0),j=d.getOptions("tabSize",
"expandTab"),j=j.expandTab?Array(j.tabSize+1).join(" "):"\t";a.setText(e.join(j),h,c);a.setSelection(h===b.start?b.start:b.start+j.length,b.end+(g-f+1)*j.length);return!0}a=a.getKeyModes();for(b=0;b<a.length;b++)if(a[b].isActive())return a[b].tab();return!1}}.bind(this));d.setAction("shiftTab",function(){if(d.getOptions("readonly"))return!1;if(d.getOptions("tabMode")){for(var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start),g=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),
e=d.getOptions("tabSize"),h=Array(e+1).join(" "),j=[],i=0,n=0,o=f;o<=g;o++){var p=c.getLine(o,!0);if(c.getLineStart(o)!==c.getLineEnd(o))if(p.indexOf("\t")===0)p=p.substring(1),i++;else if(p.indexOf(h)===0)p=p.substring(e),i+=e;else return!0;o===f&&(n=i);j.push(p)}f=c.getLineStart(f);e=c.getLineEnd(g,!0);c=c.getLineStart(g);a.setText(j.join(""),f,e);j=f===b.start?b.start:b.start-n;b=Math.max(j,b.end-i+(b.end===c+1&&b.start!==b.end?1:0));a.setSelection(j,b);return!0}}.bind(this),{name:r.unindentLines});
d.setKeyBinding(new m.KeyBinding(38,!1,!1,!0),"moveLinesUp");d.setAction("moveLinesUp",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start);if(f===0)return!0;var e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),g=c.getLineCount(),b=c.getLineStart(f-1),h=c.getLineStart(f),j=c.getLineEnd(e,!0),i=c.getText(h,j),n=0;e===g-1&&(e=c.getLineEnd(f-1),f=c.getLineEnd(f-1,!0),i+=c.getText(e,f),h=e,n=f-e);this.startUndo();a.setText("",
h,j);a.setText(i,b,b);a.setSelection(b,b+i.length-n);this.endUndo();return!0}.bind(this),{name:r.moveLinesUp});d.setKeyBinding(new m.KeyBinding(40,!1,!1,!0),"moveLinesDown");d.setAction("moveLinesDown",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start),e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),g=c.getLineCount();if(e===g-1)return!0;var f=c.getLineStart(f),b=c.getLineEnd(e,!0),h=c.getLineEnd(e+1,!0)-(b-f),j=0;e!==
g-2?c=c.getText(f,b):(e=c.getLineEnd(e),c=c.getText(e,b)+c.getText(f,e),j+=b-e);this.startUndo();a.setText("",f,b);a.setText(c,h,h);a.setSelection(h+j,h+j+c.length);this.endUndo();return!0}.bind(this),{name:r.moveLinesDown});d.setKeyBinding(new m.KeyBinding(38,!0,!1,!0),"copyLinesUp");d.setAction("copyLinesUp",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start),b=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=c.getLineStart(f),
e=c.getLineEnd(b,!0),g=c.getLineCount(),h="",e=c.getText(f,e);b===g-1&&(e+=h=c.getLineDelimiter());a.setText(e,f,f);a.setSelection(f,f+e.length-h.length);return!0}.bind(this),{name:r.copyLinesUp});d.setKeyBinding(new m.KeyBinding(40,!0,!1,!0),"copyLinesDown");d.setAction("copyLinesDown",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start),b=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),e=c.getLineStart(f),f=c.getLineEnd(b,
!0),g=c.getLineCount(),h="",e=c.getText(e,f);b===g-1&&(e=(h=c.getLineDelimiter())+e);a.setText(e,f,f);a.setSelection(f+h.length,f+e.length);return!0}.bind(this),{name:r.copyLinesDown});d.setKeyBinding(new m.KeyBinding("d",!0,!1,!1),"deleteLines");d.setAction("deleteLines",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,c=a.getSelection(),b=a.getModel(),f=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineStart(f),b=b.getLineEnd(c,!0);a.setText("",
f,b);return!0}.bind(this),{name:r.deleteLines});d.setKeyBinding(new m.KeyBinding("l",!0),"gotoLine");d.setAction("gotoLine",function(){var a=this.editor,c=a.getModel().getLineAtOffset(a.getCaretOffset());if(c=prompt(r.gotoLinePrompty,c+1))c=parseInt(c,10),a.onGotoLine(c-1,0);return!0}.bind(this),{name:r.gotoLine});d.setKeyBinding(new m.KeyBinding(190,!0),"nextAnnotation");d.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:r.nextAnnotation});d.setKeyBinding(new m.KeyBinding(188,
!0),"previousAnnotation");d.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:r.prevAnnotation});d.setKeyBinding(new m.KeyBinding("e",!0,!1,!0,!1),"expand");d.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:r.expand});d.setKeyBinding(new m.KeyBinding("c",!0,!1,!0,!1),"collapse");d.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:r.collapse});d.setKeyBinding(new m.KeyBinding("e",!0,!0,!0,!1),
"expandAll");d.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:r.expandAll});d.setKeyBinding(new m.KeyBinding("c",!0,!0,!0,!1),"collapseAll");d.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:r.collapseAll});d.setKeyBinding(new m.KeyBinding("q",!c.isMac,!1,!1,c.isMac),"lastEdit");d.setAction("lastEdit",function(){typeof this._lastEditLocation==="number"&&this.editor.showSelection(this._lastEditLocation);return!0}.bind(this),
{name:r.lastEdit})},nextAnnotation:function(a){var c=this.editor,d=c.getAnnotationModel();if(!d)return!0;for(var f=c.getModel(),g=c.getCaretOffset(),d=d.getAnnotations(a?g:0,a?f.getCharCount():g),h=null;d.hasNext();){var i=d.next();if(a){if(i.start<=g)continue}else if(i.start>=g)continue;switch(i.type){case b.AnnotationType.ANNOTATION_ERROR:case b.AnnotationType.ANNOTATION_WARNING:case b.AnnotationType.ANNOTATION_TASK:case b.AnnotationType.ANNOTATION_BOOKMARK:break;default:continue}h=i;if(a)break}if(h){var n=
c.getTextView(),o=f.getLineAtOffset(h.start),p=e.Tooltip.getTooltip(n);if(!p)return c.moveSelection(h.start),!0;c.moveSelection(h.start,h.start,function(){p.setTarget({getTooltipInfo:function(){var a=n.convert({x:n.getLocationAtOffset(h.start).x,y:n.getLocationAtOffset(f.getLineStart(o)).y},"document","page");return{contents:[h],x:a.x,y:a.y+Math.floor(n.getLineHeight(o)*1.33)}}},0)})}return!0},expandAnnotation:function(a){var c=this.editor,d=c.getAnnotationModel();if(!d)return!0;var f=c.getModel(),
e=c.getCaretOffset(),g=f.getLineAtOffset(e),e=f.getLineStart(g),g=f.getLineEnd(g,!0);f.getBaseModel&&(e=f.mapOffset(e),g=f.mapOffset(g),f.getBaseModel());for(var h,f=d.getAnnotations(e,g);!h&&f.hasNext();)e=f.next(),e.type===b.AnnotationType.ANNOTATION_FOLDING&&(h=e);h&&a!==h.expanded&&(a?h.expand():(c.setCaretOffset(h.start),h.collapse()),d.modifyAnnotation(h));return!0},expandAnnotations:function(a){var c=this.editor,d=c.getTextView(),f=c.getAnnotationModel();if(!f)return!0;var c=c.getModel(),e=
f.getAnnotations(0,c.getCharCount());for(d.setRedraw(!1);e.hasNext();)c=e.next(),c.type===b.AnnotationType.ANNOTATION_FOLDING&&a!==c.expanded&&(a?c.expand():c.collapse(),f.modifyAnnotation(c));d.setRedraw(!0);return!0},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this._incrementalFind.setActive(!1)},isActive:function(){return this._incrementalFind.isActive()},isStatusActive:function(){return this._incrementalFind.isActive()},
lineUp:function(){return this._incrementalFind.find(!1)},lineDown:function(){return this._incrementalFind.find(!0)},enter:function(){return!1}};v.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function a(c,d,b){var f=c.getLineAtOffset(d),e=c.getLineAtOffset(b),g,h,j,i,n,l;for(g=f;g>=0;g--)if(h=c.getLine(g),j=g===f?d-c.getLineStart(f):h.length,i=h.lastIndexOf("/*",j),h=h.lastIndexOf("*/",
j),h>i)break;else if(i!==-1){n=c.getLineStart(g)+i;break}for(g=e;g<c.getLineCount();g++)if(h=c.getLine(g),j=g===e?b-c.getLineStart(e):0,i=h.indexOf("/*",j),h=h.indexOf("*/",j),i!==-1&&i<h)break;else if(h!==-1){l=c.getLineStart(g)+h;break}return{commentStart:n,commentEnd:l}}var d=this.editor.getTextView();d.setAction("lineStart",function(){for(var a=this.editor,c=a.getModel(),d=a.getCaretOffset(),b=c.getLineAtOffset(d),f=c.getLineStart(b),c=c.getLine(b),b=0;b<c.length;b++){var e=c.charCodeAt(b);if(!(e===
32||e===9))break}b+=f;return d!==b?(a.setSelection(b,b),!0):!1}.bind(this));d.setKeyBinding(new m.KeyBinding(191,!0),"toggleLineComment");d.setAction("toggleLineComment",function(){if(d.getOptions("readonly"))return!1;for(var a=this.editor,c=a.getModel(),b=a.getSelection(),f=c.getLineAtOffset(b.start),e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),g=!0,h=[],j,i,n=f;n<=e;n++)if(j=c.getLine(n,!0),h.push(j),!g||(i=j.indexOf("//"))===-1)g=!1;else if(i!==0){var o;for(o=0;o<i;o++)if(g=j.charCodeAt(o),
!(g===32||g===9))break;g=o===i}n=c.getLineStart(f);o=c.getLineEnd(e,!0);if(g){for(g=0;g<h.length;g++)j=h[g],i=j.indexOf("//"),h[g]=j.substring(0,i)+j.substring(i+2);h=h.join("");j=c.getLineStart(e);c=n===b.start?b.start:b.start-2;b=b.end-2*(e-f+1)+(b.end===j+1?2:0)}else h.splice(0,0,""),h=h.join("//"),c=n===b.start?b.start:b.start+2,b=b.end+2*(e-f+1);a.setText(h,n,o);a.setSelection(c,b);return!0}.bind(this),{name:r.toggleLineComment});d.setKeyBinding(new m.KeyBinding(191,!0,!c.isMac,!1,c.isMac),"addBlockComment");
d.setAction("addBlockComment",function(){if(d.getOptions("readonly"))return!1;var c=this.editor,b=c.getModel(),f=c.getSelection(),e=RegExp("/\\*|\\*/","g"),g=a(b,f.start,f.end);if(g.commentStart!==void 0&&g.commentEnd!==void 0)return!0;b=b.getText(f.start,f.end);if(b.length===0)return!0;g=b.length;b=b.replace(e,"");e=b.length;c.setText("/*"+b+"*/",f.start,f.end);c.setSelection(f.start+2,f.end+2+(e-g));return!0}.bind(this),{name:r.addBlockComment});d.setKeyBinding(new m.KeyBinding(220,!0,!c.isMac,
!1,c.isMac),"removeBlockComment");d.setAction("removeBlockComment",function(){if(d.getOptions("readonly"))return!1;var c=this.editor,b=c.getModel(),f=c.getSelection(),e=b.getText(f.start,f.end),g,h,i;for(i=0;i<e.length;i++)if(e.substring(i,i+2)==="/*"){g=f.start+i;break}for(;i<e.length;i++)if(e.substring(i,i+2)==="*/"){h=f.start+i;break}if(g!==void 0&&h!==void 0)c.setText(b.getText(g+2,h),g,h+2),c.setSelection(g,h);else{e=a(b,f.start,f.end);if(e.commentStart===void 0||e.commentEnd===void 0)return!0;
b=b.getText(e.commentStart+2,e.commentEnd);c.setText(b,e.commentStart,e.commentEnd+2);c.setSelection(f.start-2,f.end-2)}return!0}.bind(this),{name:r.removeBlockComment})},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&this.linkedMode){for(var c=[],d=0;d<a.positions.length;++d)c[d]={positions:[{offset:a.positions[d].offset,length:a.positions[d].length}]};this.linkedMode.enterLinkedMode({groups:c,escapePosition:a.escapePosition})}else a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){if(this.editor.getTextView().getOptions("readonly"))return!1;var a=this.editor,c=a.getSelection();if(c.start===c.end){for(var d=a.getModel(),b=d.getLineAtOffset(c.start),f=d.getLine(b,!0),e=d.getLineStart(b),b=0,e=c.start-e,g;b<e&&((g=f.charCodeAt(b))===32||g===9);)b++;if(b>0){for(var h=f.substring(0,b),b=e;b<f.length&&((g=
f.charCodeAt(b++))===32||g===9);)c.end++;a.setText(d.getLineDelimiter()+h,c.start,c.end);return!0}}return!1},tab:function(){return!1}};d.prototype={enterLinkedMode:function(a){if(!this.linkedModeActive){this.linkedModeActive=!0;this.linkedModePositions=[];for(var c=0;c<a.groups.length;++c){var d=a.groups[c];this.linkedModePositions[c]={offset:d.positions[0].offset,length:d.positions[0].length}}this.linkedModeEscapePosition=a.escapePosition;this.linkedModeCurrentPositionIndex=0;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
a=this.editor.getTextView();a.addEventListener("Verify",this.linkedModeListener.onVerify);a.setKeyBinding(new m.KeyBinding(9),"nextLinkedModePosition");a.setAction("nextLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));a.setKeyBinding(new m.KeyBinding(9,!1,!0),"previousLinkedModePosition");a.setAction("previousLinkedModePosition",
function(){this.linkedModeCurrentPositionIndex=this.linkedModeCurrentPositionIndex>0?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.editor.reportStatus(r.linkedModeEntered,null,!0)}},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){this.cancel();return!0},cancel:function(a){if(this.linkedModeActive){this.linkedModeActive=
!1;var c=this.editor.getTextView();c.removeEventListener("Verify",this.linkedModeListener.onVerify);c.setKeyBinding(new m.KeyBinding(9),"tab");c.setKeyBinding(new m.KeyBinding(9,!1,!0),"shiftTab");a||c.setCaretOffset(this.linkedModeEscapePosition,!1);this.editor.reportStatus(r.linkedModeExited,null,!0)}},lineUp:function(){this.cancel(!0);return!1},lineDown:function(){this.cancel(!0);return!1},selectTextForLinkedModePosition:function(a){this.editor.getTextView().setSelection(a.offset,a.offset+a.length)}};
return{UndoFactory:a,LineNumberRulerFactory:g,FoldingRulerFactory:p,AnnotationFactory:n,TextDNDFactory:o,TextActions:t,SourceCodeActions:v,LinkedMode:d}});
(function(r,q){typeof define==="function"&&define.amd?define("orion/Deferred",[],q):typeof exports==="object"?module.exports=q():(r.orion=r.orion||{},r.orion.Deferred=q())})(this,function(){function r(){for(var a;a=f.shift()||h.shift();)a();c=!1}function q(a,b){(b?h:f).push(a);c||(c=!0,b?setTimeout(r,0):r())}function m(a){return function(){a.apply(null,arguments)}}function i(){}function b(){var a=Error("Cancel");a.name="Cancel";return a}function e(){function a(){for(var a;a=h.shift();){var b=a.deferred,
e=f==="resolved"?"resolve":"reject";if(typeof a[e]==="function")try{var d=a[e](c);d&&typeof d.then==="function"?(b.cancel=d.cancel||i,d.then(m(b.resolve),m(b.reject),b.progress)):b.resolve(d)}catch(j){b.reject(j)}else b[e](c)}}var c,f,h=[],o=this;this.reject=function(b){f||(f="rejected",c=b,h.length&&q(a));return o.promise};this.resolve=function(b){f||(f="resolved",c=b,h.length&&q(a));return o.promise};this.progress=function(a){f||h.forEach(function(c){c.progress&&c.progress(a)});return o.promise};
this.cancel=function(){f||o.reject(b())};this.then=function(c,b,g){var c={resolve:c,reject:b,progress:g,deferred:new e},d=c.deferred,i=this.cancel.bind(this),o=function(){q(function(){(d.cancel===o?i:d.cancel)()},!0)};d.cancel=o;b=d.promise;b.cancel=function(){d.cancel()};h.push(c);f&&q(a,!0);return b}.bind(this);this.promise={then:this.then,cancel:this.cancel}}var f=[],h=[],c=!1;e.all=function(a,c){function b(a,c){m||(i[a]=c,--h===0&&q.resolve(i))}function f(a,e){if(!m){if(c)try{b(a,c(e));return}catch(h){e=
h}q.reject(e)}}var h=a.length,i=[],m=!1,q=new e;q.then(null,function(){m=!0;a.forEach(function(a){a.cancel&&a.cancel()})});h===0?q.resolve(i):a.forEach(function(a,c){a.then(b.bind(null,c),f.bind(null,c))});return q.promise};e.when=function(a,c,b,f){var h;if(!(a&&typeof a.then==="function"))h=new e,h.resolve(a),a=h.promise;return a.then(c,b,f)};return e});
define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/eventTarget","orion/Deferred","orion/util"],function(r,q,m,i,b){var e,f,h;function c(a){this.textView=a;this.state=e;this.providers=[];var c=this;this.contentAssistListener={onModelChanging:function(a){c.isDeactivatingChange(a)?c.setState(e):c.state===f&&c.setState(h)},onScroll:function(){c.setState(e)},onSelection:function(){var a=c.state;if(a===f||a===h)c.computeProposals(),c.setState(h)}};a.setKeyBinding(b.isMac?
new q.KeyBinding(" ",!1,!1,!1,!0):new q.KeyBinding(" ",!0),"contentAssist");a.setAction("contentAssist",function(){c.activate();return!0},{name:r.contentAssist})}function a(a,c){this.contentAssist=a;this.widget=c;this.proposals=[];var b=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){b.proposals=a.data.proposals;b.selectedIndex=b.proposals.length?0:-1})}function g(a,c){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=
!1;var f=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof c==="string"?f.getElementById(c):c;if(!this.parentNode){this.parentNode=b.createElement(f,"div");this.parentNode.className="contentassist";var e=f.getElementsByTagName("body")[0];if(e)e.appendChild(this.parentNode);else throw Error("parentNode is required");}var g=this;this.textViewListener={onMouseDown:function(a){a.event.target.parentElement!==g.parentNode&&g.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",
function(a){g.setProposals(a.data.proposals);g.show();if(!g.textViewListenerAdded)g.textView.addEventListener("MouseDown",g.textViewListener.onMouseDown),g.textViewListenerAdded=!0});this.contentAssist.addEventListener("Deactivating",function(){g.setProposals([]);g.hide();if(g.textViewListenerAdded)g.textView.removeEventListener("MouseDown",g.textViewListener.onMouseDown),g.textViewListenerAdded=!1;g.textViewListenerAdded=!1});this.scrollListener=function(){g.isShowing&&g.position()};f.addEventListener&&
f.addEventListener("scroll",this.scrollListener)}e=1;f=2;h=3;var p={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};c.prototype={apply:function(a){if(!a)return!1;var c=this.textView.getSelection(),b=Math.min(c.start,c.end),c=Math.max(c.start,c.end);a.overwrite&&(b=this.getPrefixStart(b));var f={proposal:a,start:b,end:c};this.setState(e);this.textView.setText(a.proposal||a,b,c);this.dispatchEvent({type:"ProposalApplied",
data:f});return!0},activate:function(){this.state===e&&this.setState(f)},deactivate:function(){this.setState(e)},getTextView:function(){return this.textView},isActive:function(){return this.state===f||this.state===h},isDeactivatingChange:function(a){var c=a.removedCharCount>0&&a.addedCharCount===0,b=this.textView,b=a.start+1<=b.getModel().getCharCount()&&/^\s*$/.test(b.getText(a.start,a.start+1));return a.removedLineCount>0||a.addedLineCount>0||c&&b},setState:function(a){var c;a===f?c="Activating":
a===e&&(c="Deactivating");c&&this.dispatchEvent({type:c});this.state=a;this.onStateChange(a)},onStateChange:function(a){if(a===e){if(this.listenerAdded)this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1}else if(a===f){if(!this.listenerAdded)this.textView.addEventListener("ModelChanging",
this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0;this.computeProposals()}},computeProposals:function(){var a=this;this._computeProposals(this.textView.getCaretOffset()).then(function(c){a.dispatchEvent({type:"ProposalsComputed",data:{proposals:c}})})},getPrefixStart:function(a){for(;a>0&&/[A-Za-z0-9_]/.test(this.textView.getText(a-
1,a));)a--;return a},handleError:function(a){typeof console!=="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(a))},_computeProposals:function(a){var c=this.providers,b=this.textView,f=b.getModel(),e=b.getText(),d={line:f.getLine(f.getLineAtOffset(a)),prefix:b.getText(this.getPrefixStart(a),a),selection:b.getSelection()},g=this,c=c.map(function(c){var b=c.computeProposals||c.getProposals,f;try{typeof b==="function"&&(f=g.progress?g.progress.progress(b.apply(c,[e,
a,d]),"Generating content assist proposal"):b.apply(c,[e,a,d]))}catch(h){g.handleError(h)}return i.when(f)});return i.all(c,this.handleError).then(function(a){return a.reduce(function(a,c){return c instanceof Array?a.concat(c):a},[])})},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};m.EventTarget.addMixin(c.prototype);a.prototype={cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},
lineUp:function(){for(var a=this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1;this.proposals[a].unselectable&&a>0;)a--;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){for(var a=this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1;this.proposals[a].unselectable&&a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||
null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),!0):!1}};g.prototype={onClick:function(a){this.contentAssist.apply(this.getProposal(a.target));this.textView.focus()},createDiv:function(a,c,f,e){var g=f.ownerDocument,d=b.createElement(g,"div");d.id="contentoption"+e;d.setAttribute("role","option");a.style==="hr"?a=b.createElement(g,"hr"):(d.className=this.calculateClasses(a.style,c),a=g.createTextNode(this.getDisplayString(a)),c&&this.parentNode.setAttribute("aria-activedescendant",
d.id));d.appendChild(a,d);f.appendChild(d)},createAccessible:function(a){this._isAccessible||this.parentNode.addEventListener("keydown",function(c){c.preventDefault();if(c.keyCode===27)return a.cancel();else if(c.keyCode===38)return a.lineUp();else if(c.keyCode===40)return a.lineDown();else if(c.keyCode===13)return a.enter();return!1});this._isAccessible=!0},calculateClasses:function(a,c){var b=p[a];if(!b)b=p.dfault;return c?b+p.selected:b},getDisplayString:function(a){return typeof a==="string"?
a:a.description&&typeof a.description==="string"?a.description:a.proposal},getProposal:function(a){for(var c=0,b=this.parentNode.firstChild;b!==null;b=b.nextSibling){if(b===a)return this.proposals[c]||null;c++}return null},setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(a){for(var c=this.parentNode.childNodes,b=0;b<c.length;b++){var f=c[b],e=f.className.indexOf(p.selected);if(e>=0)f.className=f.className.substring(0,
e)+f.className.substring(e+p.selected.length);f===a&&(f.className+=p.selected,this.parentNode.setAttribute("aria-activedescendant",f.id),f.focus(),f.offsetTop<this.parentNode.scrollTop?f.scrollIntoView(!0):f.offsetTop+f.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&f.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(this.proposals.length===0)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],
a===0,this.parentNode,a);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.textView.getLocationAtOffset(this.textView.getCaretOffset());a.y+=this.textView.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";
this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;var c=this.parentNode.ownerDocument,b=c.documentElement.clientWidth;if(a.y+this.parentNode.offsetHeight>c.documentElement.clientHeight)this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px";if(a.x+this.parentNode.offsetWidth>b)this.parentNode.style.left=b-this.parentNode.offsetWidth+"px"}};return{ContentAssist:c,ContentAssistMode:a,
ContentAssistWidget:g}});
define("orion/editor/cssContentAssist",[],function(){function r(){}var q="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(",");r.prototype=
{computeProposals:function(m,i){var b;for(b=i;b&&/[A-Za-z\-]/.test(m.charAt(b-1));)b--;b=b?m.substring(b,i):"";for(var e=[],f=0;f<q.length;f++){var h=q[f];h.indexOf(b)===0&&e.push({proposal:h.substring(b.length),description:h})}return e}};return{CssContentAssistProvider:r}});
define("orion/editor/htmlContentAssist",[],function(){function r(){}r.prototype={leadingWhitespace:function(q,m){var i="";for(m-=1;m>0;){var b=q.charAt(m--);if(b==="\n"||b==="\r")break;i=/\s/.test(b)?b.concat(i):""}return i},computeProposals:function(q,m,i){function b(a){return a.substring(i.prefix.length)}var e=[];if(q.length===0)return e.push({proposal:'<!DOCTYPE html>\n<html lang="en">\n\t<head>\n\t\t<meta charset=utf-8>\n\t\t<title>My Document</title>\n\t</head>\n\t<body>\n\t\t<h1>A basic HTML document</h1>\n\t\t<p>\n\t\t\t\n\t\t</p>\n\t</body>\n</html>',
description:"Simple HTML document",escapePosition:m+152}),e;var f=i.prefix;if(q.charAt(m-f.length-1)!=="<")return e;for(var h,c,a="abbr,b,button,canvas,cite,command,dd,del,dfn,dt,em,embed,font,h1,h2,h3,h4,h5,h6,i,ins,kbd,label,li,mark,meter,object,option,output,progress,q,rp,rt,samp,small,strong,sub,sup,td,time,title,tt,u,var".split(","),g=0;g<a.length;g++)h=a[g],h.indexOf(f)===0&&(c=h+"></"+h+">",h=m+h.length-f.length+1,e.push({proposal:b(c),description:"<"+c,escapePosition:h}));a="address,article,aside,audio,bdo,blockquote,body,caption,code,colgroup,datalist,details,div,fieldset,figure,footer,form,head,header,hgroup,iframe,legend,map,menu,nav,noframes,noscript,optgroup,p,pre,ruby,script,section,select,span,style,tbody,textarea,tfoot,th,thead,tr,video".split(",");
q=this.leadingWhitespace(q,m);for(g=0;g<a.length;g++)h=a[g],h.indexOf(f)===0&&(c=h+">\n"+q+"\t\n"+q+"</"+h+">",h=m+h.length-f.length+q.length+3,e.push({proposal:b(c),description:"<"+c,escapePosition:h}));a="area,base,br,col,hr,input,link,meta,param,keygen,source".split(",");for(g=0;g<a.length;g++)h=a[g],h.indexOf(f)===0&&(c=h+"/>",h=m+h.length-f.length+2,e.push({proposal:b(c),description:"<"+c,escapePosition:h}));"img".indexOf(f)===0&&(c='img src="" alt="Image"/>',e.push({proposal:b(c),description:"<"+
c,escapePosition:m+9-f.length}));f==="a"&&e.push({proposal:b('a href=""></a>'),description:"<a></a> - HTML anchor element",escapePosition:m+7});"ul".indexOf(f)===0&&(c="<ul> - unordered list",h=m-f.length+q.length+9,e.push({proposal:b("ul>\n"+q+"\t<li></li>\n"+q+"</ul>"),description:c,escapePosition:h}));"ol".indexOf(f)===0&&(c="<ol> - ordered list",h=m-f.length+q.length+9,e.push({proposal:b("ol>\n"+q+"\t<li></li>\n"+q+"</ol>"),description:c,escapePosition:h}));"dl".indexOf(f)===0&&(c="<dl> - definition list",
h=m-f.length+q.length+9,e.push({proposal:b("dl>\n"+q+"\t<dt></dt>\n"+q+"\t<dd></dd>\n"+q+"</dl>"),description:c,escapePosition:h}));"table".indexOf(f)===0&&(c="<table> - basic HTML table",h=m-f.length+q.length*2+19,e.push({proposal:b("table>\n"+q+"\t<tr>\n"+q+"\t\t<td></td>\n"+q+"\t</tr>\n"+q+"</table>"),description:c,escapePosition:h}));return e}};return{HTMLContentAssistProvider:r}});
define("orion/editor/jsTemplateContentAssist",[],function(){function r(b,e,f){var h=f-b.length,c=[],a="";for(f-=1;f>0;){var g=e.charAt(f--);if(g==="\n"||g==="\r")break;a=/\s/.test(g)?g.concat(a):""}e=a;"if".indexOf(b)===0&&(f="if - if statement",a=[{offset:h+4,length:9}],g=h+e.length+18,c.push({proposal:("if (condition) {\n"+e+"\t\n"+e+"}").substring(b.length),description:f,positions:a,escapePosition:g}),f="if - if else statement",a=[{offset:h+4,length:9}],g=h+e.length+18,c.push({proposal:("if (condition) {\n"+
e+"\t\n"+e+"} else {\n"+e+"\t\n"+e+"}").substring(b.length),description:f,positions:a,escapePosition:g}));"for".indexOf(b)===0&&(f="for - iterate over array",a=[{offset:h+9,length:1},{offset:h+20,length:5}],g=h+e.length+42,c.push({proposal:("for (var i = 0; i < array.length; i++) {\n"+e+"\t\n"+e+"}").substring(b.length),description:f,positions:a,escapePosition:g}),f="for..in - iterate over properties of an object",a=[{offset:h+9,length:8},{offset:h+21,length:6}],g=h+2*e.length+73,c.push({proposal:("for (var property in object) {\n"+
e+"\tif (object.hasOwnProperty(property)) {\n"+e+"\t\t\n"+e+"\t}\n"+e+"}").substring(b.length),description:f,positions:a,escapePosition:g}));"while".indexOf(b)===0&&(f="while - while loop with condition",a=[{offset:h+7,length:9}],g=h+e.length+21,c.push({proposal:("while (condition) {\n"+e+"\t\n"+e+"}").substring(b.length),description:f,positions:a,escapePosition:g}));"do".indexOf(b)===0&&(f="do - do while loop with condition",a=[{offset:h+16,length:9}],g=h+e.length+6,c.push({proposal:("do {\n"+e+
"\t\n"+e+"} while (condition);").substring(b.length),description:f,positions:a,escapePosition:g}));"switch".indexOf(b)===0&&(f="switch - switch case statement",a=[{offset:h+8,length:10},{offset:h+28,length:6}],g=h+2*e.length+38,c.push({proposal:("switch (expression) {\n"+e+"\tcase value1:\n"+e+"\t\t\n"+e+"\t\tbreak;\n"+e+"\tdefault:\n"+e+"}").substring(b.length),description:f,positions:a,escapePosition:g}));"try".indexOf(b)===0&&(f="try - try..catch statement",g=h+e.length+7,c.push({proposal:("try {\n"+
e+"\t\n"+e+"} catch (err) {\n"+e+"}").substring(b.length),description:f,escapePosition:g}),f="try - try..catch statement with finally block",g=h+e.length+7,c.push({proposal:("try {\n"+e+"\t\n"+e+"} catch (err) {\n"+e+"} finally {\n"+e+"}").substring(b.length),description:f,escapePosition:g}));return c}function q(b){for(var e="break,case,catch,continue,debugger,default,delete,do,else,finally,for,function,if,in,instanceof,new,return,switch,this,throw,try,typeof,var,void,while,with".split(","),f=[],
h=0;h<e.length;h++)e[h].indexOf(b)===0&&f.push({proposal:e[h].substring(b.length),description:e[h]});return f}function m(){}var i={":":":","!":"!","@":"@","#":"#",$:"$","^":"^","&":"&","*":"*",".":".","?":"?","<":"<",">":">"};m.prototype={computeProposals:function(b,e,f){for(var f=f.prefix,h=[],c=e-f.length-1,a="";c>=0;)if(a=b[c],a==="\n"||a==="\r")break;else if(/\s/.test(a))c--;else break;if(i[a])return h;h=h.concat(r(f,b,e));return h=h.concat(q(f,b,e))}};return{JSTemplateContentAssistProvider:m}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(r,q){function m(f){return f.getProperty("objectClass").indexOf(b)!==-1&&f.getProperty("type")==="highlighter"}function i(b,e,c){this.initialize(b,e,c);this.lineStyles=[]}var b="orion.edit.highlighter",e=b+" service must be an event emitter";q.AnnotationType.registerType("orion.annotation.highlightError",{title:r.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});
i.prototype={initialize:function(f,e,c){this.textView=f;this.serviceRegistry=e;this.annotationModel=c;this.services=[];var a=this;this.listener={onModelChanging:function(c){a.onModelChanging(c)},onModelChanged:function(c){a.onModelChanged(c)},onDestroy:function(c){a.onDestroy(c)},onLineStyle:function(c){a.onLineStyle(c)},onStyleReady:function(c){a.onStyleReady(c)},onServiceAdded:function(c){a.onServiceAdded(c.serviceReference,a.serviceRegistry.getService(c.serviceReference))},onServiceRemoved:function(c){a.onServiceRemoved(c.serviceReference,
a.serviceRegistry.getService(c.serviceReference))}};f.addEventListener("ModelChanging",this.listener.onModelChanging);f.addEventListener("ModelChanged",this.listener.onModelChanged);f.addEventListener("Destroy",this.listener.onDestroy);f.addEventListener("LineStyle",this.listener.onLineStyle);e.addEventListener("registered",this.listener.onServiceAdded);e.addEventListener("unregistering",this.listener.onServiceRemoved);f=e.getServiceReferences(b);for(c=0;c<f.length;c++){var g=f[c];m(g)&&this.addServiceListener(e.getService(g))}},
onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null;if(this.services){for(var b=0;b<this.services.length;b++)this.removeServiceListener(this.services[b]);this.services=
null}if(this.serviceRegistry)this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null;this.lineStyles=this.listener=null},onModelChanging:function(b){this.startLine=this.textView.getModel().getLineAtOffset(b.start)},onModelChanged:function(b){var e=this.startLine;(b.addedLineCount||b.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[e,b.removedLineCount].concat(this._getEmptyStyle(b.addedLineCount)))},
onStyleReady:function(b){var e=b.lineStyles||b.style,b=Number.MAX_VALUE,c=-1,a=this.textView.getModel(),g;for(g in e)e.hasOwnProperty(g)&&(this.lineStyles[g]=e[g],b=Math.min(b,g),c=Math.max(c,g));b=Math.max(b,0);c=Math.min(c,a.getLineCount());if(e=this.annotationModel){for(var i=e.getAnnotations(a.getLineStart(b),a.getLineEnd(c)),n=[];i.hasNext();){var o=i.next();o.type==="orion.annotation.highlightError"&&n.push(o)}i=[];for(o=b;o<=c;o++){g=o;var m=this.lineStyles[g],m=m&&m.errors;g=a.getLineStart(g);
if(m)for(var t=0;t<m.length;t++){var r=m[t];i.push(q.AnnotationType.createAnnotation("orion.annotation.highlightError",r.start+g,r.end+g))}}e.replaceAnnotations(n,i)}this.textView.redrawLines(b,c+1)},onLineStyle:function(b){function e(a,c){for(var b=a.length,f=[],h=0;h<b;h++){var i=a[h];f.push({start:i.start+c,end:i.end+c,style:i.style})}return f}var c=this.lineStyles[b.lineIndex];if(c)if(c.ranges)b.ranges=e(c.ranges,b.lineStart);else if(c.style)b.style=c.style},_getEmptyStyle:function(b){for(var e=
[],c=0;c<b;c++)e.push(null);return e},setContentType:function(b){this.contentType=b;if(this.services)for(b=0;b<this.services.length;b++){var e=this.services[b];if(e.setContentType){var c=this.serviceRegistry.getService("orion.page.progress");c?c.progress(e.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):e.setContentType(this.contentType)}}},onServiceAdded:function(b,e){m(b)&&this.addServiceListener(e)},onServiceRemoved:function(b,
e){this.services.indexOf(e)!==-1&&this.removeServiceListener(e)},addServiceListener:function(b){if(typeof b.addEventListener==="function"){if(b.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(b),b.setContentType&&this.contentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(b.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):b.setContentType(this.contentType)}}else typeof console!==
"undefined"&&console.log(Error(e))},removeServiceListener:function(b){typeof b.removeEventListener==="function"?(b.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),b=this.services.indexOf(b),b!==-1&&this.services.splice(b,1)):typeof console!=="undefined"&&console.log(Error(e))}};return i});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(r,q,m){function i(c){this.string=c;this.tokenStart=this.pos=0}function b(){this._modes={};this.mimeModes={};this.options={};this.StringStream=i}function e(c){var a=[],b;for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&a.push(b);return a}function f(c,a,b){b=b||{};this.model=c;this.codeMirror=a;this.isWhitespaceVisible=typeof b.whitespacesVisible==="undefined"?!1:b.whitespacesVisible;
this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(c)}function h(c,a,b){this.init(c,a,b)}i.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos===0},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},eat:function(c){var a=this.string[this.pos];return typeof a==="string"&&(a===c||c.test&&c.test(a)||typeof c==="function"&&
c(a))?this.string[this.pos++]:void 0},eatWhile:function(c){for(var a=!1;this.eat(c)!==void 0;)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(c){c=this.string.indexOf(c,this.pos);return c!==-1?(this.pos=c,!0):!1},match:function(c,a,b){a=a===!0||typeof a==="undefined";if(typeof c==="string"){var e=b?this.string.toLowerCase():this.string,c=b?c.toLowerCase():c,b=e.indexOf(c,this.pos);if(b!==-1&&a)this.pos=b+c.length;return b!==
-1}else return(c=this.string.substring(this.pos).match(c))&&a&&typeof c[0]==="string"&&(this.pos+=c.index+c[0].length),c},backUp:function(c){this.pos-=c},column:function(){for(var c=0,a=0;a<this.tokenStart;)c+=this.string[a++]==="\t"?4:1;return c},indentation:function(){for(var c=this.string.search(/\S/),a=0,b=0;b<c;)a+=this.string[b++]==="\t"?4:1;return a},current:function(){return this.string.substring(this.tokenStart,this.pos)},advance:function(){this.tokenStart=this.pos}};b.prototype={options:{},
setOption:function(c,a){this.options[c]=a},getOption:function(c){return this.options[c]},copyState:function(c,a){if(typeof c.copyState==="function")return c.copyState(a);var b={},e;for(e in a){var f=a[e];b[e]=f instanceof Array?f.slice():f}return b},defineMode:function(c,a){this._modes[c]=a},defineMIME:function(c,a){this.mimeModes[c]=a},getMode:function(c,a){var b={},e;typeof a==="string"&&this.mimeModes[a]&&(a=this.mimeModes[a]);typeof a==="object"&&(b=a,e=this._modes[a.name]);e=e||this._modes[a];
if(typeof e!=="function")throw"Mode not found "+a;return e(c,b)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(c){c=this.mimeModes[c];if(typeof c==="object")c=c.name;return c}};f.prototype={initialize:function(){var c=this;this.listener={onModelChanging:function(a){c._onModelChanging(a)},onModelChanged:function(a){c._onModelChanged(a)},onDestroy:function(a){c._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);
this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(c){this.startLine=
this.model.getLineAtOffset(c.start)},_onModelChanged:function(c){this._dbgEvent(c);var a=this.startLine;(c.removedLineCount||c.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,c.removedLineCount].concat(this._newLines(c.addedLineCount)));this.mode&&(c=Math.max(c.addedLineCount,c.removedLineCount),c=a+Math.min(c,500),this.highlight(a,c),this.highlightLater(c+1))},_onDestroy:function(){this.destroy()},setViewportIndex:function(c){this.viewportIndex=c},_dbgEvent:function(){},_dbgStyle:function(){},
_newLines:function(c){for(var a=[],b=0;b<c;b++)a.push({style:null,eolState:null});return a},setMode:function(c,a){if(c)this.mode=this.codeMirror.getMode(this.codeMirror.options,c),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight()},highlight:function(c,a,b){if(this.mode){for(var e=this.model.getLineCount(),c=typeof c==="undefined"?0:c,a=typeof a==="undefined"?e-1:Math.min(a,e-1),e=this.mode,f=this.getState(c),h=c;h<=a;h++){var i=this.lines[h];this.highlightLine(h,i,f);i.eolState=
this.codeMirror.copyState(e,f)}this._expandRange(c,a);if(!b)this.onHighlightDone()}},highlightLater:function(c){this.dirtyLines.push(c);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var c=+new Date+30,a=this.mode.compareStates,b=this.model.getLineCount();this.dirtyLines.length;){var e=this.viewportIndex,f=this.lines[e],e=f&&!f.eolState?e:this.dirtyLines.pop();if(e>=b)break;this._expandRange(e,e);for(var f=this._getResumeLineIndex(e),e=f+1,f=(f=f>=
0&&this.lines[f].eolState)?this.codeMirror.copyState(this.mode,f):this.mode.startState(),h=0,i=e;i<b;i++){var m=this.lines[i],q=m.eolState,d=this.highlightLine(i,m,f);m.eolState=this.codeMirror.copyState(this.mode,f);d&&this._expandRange(e,i+1);var m=a&&q&&a(q,m.eolState),j=!a&&!d&&h++>3;if(m||j)break;else if(!q||d)h=0;q=i<b||this.dirtyLines.length;if(+new Date>c&&q){this.highlightLater(i+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&
this.endLine!==-1&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(c){for(var a=this.lines,b=c-1;b>=0;b--)if(a[b].eolState||c-b>40)return b;return-1},getState:function(c){var a=this.mode,b=this.lines,e,f;for(e=c-1;e>=0;e--)if(f=b[e],f.eolState||c-e>40)break;var h=e>=0&&b[e].eolState;if(h){h=this.codeMirror.copyState(a,h);for(e=Math.max(0,e);e<c-1;e++)f=b[e],this.highlightLine(e,f,h),f.eolState=
this.codeMirror.copyState(a,h);return h}else return a.startState()},highlightLine:function(c,a,b){if(this.mode){var e=this.model;e.getLineStart(c)===e.getLineEnd(c)&&this.mode.blankLine&&this.mode.blankLine(b);for(var f=a.style||[],c=e.getLine(c),c=new i(c),e=!a.style,h=[],m=0;!c.eol();m++){var q=this.mode.token(c,b)||null,r=c.current();this._whitespaceStyle(q,r,c.tokenStart);q=[c.tokenStart,c.pos,q];r=f[m];h.push(q);e=e||!r||r[0]!==q[0]||r[1]!==q[1]||r[2]!==q[2];c.advance()}if(e=e||h.length!==f.length)a.style=
h.length?h:null;return e}},_whitespaceStyle:function(c,a,b){if(!c&&this.isWhitespaceVisible&&/\s+/.test(a)){for(var c=[],e,f,h=0;h<a.length;h++){var i=a[h];i!==f&&(f&&c.push([b+e,b+h,f==="\t"?"token_tab":"token_space"]),e=h,f=i)}c.push([b+e,b+h,f==="\t"?"token_tab":"token_space"]);return c}return null},_expandRange:function(c,a){this.startLine=Math.min(this.startLine,c);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(c,a){var b=c.style;if(!b)return null;for(var e=[],f=[],h=
typeof a==="undefined"?0:this.model.getLineStart(a),i=0;i<b.length;i++){var m=b[i],q=!m[2]?null:m[2]==="token_tab"||m[2]==="token_space"?m[2]:"cm-"+m[2];q&&(m={start:h+m[0],end:h+m[1],style:{styleClass:q}},e.push(m),q==="cm-error"&&f.push(m))}return[e,f]},getLineStyle:function(c){return this.lines[c]},getLineStyles:function(){return this.lines}};q.EventTarget.addMixin(f.prototype);m.AnnotationType.registerType("orion.annotation.highlightError",{title:r.syntaxError,html:"<div class='annotationHTML error'></div>",
rangeStyle:{styleClass:"annotationRange error"}});h.prototype={init:function(c,a,b){this.textView=c;this.annotationModel=b;this.modeApplier=new f(c.getModel(),a);var e=this;this.listener={onLineStyle:function(a){e.onLineStyle(a)},onDestroy:function(a){e.onDestroy(a)},onHighlight:function(a){e.onHighlight(a)}};c.addEventListener("LineStyle",this.listener.onLineStyle);c.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&
(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(c){this.modeApplier.setMode(c)},onLineStyle:function(c){var a=c.lineIndex,b=this.modeApplier,e=b.getLineStyle(a);if(!e||!e.eolState){var f=this.textView.getModel().getLineCount();
b.highlight(a,Math.min(a+20,f-1),!0);e=b.getLineStyle(a)}f=this.textView.getModel();if(e){var h=b.toStyleRangesAndErrors(e,a);if(h&&(c.ranges=h[0],c=this.annotationModel)){b=[];e=[];if(h=h[1])for(var i=0;i<h.length;i++){var q=h[i];q.style.styleClass==="cm-error"&&e.push(m.AnnotationType.createAnnotation("orion.annotation.highlightError",q.start,q.end))}for(a=c.getAnnotations(f.getLineStart(a),f.getLineEnd(a));a.hasNext();)f=a.next(),f.type==="orion.annotation.highlightError"&&b.push(f);c.replaceAnnotations(b,
e)}}},onHighlight:function(c){this.textView.redrawLines(c.start,c.end)},onDestroy:function(){this.destroy()}};return{Mirror:b,ModeApplier:f,CodeMirrorStyler:h}});
define("orion/editor/textMateStyler",["orion/editor/regex"],function(r){function q(b){var e;if(b instanceof Array){e=Array(b.length);for(var f=0;f<b.length;f++)e[f]=q(b[f])}else for(f in e={},b)if(Object.prototype.hasOwnProperty.call(b,f)){var h=b[f];e[f]=typeof h==="object"&&h!==null?q(h):h}return e}function m(b,e,f){this.initialize(b);this.grammar=q(e);this.externalGrammars=f?q(f):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var i={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(b){return b[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(b){function e(a,c){throw Error('Unsupported regex feature "'+a+'": "'+c[0]+'" at index: '+c.index+" in "+c.input);}var f="",h,b=i.processGlobalFlag("x",b,function(a){for(var c="",b=!1,e=a.length,f=0;f<e;){var h=a.charAt(f);if(!b&&h==="#")for(;f<e&&h!=="\r"&&h!=="\n";)h=a.charAt(++f);
else if(!b&&/\s/.test(h))for(;f<e&&/\s/.test(h);)h=a.charAt(++f);else h==="\\"?(c+=h,/\s/.test(a.charAt(f+1))||(c+=a.charAt(f+1),f+=1)):(h==="["?b=!0:h==="]"&&(b=!1),c+=h),f+=1}return c}),b=i.processGlobalFlag("i",b,function(a){f+="i";return a});for(h=0;h<this.unsupported.length;h++){var c;(c=this.unsupported[h].regex.exec(b))&&e(this.unsupported[h].func(c),c)}return RegExp(b,f)},processGlobalFlag:function(b,e,f){function h(a,c){for(var b=0,e=a.length,f=-1,h=c;h<e&&f===-1;h++)switch(a.charAt(h)){case "\\":h++;
break;case "(":b++;break;case ")":b--,b===0&&(f=h)}return f}var c="(?"+b+")",b="(?"+b+":";if(e.substring(0,c.length)===c)return f(e.substring(c.length));else if(e.substring(0,b.length)===b){c=h(e,0);if(c<e.length-1)throw Error("Only a "+b+") group that encloses the entire regex is supported in: "+e);return f(e.substring(b.length,c))}return e},hasBackReference:function(b){return/\\\d+/.test(b.source)},getSubstitutedRegex:function(b,e,f){for(var f=typeof f==="undefined"?!0:!1,b=b.source.split(/(\\\d+)/g),
h=[],c=0;c<b.length;c++){var a=b[c],g=/\\(\d+)/.exec(a);g?(a=e[g[1]]||"",h.push(f?r.escape(a):a)):h.push(a)}return RegExp(h.join(""))},groupify:function(b,e){for(var f=b.source,h=f.length,c=[],a=0,g=[],i=1,n=1,m=[],q={},r={},v=0;v<h;v++){var d=c[c.length-1],j=f.charAt(v);switch(j){case "(":if(d===4)c.pop(),m.push(")"),g[g.length-1].end=v;var l=v+2<h?f.charAt(v+1)+""+f.charAt(v+2):null;if(l==="?:"||l==="?="||l==="?!"){var u;l==="?:"?u=1:(u=3,a++);c.push(u);g.push({start:v,end:-1,type:u});m.push(j);
m.push(l);v+=l.length}else c.push(2),g.push({start:v,end:-1,type:2,oldNum:i,num:n}),m.push(j),a===0&&(r[n]=null),q[i]=n,i++,n++;break;case ")":d=c.pop();d===3&&a--;g[g.length-1].end=v;m.push(j);break;case "*":case "+":case "?":case "}":var k=j,y=f.charAt(v-1),l=v-1;if(j==="}"){for(u=v-1;f.charAt(u)!=="{"&&u>=0;u--);y=f.charAt(u-1);l=u-1;k=f.substring(u,v+1)}u=g[g.length-1];if(y===")"&&(u.type===2||u.type===4)){m.splice(u.start,0,"(");m.push(k);m.push(")");j={start:u.start,end:m.length-1,type:4,num:u.num};
for(y=0;y<g.length;y++)if(d=g[y],(d.type===2||d.type===4)&&d.start>=u.start&&d.end<=l)if(d.start+=1,d.end+=1,d.num+=1,d.type===2)q[d.oldNum]=d.num;g.push(j);n++;break}default:j!=="|"&&d!==2&&d!==4&&a===0&&(c.push(4),g.push({start:v,end:-1,type:4,num:n}),m.push("("),r[n]=null,n++),m.push(j),j==="\\"&&(j=f.charAt(v+1),m.push(j),v+=1)}}for(;c.length;)c.pop(),m.push(")");var f=RegExp(m.join("")),h={},e=e||q,A;for(A in e)e.hasOwnProperty(A)&&(h[A]="\\"+e[A]);f=this.getSubstitutedRegex(f,h,!1);return[f,
q,r]},complexCaptures:function(b){if(!b)return!1;for(var e in b)if(b.hasOwnProperty(e)&&e!=="0")return!0;return!1}};m.prototype={initialize:function(b){this.textView=b;this.textView.stylerOptions=this;var e=this;this._listener={onModelChanged:function(b){e.onModelChanged(b)},onDestroy:function(b){e.onDestroy(b)},onLineStyle:function(b){e.onLineStyle(b)},onStorage:function(b){e.onStorage(b)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Destroy",this._listener.onDestroy);
b.addEventListener("LineStyle",this._listener.onLineStyle);b.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null;this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(b){for(b=[b];b.length!==0;){var e=
b.pop();if(!e._resolvedRule||!e._typedRule)if(e._resolvedRule=this._resolve(e),e._typedRule=this._createTypedRule(e),this.addStyles(e.name),this.addStyles(e.contentName),this.addStylesForCaptures(e.captures),this.addStylesForCaptures(e.beginCaptures),this.addStylesForCaptures(e.endCaptures),e._resolvedRule!==e&&b.push(e._resolvedRule),e.patterns)for(var f=0;f<e.patterns.length;f++)b.push(e.patterns[f])}},addStyles:function(b){if(b&&!this._styles[b]){this._styles[b]=[];for(var e=b.split("."),f=0;f<
e.length;f++)this._styles[b].push(e.slice(0,f+1).join("-"))}},addStylesForCaptures:function(b){for(var e in b)b.hasOwnProperty(e)&&this.addStyles(b[e].name)},ContainerRule:function(){function b(b){this.rule=b;this.subrules=b.patterns}b.prototype.valueOf=function(){return"aa"};return b}(),BeginEndRule:function(){function b(b){this.rule=b;this.beginRegex=i.toRegExp(b.begin);this.endRegex=i.toRegExp(b.end);this.subrules=b.patterns||[];this.endRegexHasBackRef=i.hasBackReference(this.endRegex);var f=i.complexCaptures(b.captures),
b=i.complexCaptures(b.beginCaptures)||i.complexCaptures(b.endCaptures);if(this.isComplex=f||b)f=i.groupify(this.beginRegex),this.beginRegex=f[0],this.beginOld2New=f[1],this.beginConsuming=f[2],f=i.groupify(this.endRegex,this.beginOld2New),this.endRegex=f[0],this.endOld2New=f[1],this.endConsuming=f[2]}b.prototype.valueOf=function(){return this.beginRegex};return b}(),MatchRule:function(){function b(b){this.rule=b;this.matchRegex=i.toRegExp(b.match);if(this.isComplex=i.complexCaptures(b.captures))b=
i.groupify(this.matchRegex),this.matchRegex=b[0],this.matchOld2New=b[1],this.matchConsuming=b[2]}b.prototype.valueOf=function(){return this.matchRegex};return b}(),_createTypedRule:function(b){return b.match?new this.MatchRule(b):b.begin?new this.BeginEndRule(b):new this.ContainerRule(b)},_resolve:function(b){var e=b;if(b.include){if(b.begin||b.end||b.match)throw Error('Unexpected regex pattern in "include" rule '+b.include);b=b.include;if(b.charAt(0)==="#"){if(e=this.grammar.repository&&this.grammar.repository[b.substring(1)],
!e)throw Error("Couldn't find included rule "+b+" in grammar repository");}else if(b==="$self")e=this.grammar;else if(b==="$base")throw Error('Include "$base" is not supported');else if(e=this._allGrammars[b],!e)for(var f=0;f<this.externalGrammars.length;f++){var h=this.externalGrammars[f];if(h.scopeName===b){this.preprocess(h);e=this._allGrammars[b]=h;break}}}return e},ContainerNode:function(){function b(b,f){this.parent=b;this.rule=f;this.children=[];this.end=this.start=null}b.prototype.addChild=
function(b){this.children.push(b)};b.prototype.valueOf=function(){var b=this.rule;return"ContainerNode { "+(b.include||"")+" "+(b.name||"")+(b.comment||"")+"}"};return b}(),BeginEndNode:function(){function b(b,f,h){this.parent=b;this.rule=f;this.children=[];this.setStart(h);this.endMatch=this.end=null;this.endRegexSubstituted=f.endRegexHasBackRef?i.getSubstitutedRegex(f.endRegex,h):null}b.prototype.addChild=function(b){this.children.push(b)};b.prototype.getIndexInParent=function(){return this.parent?
this.parent.children.indexOf(this):-1};b.prototype.setStart=function(b){this.start=b.index;this.beginMatch=b};b.prototype.setEnd=function(b){b&&typeof b==="object"?(this.endMatch=b,this.end=b.index+b[0].length):(this.endMatch=null,this.end=b)};b.prototype.shiftStart=function(b){this.start+=b;this.beginMatch.index+=b};b.prototype.shiftEnd=function(b){this.end+=b;this.endMatch&&(this.endMatch.index+=b)};b.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+
"}"};return b}(),push:function(b,e){if(e)for(var f=e.length;f>0;)b.push(e[--f])},exec:function(b,e,f){(e=b.exec(e))&&(e.index+=f);b.lastIndex=0;return e},afterMatch:function(b){return b.index+b[0].length},getEndMatch:function(b,e,f){if(b instanceof this.BeginEndNode){var h=b.rule,b=b.endRegexSubstituted||h.endRegex;return!b?null:this.exec(b,e,f)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,
!1,0)},onModelChanged:function(b){var e=b.addedCharCount,f=b.removedCharCount,b=b.start;if(this._tree){var h=this.textView.getModel(),c=h.getCharCount(),h=h.getLineEnd(h.getLineAtOffset(b)-1),a=this.getFirstDamaged(h,h),h=h===-1?0:h,e=a?this.parse(a,!0,h,b,e,f):c;this.textView.redrawRange(h,e)}else this.initialParse()},getFirstDamaged:function(b,e){if(b<0)return this._tree;for(var f=[this._tree],h=null;f.length;){var c=f.pop();if(!c.parent||this.isDamaged(c,b,e)){c instanceof this.BeginEndNode&&(h=
c);for(var a=0;a<c.children.length;a++)f.push(c.children[a])}}return h||this._tree},isDamaged:function(b,e,f){return b.start<=f&&b.end>e},parse:function(b,e,f,h,c,a){var g=this.textView.getModel(),i=g.getLineStart(g.getLineCount()-1),n=g.getCharCount(),m=this.getInitialExpected(b,f),q=-1;if(e)b.repaired=!0,b.endNeedsUpdate=!0,q=(q=b.children[b.children.length-1])?g.getLineEnd(g.getLineAtOffset(q.end+(c-a))):-1,h=g.getLineEnd(g.getLineAtOffset(h+a)),q=Math.max(q,h);for(var q=q===-1?n:q,h=m,r=b,v=!1,
d=f,j=-1;r&&(!e||d<q);){var l=this.getNextMatch(g,r,d);l||(d=d>=i?n:g.getLineStart(g.getLineAtOffset(d)+1));var u=l&&l.match,k=l&&l.rule,y=l&&l.isEnd;if(l&&l.isSub){if(d=this.afterMatch(u),k instanceof this.BeginEndRule)v=!0,e&&k===h.rule&&r===h.parent?(r=h,r.setStart(u),r.repaired=!0,r.endNeedsUpdate=!0,h=this.getNextExpected(h,"begin")):(e&&(this.prune(r,h),e=!1),u=new this.BeginEndNode(r,k,u),r.addChild(u),r=u)}else if(y||d===n){if(r instanceof this.BeginEndNode)u?(v=!0,j=Math.max(j,r.end),r.setEnd(u),
d=this.afterMatch(u),e&&r===h&&r.parent===h.parent?(r.repaired=!0,delete r.endNeedsUpdate,h=this.getNextExpected(h,"end")):e&&(this.prune(r,h),e=!1)):(r.setEnd(n),delete r.endNeedsUpdate);r=r.parent}e&&d>=q&&!v&&(this.prune(b,m),e=!1)}this.removeUnrepairedChildren(b,e,f);this.cleanup(e,b,f,q,n,c,a);return e?Math.max(j,d):d},removeUnrepairedChildren:function(b,e,f){if(e){for(var e=b.children,h=-1,c=0;c<e.length;c++){var a=e[c];if(!a.repaired&&this.isDamaged(a,f,Number.MAX_VALUE)){h=c;break}}if(h!==
-1)b.children.length=h}},cleanup:function(b,e,f,h,c,a,g){if(b){b=a-g;c=this.getIntersecting(h-b+1,c);e=this.getIntersecting(f,h);for(f=0;f<c.length;f++)h=c[f],!h.repaired&&h instanceof this.BeginEndNode&&(h.shiftEnd(b),h.shiftStart(b));for(f=0;f<e.length;f++)h=e[f],h.repaired&&h.endNeedsUpdate&&h.shiftEnd(b),delete h.endNeedsUpdate,delete h.repaired}else{e=this.getIntersecting(f,h);for(f=0;f<e.length;f++)delete e[f].repaired}},getNextMatch:function(b,e,f,h){var c=b.getLineAtOffset(f),c=b.getLineEnd(c),
a=b.getText(f,c),g=[],i=[],b=[],c=[];for(this.push(g,e.rule.subrules);g.length;){var n=g.length?g.pop():null,n=n&&n._resolvedRule._typedRule;if(n instanceof this.ContainerRule&&i.indexOf(n)===-1)i.push(n),this.push(g,n.subrules);else if(!n||!h||n.matchRegex){var m=n&&this.exec(n.matchRegex||n.beginRegex,a,f);m&&(b.push(m),c.push(n))}}g=Number.MAX_VALUE;i=-1;for(n=0;n<b.length;n++)if(m=b[n],m.index<g)g=m.index,i=n;if(!h&&(f=this.getEndMatch(e,a,f)))if(h=e.rule.applyEndPatternLast,i===-1||f.index<g||
!h&&f.index===g)return{isEnd:!0,rule:e.rule,match:f};return i===-1?null:{isSub:!0,rule:c[i],match:b[i]}},getInitialExpected:function(b,e){var f,h;if(b===this._tree)for(f=0;f<b.children.length;f++){if(h=b.children[f],h.start>=e)return h}else if(b instanceof this.BeginEndNode&&b.endMatch){var c=b.endMatch.index;for(f=0;f<b.children.length;f++)if(h=b.children[f],h.start>=e)break;if(h&&h.start<c)return h}return b},getNextExpected:function(b,e){if(e==="begin"){var f=b.children[0];return f?f:b}else if(e===
"end"&&(f=b.parent)){var h=f.children[f.children.indexOf(b)+1];return h?h:f}return null},prune:function(b,e){if(e.parent===b)b.children.length=e.getIndexInParent();else if(b instanceof this.BeginEndNode)b.endMatch=null,b.end=null;if(b.parent)b.parent.children.length=b.getIndexInParent()+1},onLineStyle:function(b){this._tree||this.initialParse();var e=b.lineStart,f=this.textView.getModel(),h=f.getLineEnd(b.lineIndex),c=f.getLineEnd(f.getLineAtOffset(e)-1),c=this.getFirstDamaged(c,c),e=this.getLineScope(f,
c,e,h);b.ranges=this.toStyleRanges(e);b.ranges.sort(function(a,b){return a.start-b.start})},getLineScope:function(b,e,f,h){for(var c=f,a=this.getInitialExpected(e,f),g=[],i=[];e&&c<h;){var n=this.getNextMatch(b,e,c);if(!n)break;var m=n&&n.match,q=n&&n.rule,r=n&&n.isSub,n=n&&n.isEnd;m.index!==c&&i.push({start:c,end:m.index,node:e});if(r)c=this.afterMatch(m),q instanceof this.BeginEndRule?(this.addBeginScope(g,m,q),e=a,a=this.getNextExpected(a,"begin")):this.addMatchScope(g,m,q);else if(n)c=this.afterMatch(m),
this.addEndScope(g,m,q),a=this.getNextExpected(a,"end"),e=e.parent}c<h&&i.push({start:c,end:h,node:e});b=this.getInheritedLineScope(i,f,h);return g.concat(b)},getInheritedLineScope:function(b){for(var e=[],f=0;f<b.length;f++)for(var h=b[f],c=h.node;c;){var a=c.rule.rule,g=a.name;if(a=a.contentName||g){this.addScopeRange(e,h.start,h.end,a);break}c=c.parent}return e},addBeginScope:function(b,e,f){var h=f.rule;this.addCapturesScope(b,e,h.beginCaptures||h.captures,f.isComplex,f.beginOld2New,f.beginConsuming)},
addEndScope:function(b,e,f){var h=f.rule;this.addCapturesScope(b,e,h.endCaptures||h.captures,f.isComplex,f.endOld2New,f.endConsuming)},addMatchScope:function(b,e,f){var h=f.rule,c=h.name;(h=h.captures)?this.addCapturesScope(b,e,h,f.isComplex,f.matchOld2New,f.matchConsuming):this.addScope(b,e,c)},addScope:function(b,e,f){f&&b.push({start:e.index,end:this.afterMatch(e),scope:f})},addScopeRange:function(b,e,f,h){h&&b.push({start:e,end:f,scope:h})},addCapturesScope:function(b,e,f,h,c,a){if(f)if(h){for(var h=
{1:0},g=0,i=1;e[i]!==void 0;i++)a[i]!==void 0&&(g+=e[i].length),e[i+1]!==void 0&&(h[i+1]=g);a=e.index;for(g=1;f[g];g++){var i=f[g].name,n=c[g],m=a+h[n];typeof e[n]!=="undefined"&&this.addScopeRange(b,m,m+e[n].length,i)}}else this.addScope(b,e,f[0]&&f[0].name)},getIntersecting:function(b,e){for(var f=[],h=this._tree?[this._tree]:[];h.length;){var c=h.pop(),a=!1;c instanceof this.ContainerNode?a=!0:this.isDamaged(c,b,e)&&(a=!0,f.push(c));if(a)for(var a=c.children.length,g=0;g<a;g++)h.push(c.children[g])}return f.reverse()},
toStyleRanges:function(b){for(var e=[],f=0;f<b.length;f++){var h=b[f],c=this._styles[h.scope];if(!c)throw Error("styles not found for "+h.scope);c=c.join(" ");e.push({start:h.start,end:h.end,style:{styleClass:c}})}return e}};return{RegexUtil:i,TextMateStyler:m}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("examples/editor/textStyler",["orion/editor/annotations"],function(r){function q(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function m(){q.call(this,null,!0)}function i(a){q.call(this,null,a)}function b(){q.call(this,null,!1)}function e(a,d,e){this.commentStart="/*";this.commentEnd="*/";var g=[];switch(d){case "java":g=h;break;case "js":g=f;break;case "css":g=c}this.whitespacesVisible=!1;this.detectHyperlinks=!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=
!0;this._scanner=new q(g,this.whitespacesVisible);this._firstScanner=new b;this._commentScanner=new i(this.whitespacesVisible);this._whitespaceScanner=new m;if(d==="css")this._scanner.isCSS=!0,this._firstScanner.isCSS=!0;this.view=a;this.annotationModel=e;this._bracketAnnotations=void 0;var j=this;this._listener={onChanged:function(a){j._onModelChanged(a)},onDestroy:function(a){j._onDestroy(a)},onLineStyle:function(a){j._onLineStyle(a)},onMouseDown:function(a){j._onMouseDown(a)},onSelection:function(a){j._onSelection(a)}};
d=a.getModel();d.getBaseModel&&(d=d.getBaseModel());d.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);this._computeComments();this._computeFolding();a.redrawLines()}var f="break,case,class,catch,continue,const,debugger,default,delete,do,else,enum,export,extends,false,finally,for,function,if,implements,import,in,instanceof,interface,let,new,null,package,private,protected,public,return,static,super,switch,this,throw,true,try,typeof,undefined,var,void,while,with,yield".split(","),
h="abstract,boolean,break,byte,case,catch,char,class,continue,default,do,double,else,extends,false,final,finally,float,for,if,implements,import,instanceof,int,interface,long,native,new,null,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,true,try,void,volatile,while".split(","),c="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(","),
a={styleClass:"comment"},g={styleClass:"token_multiline_comment"},p={styleClass:"token_doc_comment"},n={styleClass:"token_doc_html_markup"},o={styleClass:"token_task_tag"},s={styleClass:"token_doc_tag"},t={styleClass:"token_string"},v={styleClass:"token_number"},d={styleClass:"token_keyword"},j={styleClass:"token_space"},l={styleClass:"token_tab"},u={styleClass:"line_caret"};q.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,
this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&a<=57){var d=b=!1,f=!1,e=a;do if(a=this._read(),a===46&&!b)b=!0;else if(a===101&&!d)b=d=!0,a=this._read(),a!==45&&this._unread(a);else if(a===
120&&e===48&&this.offset-c===2)b=d=f=!0;else if(!(48<=a&&a<=57||f&&(65<=a&&a<=70||97<=a&&a<=102)))break;while(1);this._unread(a);return 3}if(97<=a&&a<=122||65<=a&&a<=90||a===95||45===a&&b){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57||45===a&&b);this._unread(a);a=this.keywords;if(a.length>0){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):
-1},_unread:function(a){a!==-1&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&a===47)for(;;)if(a=this._read(),a===-1||a===10||a===13)return this._unread(a),6;if(a===42){a=this._read();b=7;for(a===42&&(b=8);;){for(;a===42;)if(a=this._read(),a===47)return b;if(a===-1)return this._unread(a),b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;
case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;default:return this._default(a)}}},setText:function(a){this.text=a;this.startOffset=this.offset=0}};m.prototype=new q(null);m.prototype.nextToken=
function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(a===32||a===9||a===-1));this._unread(a);return 1}}};i.prototype=new q(null);i.prototype.setType=function(a){this._type=a};i.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===
9);this._unread(a);return 9;case 60:if(this._type===8){do a=this._read();while(!(a===62||a===-1));if(a===62)return 12}return 1;case 64:if(this._type===8){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57);this._unread(a);return 13}return 1;case 84:if((a=this._read())===79)if((a=this._read())===68)if((a=this._read())===79)if(a=this._read(),!(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(a===32||
a===9||a===-1||a===60||a===64||a===84));this._unread(a);return 1}}};b.prototype=new q(null);b.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),1}};e.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);
a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a){this.whitespacesVisible=a;this._scanner.whitespacesVisible=a;this._commentScanner.whitespacesVisible=a},setDetectHyperlinks:function(a){this.detectHyperlinks=a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,
b,c,d,f){var e;d===void 0&&(d=-1);if(f===void 0)f=a.length;for(;f-d>1;)if(e=Math.floor((f+d)/2),b<=a[e].start)f=e;else if(c&&b<a[e].end){f=e;break}else d=e;return f},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(r.AnnotationType.ANNOTATION_FOLDING);for(var c=
[],d=a.getBaseModel(),f=this.comments,e=0;e<f.length;e++){var g=f[e];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var f=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return f===b?null:new (r.AnnotationType.getType(r.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=this.annotationModel;if(d){var f=this.view.getModel(),e=f;f.getBaseModel&&(e=f.getBaseModel());
for(var g=d.getAnnotations(b,c),f=[],h=r.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=g.next();i.type===h&&f.push(i)}g=[];i=this._commentScanner;i.setText(e.getText(b,c));for(var j;j=i.nextToken();){var l=i.getStartOffset()+b;j===14&&(j=e.getLineEnd(e.getLineAtOffset(l)),a!==6&&(j=Math.min(j,c-this.commentEnd.length)),g.push(r.AnnotationType.createAnnotation(h,l,j,e.getText(l,j))))}d.replaceAnnotations(f,g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),
b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return u}return null},_getStyles:function(a,b,c){a.getBaseModel&&(c=a.mapOffset(c));for(var d=c+b.length,f=[],e=c,h=this.comments,i=this._binarySearch(h,c,!0);i<h.length;i++){if(h[i].start>=d)break;var j=h[i].start,l=h[i].end;e<j&&this._parse(b.substring(e-c,j-c),e,f);var n=h[i].type,m;switch(n){case 8:m=p;break;case 7:m=g;break;case 5:m=t}e=Math.max(e,j);j=Math.min(d,l);(n===8||n===7)&&(this.whitespacesVisible||this.detectHyperlinks)?
this._parseComment(b.substring(e-c,j-c),e,f,m,n):n===5&&this.whitespacesVisible?this._parseString(b.substring(e-c,j-c),e,f,t):f.push({start:e,end:j,style:m});e=l}e<d&&this._parse(b.substring(e-c,d-c),e,f);if(a.getBaseModel)for(b=0;b<f.length;b++)c=f[b].end-f[b].start,f[b].start=a.mapOffset(f[b].start,!0),f[b].end=f[b].start+c;return f},_parse:function(b,c,f){var e=this._scanner;for(e.setText(b);b=e.nextToken();){var h=e.getStartOffset()+c,i=null;switch(b){case 2:i=d;break;case 3:i=v;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(e.getData(),
h,f,t);continue}else i=t;break;case 8:this._parseComment(e.getData(),h,f,p,b);continue;case 6:this._parseComment(e.getData(),h,f,a,b);continue;case 7:this._parseComment(e.getData(),h,f,g,b);continue;case 10:this.whitespacesVisible&&(i=l);break;case 11:this.whitespacesVisible&&(i=j)}f.push({start:h,end:e.getOffset()+c,style:i})}},_parseComment:function(a,b,c,d,f){var e=this._commentScanner;e.setText(a);for(e.setType(f);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&
(g=l);break;case 11:this.whitespacesVisible&&(g=j);break;case 12:g=n;break;case 13:g=s;break;case 14:g=o;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(e.getData(),f,c,g))}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var f=this._whitespaceScanner;for(f.setText(a);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&(g=l);break;case 11:this.whitespacesVisible&&(g=j)}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},
_detectHyperlinks:function(a,b,c,d){var f=null,e;if((e=a.indexOf("://"))>0){for(var f=a,g=e;g>0;){e=f.charCodeAt(g-1);if(!(97<=e&&e<=122||65<=e&&e<=90||45===e||48<=e&&e<=57))break;g--}if(g>0&&(e="\"\"''(){}[]<>".indexOf(f.substring(g-1,g)),e!==-1&&(e&1)===0&&(e=f.lastIndexOf("\"\"''(){}[]<>".substring(e+1,e+2)))!==-1)){var h=e;e=this._clone(d);e.tagName="A";e.attributes={href:f.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+g,end:b+h,style:e});c.push({start:b+h,end:b+a.length,style:d});
return null}}else a.toLowerCase().indexOf("bug#")===0&&(f="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return f?(e=this._clone(d),e.tagName="A",e.attributes={href:f},e):d},_clone:function(a){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(d===7||d===8||d===5)&&e.push({start:c.getStartOffset()+b,end:c.getOffset()+b,type:d}),(d===
6||d===7||d===8)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(e===-1)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;i>=0;i--)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;for(g-=1;g>=
0;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;e>=0;e--)if(h=c[e]>=0?1:-1,j+=h,j===0)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,b,c,d,e,f){for(var g=[],a=
a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,l=this.comments,n=this._binarySearch(l,e,!0);n<l.length;n++){if(l[n].start>=f)break;j=l[n].start;var m=l[n].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=m}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},
_onLineStyle:function(a){if(a.textView===this.view)a.style=this._getLineStyle(a.lineIndex);a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,
h,i;if(c.start===c.end&&(i=d.getCaretOffset())>0)i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),a!==-1&&(h=[r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_CURRENT_BRACKET,i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(a.clickCount===2){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,
a.y);if(d>0){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);e!==-1&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),j=this._binarySearch(this.comments,i,!0),l=this._binarySearch(this.comments,
c,!1,j-1,h);j<h&&this.comments[j].start<=i&&i<this.comments[j].end?(i=this.comments[j].start,i>b&&(i+=d)):i=j===h&&h>0&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var n;l<h?(n=this.comments[l].end,n>b&&(n+=d),l+=1):(l=h,n=g);for(var m,g=this._findComments(f.getText(i,n),i),h=j;h<this.comments.length;h++)m=this.comments[h],m.start>b&&(m.start+=d),m.start>b&&(m.end+=d);var o=l-j!==g.length;if(!o)for(h=0;h<g.length;h++){m=this.comments[j+h];var p=g[h];if(m.start!==p.start||m.end!==p.end||
m.type!==p.type){o=!0;break}}h=[j,l-j].concat(g);Array.prototype.splice.apply(this.comments,h);o&&(h=i,m=n,a!==f&&(h=a.mapOffset(h,!0),m=a.mapOffset(m,!0)),e.redrawRange(h,m));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;j=e.getAnnotations(i,n);i=[];for(n=[];j.hasNext();)if(m=j.next(),m.type===r.AnnotationType.ANNOTATION_FOLDING){n.push(m);for(h=0;h<g.length;h++)if(m.start===g[h].start&&m.end===g[h].end)break;h===g.length?(i.push(m),m.expand()):(h=m.start,l=m.end,h>
b&&(h-=d),l>b&&(l-=d),h<=b&&b<l&&h<=c&&c<l&&(h=f.getLineAtOffset(m.start),l=f.getLineAtOffset(m.end),h!==l?m.expanded||(m.expand(),e.modifyAnnotation(m)):e.removeAnnotation(m)))}b=[];for(h=0;h<g.length;h++){m=g[h];for(d=0;d<n.length;d++)if(n[d].start===m.start&&n[d].end===m.end)break;d===n.length&&(m=this._createFoldingAnnotation(a,f,m.start,m.end))&&b.push(m)}e.replaceAnnotations(i,b)}}};return{TextStyler:e}});
define("orion/editor/edit","orion/editor/textView,orion/editor/textModel,orion/editor/textTheme,orion/editor/projectionTextModel,orion/editor/eventTarget,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/undoStack,orion/editor/textDND,orion/editor/editor,orion/editor/editorFeatures,orion/editor/contentAssist,orion/editor/cssContentAssist,orion/editor/htmlContentAssist,orion/editor/jsTemplateContentAssist,orion/editor/AsyncStyler,orion/editor/mirror,orion/editor/textMateStyler,orion/editor/htmlGrammar,examples/editor/textStyler".split(","),function(r,
q,m,i,b,e,f,h,c,a,g,p,n,o,s,t,v,d,j,l,u,k){function y(a){var b=a.firstChild;if(b&&b.tagName==="TEXTAREA")return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow,e;if(!(e=!d.getSelection)){if(!(b=a.childNodes.length===1&&b.nodeType===Node.TEXT_NODE)){for(var f,b=a;b&&b!==c&&f!=="none";)f=d.getComputedStyle?d.getComputedStyle(b,null).getPropertyValue("display"):b.currentStyle.display,b=b.parentNode;b=f==="none"}e=b}if(e)return a.innerText||a.textContent;c=c.createRange();c.selectNode(a);
a=d.getSelection();d=[];for(f=0;f<a.rangeCount;f++)d.push(a.getRangeAt(f));a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(f=0;f<d.length;f++)a.addRange(d[f]);return c}function A(a){if(a.substring(0,12)==="data-editor-")return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function E(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function I(a,b){var c={};E(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);var h=A(d.nodeName);
if(h){d=d.nodeValue;if(d==="true"||d==="false")d=d==="true";c[h]=d}}return c}function J(a){var b=a.ownerDocument,b=b.defaultView||b.parentWindow,c;if(b.getComputedStyle)c=b.getComputedStyle(a,null).getPropertyValue("height");else if(a.currentStyle)c=a.currentStyle.height;return parseInt(c,10)||0}function F(a){var b=a.parent;b||(b="editor");typeof b==="string"&&(b=(a.document||document).getElementById(b));if(!b&&a.className){var c=(a.document||document).getElementsByClassName(a.className);if(c){a.className=
void 0;for(var d=[],e=0;e<c.length;e++)a.parent=c[e],d.push(F(a));return d}}if(!b)throw"no parent";a=I(b,a);if(typeof a.theme==="string"){var c=m.TextTheme.getTheme(a.theme),e=a.theme.lastIndexOf("/"),f=a.theme;e!==-1&&(f=f.substring(e+1));f.substring(f.length-4)===".css"&&(f=f.substring(0,f.length-4));c.setThemeClass(f,{href:a.theme});a.theme=c}var g;a.readonly||(d={createContentAssistMode:function(a){g=new o.ContentAssist(a.getTextView());a=new o.ContentAssistWidget(g);return new o.ContentAssistMode(g,
a)}});d=new p.Editor({textViewFactory:function(){return new r.TextView({parent:b,model:new i.ProjectionTextModel(new q.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode})},undoStackFactory:new n.UndoFactory,annotationFactory:new n.AnnotationFactory,lineNumberRulerFactory:new n.LineNumberRulerFactory,foldingRulerFactory:new n.FoldingRulerFactory,textDNDFactory:new n.TextDNDFactory,
contentAssistFactory:d,keyBindingFactory:function(a,b,c,d){var e=new n.TextActions(a,c);b.push(e);a=new n.SourceCodeActions(a,c,d);b.push(a)},statusReporter:a.statusReporter,domNode:b});c=a.contents;c===void 0&&(c=y(b));c||(c="");d.installTextView();d.setLineNumberRulerVisible(a.showLinesRuler===void 0||a.showLinesRuler);d.setAnnotationRulerVisible(a.showAnnotationRuler===void 0||a.showFoldingRuler);d.setOverviewRulerVisible(a.showOverviewRuler===void 0||a.showOverviewRuler);d.setFoldingRulerVisible(a.showFoldingRuler===
void 0||a.showFoldingRuler);d.setInput(a.title,null,c);({styler:null,highlight:function(b,c){if(this.styler)this.styler.destroy(),this.styler=null;if(b){var d=c.getTextView(),e=c.getAnnotationModel();switch(b){case "js":case "java":case "css":this.styler=new k.TextStyler(d,b,e);c.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);break;case "html":this.styler=new l.TextMateStyler(d,new u.HtmlGrammar)}}}}).highlight(a.lang,d);if(g){var h=new s.CssContentAssistProvider,j=new v.JSTemplateContentAssistProvider;
g.addEventListener("Activating",function(){/css$/.test(a.lang)?g.setProviders([h]):/js$/.test(a.lang)&&g.setProviders([j])})}if(J(b)<=50)c=d.getTextView().computeSize().height,b.style.height=c+"px";return d}var G=this.orion?this.orion.editor:void 0;if(G)for(var C=0;C<arguments.length;C++)E(G,arguments[C]);return F});define(["orion/editor/edit"],function(r){return r});